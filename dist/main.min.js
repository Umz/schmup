(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({"/Users/seanodonohue/myProjects/schmup-prototype/src/js/main.js":[function(require,module,exports){
'use strict';

var game = new Phaser.Game(800, 600, Phaser.AUTO, 'schmup-game');

var width = 800;
var height = 600;

window.Utils = require('./utils');
window.playerState = {
    currentLevel: 'Game'
}



game.state.add('Boot', require('./states/boot'));
game.state.add('Splash', require('./states/splash'));
game.state.add('Preloader', require('./states/preloader'));
game.state.add('Menu', require('./states/menu'));
game.state.add('Game', require('./states/game'));

game.state.start('Boot');

},{"./states/boot":"/Users/seanodonohue/myProjects/schmup-prototype/src/js/states/boot.js","./states/game":"/Users/seanodonohue/myProjects/schmup-prototype/src/js/states/game.js","./states/menu":"/Users/seanodonohue/myProjects/schmup-prototype/src/js/states/menu.js","./states/preloader":"/Users/seanodonohue/myProjects/schmup-prototype/src/js/states/preloader.js","./states/splash":"/Users/seanodonohue/myProjects/schmup-prototype/src/js/states/splash.js","./utils":"/Users/seanodonohue/myProjects/schmup-prototype/src/js/utils.js"}],"/Users/seanodonohue/myProjects/schmup-prototype/src/js/states/boot.js":[function(require,module,exports){
var Boot = function () {};

module.exports = Boot;

Boot.prototype = {

  preload: function () {
    this.load.image('preloader', 'assets/preloader.gif');
  },

  create: function () {
    this.game.input.maxPointers = 1;

    if (this.game.device.desktop) {
      this.game.stage.scale.pageAlignHorizontally = true;
    } else {
      this.game.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL;
      this.game.scale.minWidth =  800;
      this.game.scale.minHeight = 600;
      this.game.scale.maxWidth = 800;
      this.game.scale.maxHeight = 600;
      this.game.scale.forceLandscape = true;
      this.game.scale.pageAlignHorizontally = true;
      this.game.scale.setScreenSize(true);
    }

    this.game.state.start('Preloader');
  }
};

},{}],"/Users/seanodonohue/myProjects/schmup-prototype/src/js/states/game.js":[function(require,module,exports){
var player;
var starfield;

var bullets;

var cursors;
var fireButton;

var ship = {
  'acceleration': 600,
  'drag': 350,
  'maxSpeed': 400
}


// TODO: var game = this for readability
var Game = function() {
  this.testentity = null;
};

module.exports = Game;

Game.prototype = {

  create: function() {
    //  We're going to be using physics, so enable the Arcade Physics system
    //  The scrolling starfield background
    starfield = this.add.tileSprite(0, 0, 800, 600, 'starfield');

    // The bullet group
    bullets = this.add.group();
    bullets.enableBody = true;
    bullets.physicsBodyType = Phaser.Physics.ARCADE;
    bullets.createMultiple(30, 'bullet');
    bullets.setAll('anchor.x', 0.5);
    bullets.setAll('anchor.y', 1);
    bullets.setAll('outOfBoundsKill', true);
    bullets.setAll('checkWorldBounds', true);

    // The player's ship
    player = this.add.sprite(400, 500, 'ship');
    this.physics.arcade.enable(player);
    
    // Set ship physics
    player.body
      .maxVelocity.setTo(ship.maxSpeed, ship.maxSpeed);
    player.body
      .drag.setTo(ship.drag, ship.drag);
    player.anchor.setTo(0.5, 0.5);

    // Set ship trail emitter
    shipTrail = this.add.emitter(player.x, player.y + 40, 400);
    shipTrail.width = 10;
    shipTrail.makeParticles('plasma');
    shipTrail.setXSpeed(30, -30);
    shipTrail.setYSpeed(200, 180);
    shipTrail.setRotation(50, -50);
    shipTrail.setAlpha(1, 0.01, 800);
    shipTrail.setScale(0.05, 0.4, 0.05, 0.4, 2000, Phaser.Easing.Quintic.Out);
    shipTrail.start(false, 5000, 10);

    // Set controls
    cursors = this.input.keyboard.createCursorKeys();
    fireButton = this.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);
  },

  update: function() {
    starfield.tilePosition.y += 2;

    player.body.acceleration.x = 0;

    if (cursors.left.isDown) {
      player.body.acceleration.x = -ship.acceleration;
    }
    else if (cursors.right.isDown) {
      player.body.acceleration.x = ship.acceleration;
    }

    if (fireButton.isDown) {
      fireBullet();
    }

    // TODO: Refactor to be DRY
    if (player.x > 750) {
      player.x = 750;
      player.body.acceleration.x = 0;
    }
    if (player.x < 50) {
      player.x = 50;
      player.body.acceleration.x = 0;
    }

    // Ship banking logic
    // TODO: put this in the ship object
    bank = player.body.velocity.x / ship.maxSpeed;
    player.scale.x = 1 - Math.abs(bank) / 4;
    player.angle = bank * 5;

    shipTrail.x = player.x;

    function fireBullet() {
      var bullet = bullets.getFirstExists(false);
      var bulletSpeed = 400;

      if (bullet) {
        
        // Bullets angle and velocity based on ship physics.
        var bulletOffset = 20 * Math.sin(Math.degToRad(player.angle));
        bullet.reset(player.x + bulletOffset, player.y + bulletOffset);
        bullet.angle = player.angle;
        this.physics.arcade.velocityFromAngle(bullet.angle - 90, bulletSpeed, bullet.body.velocity);
        bullet.body.velocity.x += player.body.velocity.x;
      }
    }

  },

  onInputDown: function() {
    this.game.state.start('Menu');
  }
};
},{}],"/Users/seanodonohue/myProjects/schmup-prototype/src/js/states/menu.js":[function(require,module,exports){
var Menu = function () {
  this.text = null;
};

module.exports = Menu;

Menu.prototype = {

  create: function () {
    var x = this.game.width / 2;
    var y = this.game.height / 2;

    var style = { font: "65px Arial", fill: "#ffffff", align: "center" };

    this.text = this.add.text(x - 300, y - 200, "Press to Start", style);

    this.input.onDown.add(this.onDown, this);
  },

  update: function () {
  },

  onDown: function () {
    this.game.state.start(playerState.currentLevel);
  }
};

},{}],"/Users/seanodonohue/myProjects/schmup-prototype/src/js/states/preloader.js":[function(require,module,exports){
var Preloader = function (game) {
  this.asset = null;
  this.ready = false;
};

module.exports = Preloader;


Preloader.prototype = {

  preload: function () {
    this.asset = this.add.sprite(320, 240, 'preloader');
    this.asset.anchor.setTo(0.5, 0.5);

    this.physics.startSystem(Phaser.Physics.ARCADE);


    this.load.onLoadComplete.addOnce(this.onLoadComplete, this);
    this.load.setPreloadSprite(this.asset);
    this.load.image('starfield', 'assets/starfield.png');
    this.load.image('ship', 'assets/player.png');
    this.load.image('plasma', 'assets/bluePlasma.png');
    this.load.image('laser', 'assets/blueLaser.png');
    this.load.image('bullet', 'assets/blueBullet.png');

  },

  create: function () {
    this.asset.cropEnabled = false;
  },

  update: function () {
    if (!!this.ready) {
      this.game.state.start('Menu');
    }
  },

  onLoadComplete: function () {
    this.ready = true;
  }
};

},{}],"/Users/seanodonohue/myProjects/schmup-prototype/src/js/states/splash.js":[function(require,module,exports){
var Splash = function () {
};

module.exports = Splash;

Splash.prototype = {
  create: function () {
  }
};
},{}],"/Users/seanodonohue/myProjects/schmup-prototype/src/js/utils.js":[function(require,module,exports){
var Utils = {
    containsObject: function(obj, list) {
        var i;
        for (i = 0; i < list.length; i++) {
            if (list[i] === obj) {
                return true;
            }
        }

        return false;
    }
};

module.exports = Utils;
},{}]},{},["/Users/seanodonohue/myProjects/schmup-prototype/src/js/main.js"])
//# sourceMappingURL=data:application/json;charset:utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvanMvbWFpbi5qcyIsInNyYy9qcy9zdGF0ZXMvYm9vdC5qcyIsInNyYy9qcy9zdGF0ZXMvZ2FtZS5qcyIsInNyYy9qcy9zdGF0ZXMvbWVudS5qcyIsInNyYy9qcy9zdGF0ZXMvcHJlbG9hZGVyLmpzIiwic3JjL2pzL3N0YXRlcy9zcGxhc2guanMiLCJzcmMvanMvdXRpbHMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN4SEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDekNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIid1c2Ugc3RyaWN0JztcblxudmFyIGdhbWUgPSBuZXcgUGhhc2VyLkdhbWUoODAwLCA2MDAsIFBoYXNlci5BVVRPLCAnc2NobXVwLWdhbWUnKTtcblxudmFyIHdpZHRoID0gODAwO1xudmFyIGhlaWdodCA9IDYwMDtcblxud2luZG93LlV0aWxzID0gcmVxdWlyZSgnLi91dGlscycpO1xud2luZG93LnBsYXllclN0YXRlID0ge1xuICAgIGN1cnJlbnRMZXZlbDogJ0dhbWUnXG59XG5cblxuXG5nYW1lLnN0YXRlLmFkZCgnQm9vdCcsIHJlcXVpcmUoJy4vc3RhdGVzL2Jvb3QnKSk7XG5nYW1lLnN0YXRlLmFkZCgnU3BsYXNoJywgcmVxdWlyZSgnLi9zdGF0ZXMvc3BsYXNoJykpO1xuZ2FtZS5zdGF0ZS5hZGQoJ1ByZWxvYWRlcicsIHJlcXVpcmUoJy4vc3RhdGVzL3ByZWxvYWRlcicpKTtcbmdhbWUuc3RhdGUuYWRkKCdNZW51JywgcmVxdWlyZSgnLi9zdGF0ZXMvbWVudScpKTtcbmdhbWUuc3RhdGUuYWRkKCdHYW1lJywgcmVxdWlyZSgnLi9zdGF0ZXMvZ2FtZScpKTtcblxuZ2FtZS5zdGF0ZS5zdGFydCgnQm9vdCcpO1xuIiwidmFyIEJvb3QgPSBmdW5jdGlvbiAoKSB7fTtcblxubW9kdWxlLmV4cG9ydHMgPSBCb290O1xuXG5Cb290LnByb3RvdHlwZSA9IHtcblxuICBwcmVsb2FkOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5sb2FkLmltYWdlKCdwcmVsb2FkZXInLCAnYXNzZXRzL3ByZWxvYWRlci5naWYnKTtcbiAgfSxcblxuICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmdhbWUuaW5wdXQubWF4UG9pbnRlcnMgPSAxO1xuXG4gICAgaWYgKHRoaXMuZ2FtZS5kZXZpY2UuZGVza3RvcCkge1xuICAgICAgdGhpcy5nYW1lLnN0YWdlLnNjYWxlLnBhZ2VBbGlnbkhvcml6b250YWxseSA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZ2FtZS5zY2FsZS5zY2FsZU1vZGUgPSBQaGFzZXIuU2NhbGVNYW5hZ2VyLlNIT1dfQUxMO1xuICAgICAgdGhpcy5nYW1lLnNjYWxlLm1pbldpZHRoID0gIDgwMDtcbiAgICAgIHRoaXMuZ2FtZS5zY2FsZS5taW5IZWlnaHQgPSA2MDA7XG4gICAgICB0aGlzLmdhbWUuc2NhbGUubWF4V2lkdGggPSA4MDA7XG4gICAgICB0aGlzLmdhbWUuc2NhbGUubWF4SGVpZ2h0ID0gNjAwO1xuICAgICAgdGhpcy5nYW1lLnNjYWxlLmZvcmNlTGFuZHNjYXBlID0gdHJ1ZTtcbiAgICAgIHRoaXMuZ2FtZS5zY2FsZS5wYWdlQWxpZ25Ib3Jpem9udGFsbHkgPSB0cnVlO1xuICAgICAgdGhpcy5nYW1lLnNjYWxlLnNldFNjcmVlblNpemUodHJ1ZSk7XG4gICAgfVxuXG4gICAgdGhpcy5nYW1lLnN0YXRlLnN0YXJ0KCdQcmVsb2FkZXInKTtcbiAgfVxufTtcbiIsInZhciBwbGF5ZXI7XG52YXIgc3RhcmZpZWxkO1xuXG52YXIgYnVsbGV0cztcblxudmFyIGN1cnNvcnM7XG52YXIgZmlyZUJ1dHRvbjtcblxudmFyIHNoaXAgPSB7XG4gICdhY2NlbGVyYXRpb24nOiA2MDAsXG4gICdkcmFnJzogMzUwLFxuICAnbWF4U3BlZWQnOiA0MDBcbn1cblxuXG4vLyBUT0RPOiB2YXIgZ2FtZSA9IHRoaXMgZm9yIHJlYWRhYmlsaXR5XG52YXIgR2FtZSA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLnRlc3RlbnRpdHkgPSBudWxsO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBHYW1lO1xuXG5HYW1lLnByb3RvdHlwZSA9IHtcblxuICBjcmVhdGU6IGZ1bmN0aW9uKCkge1xuICAgIC8vICBXZSdyZSBnb2luZyB0byBiZSB1c2luZyBwaHlzaWNzLCBzbyBlbmFibGUgdGhlIEFyY2FkZSBQaHlzaWNzIHN5c3RlbVxuICAgIC8vICBUaGUgc2Nyb2xsaW5nIHN0YXJmaWVsZCBiYWNrZ3JvdW5kXG4gICAgc3RhcmZpZWxkID0gdGhpcy5hZGQudGlsZVNwcml0ZSgwLCAwLCA4MDAsIDYwMCwgJ3N0YXJmaWVsZCcpO1xuXG4gICAgLy8gVGhlIGJ1bGxldCBncm91cFxuICAgIGJ1bGxldHMgPSB0aGlzLmFkZC5ncm91cCgpO1xuICAgIGJ1bGxldHMuZW5hYmxlQm9keSA9IHRydWU7XG4gICAgYnVsbGV0cy5waHlzaWNzQm9keVR5cGUgPSBQaGFzZXIuUGh5c2ljcy5BUkNBREU7XG4gICAgYnVsbGV0cy5jcmVhdGVNdWx0aXBsZSgzMCwgJ2J1bGxldCcpO1xuICAgIGJ1bGxldHMuc2V0QWxsKCdhbmNob3IueCcsIDAuNSk7XG4gICAgYnVsbGV0cy5zZXRBbGwoJ2FuY2hvci55JywgMSk7XG4gICAgYnVsbGV0cy5zZXRBbGwoJ291dE9mQm91bmRzS2lsbCcsIHRydWUpO1xuICAgIGJ1bGxldHMuc2V0QWxsKCdjaGVja1dvcmxkQm91bmRzJywgdHJ1ZSk7XG5cbiAgICAvLyBUaGUgcGxheWVyJ3Mgc2hpcFxuICAgIHBsYXllciA9IHRoaXMuYWRkLnNwcml0ZSg0MDAsIDUwMCwgJ3NoaXAnKTtcbiAgICB0aGlzLnBoeXNpY3MuYXJjYWRlLmVuYWJsZShwbGF5ZXIpO1xuICAgIFxuICAgIC8vIFNldCBzaGlwIHBoeXNpY3NcbiAgICBwbGF5ZXIuYm9keVxuICAgICAgLm1heFZlbG9jaXR5LnNldFRvKHNoaXAubWF4U3BlZWQsIHNoaXAubWF4U3BlZWQpO1xuICAgIHBsYXllci5ib2R5XG4gICAgICAuZHJhZy5zZXRUbyhzaGlwLmRyYWcsIHNoaXAuZHJhZyk7XG4gICAgcGxheWVyLmFuY2hvci5zZXRUbygwLjUsIDAuNSk7XG5cbiAgICAvLyBTZXQgc2hpcCB0cmFpbCBlbWl0dGVyXG4gICAgc2hpcFRyYWlsID0gdGhpcy5hZGQuZW1pdHRlcihwbGF5ZXIueCwgcGxheWVyLnkgKyA0MCwgNDAwKTtcbiAgICBzaGlwVHJhaWwud2lkdGggPSAxMDtcbiAgICBzaGlwVHJhaWwubWFrZVBhcnRpY2xlcygncGxhc21hJyk7XG4gICAgc2hpcFRyYWlsLnNldFhTcGVlZCgzMCwgLTMwKTtcbiAgICBzaGlwVHJhaWwuc2V0WVNwZWVkKDIwMCwgMTgwKTtcbiAgICBzaGlwVHJhaWwuc2V0Um90YXRpb24oNTAsIC01MCk7XG4gICAgc2hpcFRyYWlsLnNldEFscGhhKDEsIDAuMDEsIDgwMCk7XG4gICAgc2hpcFRyYWlsLnNldFNjYWxlKDAuMDUsIDAuNCwgMC4wNSwgMC40LCAyMDAwLCBQaGFzZXIuRWFzaW5nLlF1aW50aWMuT3V0KTtcbiAgICBzaGlwVHJhaWwuc3RhcnQoZmFsc2UsIDUwMDAsIDEwKTtcblxuICAgIC8vIFNldCBjb250cm9sc1xuICAgIGN1cnNvcnMgPSB0aGlzLmlucHV0LmtleWJvYXJkLmNyZWF0ZUN1cnNvcktleXMoKTtcbiAgICBmaXJlQnV0dG9uID0gdGhpcy5pbnB1dC5rZXlib2FyZC5hZGRLZXkoUGhhc2VyLktleWJvYXJkLlNQQUNFQkFSKTtcbiAgfSxcblxuICB1cGRhdGU6IGZ1bmN0aW9uKCkge1xuICAgIHN0YXJmaWVsZC50aWxlUG9zaXRpb24ueSArPSAyO1xuXG4gICAgcGxheWVyLmJvZHkuYWNjZWxlcmF0aW9uLnggPSAwO1xuXG4gICAgaWYgKGN1cnNvcnMubGVmdC5pc0Rvd24pIHtcbiAgICAgIHBsYXllci5ib2R5LmFjY2VsZXJhdGlvbi54ID0gLXNoaXAuYWNjZWxlcmF0aW9uO1xuICAgIH1cbiAgICBlbHNlIGlmIChjdXJzb3JzLnJpZ2h0LmlzRG93bikge1xuICAgICAgcGxheWVyLmJvZHkuYWNjZWxlcmF0aW9uLnggPSBzaGlwLmFjY2VsZXJhdGlvbjtcbiAgICB9XG5cbiAgICBpZiAoZmlyZUJ1dHRvbi5pc0Rvd24pIHtcbiAgICAgIGZpcmVCdWxsZXQoKTtcbiAgICB9XG5cbiAgICAvLyBUT0RPOiBSZWZhY3RvciB0byBiZSBEUllcbiAgICBpZiAocGxheWVyLnggPiA3NTApIHtcbiAgICAgIHBsYXllci54ID0gNzUwO1xuICAgICAgcGxheWVyLmJvZHkuYWNjZWxlcmF0aW9uLnggPSAwO1xuICAgIH1cbiAgICBpZiAocGxheWVyLnggPCA1MCkge1xuICAgICAgcGxheWVyLnggPSA1MDtcbiAgICAgIHBsYXllci5ib2R5LmFjY2VsZXJhdGlvbi54ID0gMDtcbiAgICB9XG5cbiAgICAvLyBTaGlwIGJhbmtpbmcgbG9naWNcbiAgICAvLyBUT0RPOiBwdXQgdGhpcyBpbiB0aGUgc2hpcCBvYmplY3RcbiAgICBiYW5rID0gcGxheWVyLmJvZHkudmVsb2NpdHkueCAvIHNoaXAubWF4U3BlZWQ7XG4gICAgcGxheWVyLnNjYWxlLnggPSAxIC0gTWF0aC5hYnMoYmFuaykgLyA0O1xuICAgIHBsYXllci5hbmdsZSA9IGJhbmsgKiA1O1xuXG4gICAgc2hpcFRyYWlsLnggPSBwbGF5ZXIueDtcblxuICAgIGZ1bmN0aW9uIGZpcmVCdWxsZXQoKSB7XG4gICAgICB2YXIgYnVsbGV0ID0gYnVsbGV0cy5nZXRGaXJzdEV4aXN0cyhmYWxzZSk7XG4gICAgICB2YXIgYnVsbGV0U3BlZWQgPSA0MDA7XG5cbiAgICAgIGlmIChidWxsZXQpIHtcbiAgICAgICAgXG4gICAgICAgIC8vIEJ1bGxldHMgYW5nbGUgYW5kIHZlbG9jaXR5IGJhc2VkIG9uIHNoaXAgcGh5c2ljcy5cbiAgICAgICAgdmFyIGJ1bGxldE9mZnNldCA9IDIwICogTWF0aC5zaW4oTWF0aC5kZWdUb1JhZChwbGF5ZXIuYW5nbGUpKTtcbiAgICAgICAgYnVsbGV0LnJlc2V0KHBsYXllci54ICsgYnVsbGV0T2Zmc2V0LCBwbGF5ZXIueSArIGJ1bGxldE9mZnNldCk7XG4gICAgICAgIGJ1bGxldC5hbmdsZSA9IHBsYXllci5hbmdsZTtcbiAgICAgICAgdGhpcy5waHlzaWNzLmFyY2FkZS52ZWxvY2l0eUZyb21BbmdsZShidWxsZXQuYW5nbGUgLSA5MCwgYnVsbGV0U3BlZWQsIGJ1bGxldC5ib2R5LnZlbG9jaXR5KTtcbiAgICAgICAgYnVsbGV0LmJvZHkudmVsb2NpdHkueCArPSBwbGF5ZXIuYm9keS52ZWxvY2l0eS54O1xuICAgICAgfVxuICAgIH1cblxuICB9LFxuXG4gIG9uSW5wdXREb3duOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmdhbWUuc3RhdGUuc3RhcnQoJ01lbnUnKTtcbiAgfVxufTsiLCJ2YXIgTWVudSA9IGZ1bmN0aW9uICgpIHtcbiAgdGhpcy50ZXh0ID0gbnVsbDtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gTWVudTtcblxuTWVudS5wcm90b3R5cGUgPSB7XG5cbiAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHggPSB0aGlzLmdhbWUud2lkdGggLyAyO1xuICAgIHZhciB5ID0gdGhpcy5nYW1lLmhlaWdodCAvIDI7XG5cbiAgICB2YXIgc3R5bGUgPSB7IGZvbnQ6IFwiNjVweCBBcmlhbFwiLCBmaWxsOiBcIiNmZmZmZmZcIiwgYWxpZ246IFwiY2VudGVyXCIgfTtcblxuICAgIHRoaXMudGV4dCA9IHRoaXMuYWRkLnRleHQoeCAtIDMwMCwgeSAtIDIwMCwgXCJQcmVzcyB0byBTdGFydFwiLCBzdHlsZSk7XG5cbiAgICB0aGlzLmlucHV0Lm9uRG93bi5hZGQodGhpcy5vbkRvd24sIHRoaXMpO1xuICB9LFxuXG4gIHVwZGF0ZTogZnVuY3Rpb24gKCkge1xuICB9LFxuXG4gIG9uRG93bjogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuZ2FtZS5zdGF0ZS5zdGFydChwbGF5ZXJTdGF0ZS5jdXJyZW50TGV2ZWwpO1xuICB9XG59O1xuIiwidmFyIFByZWxvYWRlciA9IGZ1bmN0aW9uIChnYW1lKSB7XG4gIHRoaXMuYXNzZXQgPSBudWxsO1xuICB0aGlzLnJlYWR5ID0gZmFsc2U7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFByZWxvYWRlcjtcblxuXG5QcmVsb2FkZXIucHJvdG90eXBlID0ge1xuXG4gIHByZWxvYWQ6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmFzc2V0ID0gdGhpcy5hZGQuc3ByaXRlKDMyMCwgMjQwLCAncHJlbG9hZGVyJyk7XG4gICAgdGhpcy5hc3NldC5hbmNob3Iuc2V0VG8oMC41LCAwLjUpO1xuXG4gICAgdGhpcy5waHlzaWNzLnN0YXJ0U3lzdGVtKFBoYXNlci5QaHlzaWNzLkFSQ0FERSk7XG5cblxuICAgIHRoaXMubG9hZC5vbkxvYWRDb21wbGV0ZS5hZGRPbmNlKHRoaXMub25Mb2FkQ29tcGxldGUsIHRoaXMpO1xuICAgIHRoaXMubG9hZC5zZXRQcmVsb2FkU3ByaXRlKHRoaXMuYXNzZXQpO1xuICAgIHRoaXMubG9hZC5pbWFnZSgnc3RhcmZpZWxkJywgJ2Fzc2V0cy9zdGFyZmllbGQucG5nJyk7XG4gICAgdGhpcy5sb2FkLmltYWdlKCdzaGlwJywgJ2Fzc2V0cy9wbGF5ZXIucG5nJyk7XG4gICAgdGhpcy5sb2FkLmltYWdlKCdwbGFzbWEnLCAnYXNzZXRzL2JsdWVQbGFzbWEucG5nJyk7XG4gICAgdGhpcy5sb2FkLmltYWdlKCdsYXNlcicsICdhc3NldHMvYmx1ZUxhc2VyLnBuZycpO1xuICAgIHRoaXMubG9hZC5pbWFnZSgnYnVsbGV0JywgJ2Fzc2V0cy9ibHVlQnVsbGV0LnBuZycpO1xuXG4gIH0sXG5cbiAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5hc3NldC5jcm9wRW5hYmxlZCA9IGZhbHNlO1xuICB9LFxuXG4gIHVwZGF0ZTogZnVuY3Rpb24gKCkge1xuICAgIGlmICghIXRoaXMucmVhZHkpIHtcbiAgICAgIHRoaXMuZ2FtZS5zdGF0ZS5zdGFydCgnTWVudScpO1xuICAgIH1cbiAgfSxcblxuICBvbkxvYWRDb21wbGV0ZTogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMucmVhZHkgPSB0cnVlO1xuICB9XG59O1xuIiwidmFyIFNwbGFzaCA9IGZ1bmN0aW9uICgpIHtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gU3BsYXNoO1xuXG5TcGxhc2gucHJvdG90eXBlID0ge1xuICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcbiAgfVxufTsiLCJ2YXIgVXRpbHMgPSB7XG4gICAgY29udGFpbnNPYmplY3Q6IGZ1bmN0aW9uKG9iaiwgbGlzdCkge1xuICAgICAgICB2YXIgaTtcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChsaXN0W2ldID09PSBvYmopIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFV0aWxzOyJdfQ==
