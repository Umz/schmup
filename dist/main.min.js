(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({"/Users/seanodonohue/myProjects/schmup-prototype/src/js/main.js":[function(require,module,exports){
'use strict';

var game = new Phaser.Game(800, 600, Phaser.AUTO, 'schmup-game');

var width = 800;
var height = 600;

window.Utils = require('./utils');
window.playerState = {
    currentLevel: 'Game'
}



game.state.add('Boot', require('./states/boot'));
game.state.add('Splash', require('./states/splash'));
game.state.add('Preloader', require('./states/preloader'));
game.state.add('Menu', require('./states/menu'));
game.state.add('Game', require('./states/game'));

game.state.start('Boot');

},{"./states/boot":"/Users/seanodonohue/myProjects/schmup-prototype/src/js/states/boot.js","./states/game":"/Users/seanodonohue/myProjects/schmup-prototype/src/js/states/game.js","./states/menu":"/Users/seanodonohue/myProjects/schmup-prototype/src/js/states/menu.js","./states/preloader":"/Users/seanodonohue/myProjects/schmup-prototype/src/js/states/preloader.js","./states/splash":"/Users/seanodonohue/myProjects/schmup-prototype/src/js/states/splash.js","./utils":"/Users/seanodonohue/myProjects/schmup-prototype/src/js/utils.js"}],"/Users/seanodonohue/myProjects/schmup-prototype/src/js/states/boot.js":[function(require,module,exports){
var Boot = function () {};

module.exports = Boot;

Boot.prototype = {

  preload: function () {
    this.load.image('preloader', 'assets/preloader.gif');
  },

  create: function () {
    this.game.input.maxPointers = 1;

    if (this.game.device.desktop) {
      this.game.stage.scale.pageAlignHorizontally = true;
    } else {
      this.game.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL;
      this.game.scale.minWidth =  800;
      this.game.scale.minHeight = 600;
      this.game.scale.maxWidth = 800;
      this.game.scale.maxHeight = 600;
      this.game.scale.forceLandscape = true;
      this.game.scale.pageAlignHorizontally = true;
      this.game.scale.setScreenSize(true);
    }

    this.game.state.start('Preloader');
  }
};

},{}],"/Users/seanodonohue/myProjects/schmup-prototype/src/js/states/game.js":[function(require,module,exports){
'use strict';
var player;
var playerShields;

var gameOver;

var score = 0;
var scoreText;

var droneScouts;
var enemyReleaseCounter = 0;

var starfield;

var explosions;
var bullets;
var firingSpeed = 3;
var bulletCounter = firingSpeed;

var cursors;
var fireButton;

var ship = {
  acceleration: 600,
  drag: 350,
  maxSpeed: 400
};
var shipTrail;

var Game = function() {
  this.testentity = null;
};

module.exports = Game;

Game.prototype = {

  create: function() {

    //  The scrolling starfield background
    starfield = this.add.tileSprite(0, 0, 800, 600, 'starfield');

    // The player's ship
    player = this.add.sprite(400, 500, 'ship');
    this.physics.arcade.enable(player);
    player.events.onKilled.add(function() {
      shipTrail.kill();
    });

    //Ship HUD and stats
    player.health = 100;
    playerShields = this.add.text(this.world.width - 150, 10, 'Shields: ' + player.health + '%', {
      font: '20px Arial',
      fill: '#fff'
    });
    playerShields.render = function() {
      playerShields.text = 'Shields: ' + Math.max(player.health, 0) + '%';
    };

    // Score
    scoreText = this.add.text(10, 10, '', {font: '20px Arial', fill: '#fff'});
    scoreText.render = function() {
      scoreText.text = 'Score: ' + score;
    };
    scoreText.render();

    // Set ship physics
    player.body
      .maxVelocity.setTo(ship.maxSpeed, ship.maxSpeed);
    player.body
      .drag.setTo(ship.drag, ship.drag);
    player.anchor.setTo(0.5, 0.5);

    // Set ship trail emitter
    shipTrail = this.add.emitter(player.x, player.y + 40, 400);
    shipTrail.width = 10;
    shipTrail.makeParticles('plasma');
    shipTrail.setXSpeed(30, -30);
    shipTrail.setYSpeed(200, 180);
    shipTrail.setRotation(50, -50);
    shipTrail.setAlpha(1, 0.01, 800);
    shipTrail.setScale(0.05, 0.4, 0.05, 0.4, 2000, Phaser.Easing.Quintic.Out);
    shipTrail.start(false, 5000, 10);

    // Set controls
    cursors = this.input.keyboard.createCursorKeys();
    fireButton = this.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);

    // Enemies -- Drones
    droneScouts = this.add.group();
    droneScouts.enableBody = true;
    droneScouts.physicsBodyType = Phaser.Physics.ARCADE;
    droneScouts.createMultiple(5, 'droneScout');
    droneScouts.setAll('anchor.x', 0.5);
    droneScouts.setAll('anchor.y', 0.5);
    droneScouts.setAll('angle', 180);
    droneScouts.setAll('outOfBoundsKill', true);
    droneScouts.setAll('checkWorldBounds', true);
    droneScouts.forEach(function(enemy) {
      enemy.damageAmount = 20;
      enemy.level = 2;
    });

    // Broken enemy trail emitter code

    // droneScouts.forEach(function(enemy) {
    //   addEnemyEmitterTrail(enemy);
    //   enemy.events.onKilled.add(function() {
    //     enemy.trail.kill();
    //   });
    // });
    // function addEnemyEmitterTrail(enemy) {
    //     var enemyTrail = droneScouts.game.add.emitter(enemy.x, enemy.y - 25, 100);
    //     enemyTrail.width = 10;
    //     enemyTrail.makeParticles('enemyTrail', [1, 2, 3, 4, 5]);
    //     enemyTrail.setXSpeed(20, -20);
    //     enemyTrail.setRotation(50, -50);
    //     enemyTrail.setAlpha(0.4, 0, 800);
    //     enemyTrail.setScale(0.01, 0.1, 0.01, 0.1, 1000, Phaser.Easing.Quintic.Out);
    //     enemy.trail = enemyTrail;
    //   }

    this.launchEnemies(this.randomIntegerFrom(3, 5), droneScouts);

    // The bullet group
    bullets = this.add.group();
    bullets.enableBody = true;
    bullets.physicsBodyType = Phaser.Physics.ARCADE;
    bullets.createMultiple(30, 'bullet');
    bullets.setAll('anchor.x', 0.5);
    bullets.setAll('anchor.y', 1);
    bullets.setAll('outOfBoundsKill', true);
    bullets.setAll('checkWorldBounds', true);

    // Explosion group
    explosions = this.add.group();
    explosions.enableBody = true;
    explosions.physicsBodyType = Phaser.Physics.ARCADE;
    explosions.createMultiple(30, 'explosion');
    explosions.setAll('anchor.x', 0.5);
    explosions.setAll('anchor.y', 0.5);
    explosions.forEach(function(explosion) {
      explosion.animations.add('explosion');
    });

    // Messages
    gameOver = this.add.text(this.world.centerX, this.world.centerY, 'GAME OVER!', {
      FONT: '84px Arial',
      fill: '#fff'
    });
    gameOver.anchor.setTo(0.5, 0.5);
    gameOver.visible = false;

  },

  update: function() {
    starfield.tilePosition.y += 2;

    enemyReleaseCounter++;
    
    if (enemyReleaseCounter % 185 === 0) {
      this.launchEnemies(this.randomIntegerFrom(3, 7), droneScouts);
    }

    // Check collisions
    this.physics.arcade.overlap(player, droneScouts, shipCollide, null, this);
    this.physics.arcade.overlap(bullets, droneScouts, hitEnemy, null, this);

    // Check for Game Over
    if (!player.alive && gameOver.visible == false) {
      gameOver.visible = true;
      gameOver.alpha = 0;
      var fadeInGameOver = this.add.tween(gameOver);
      fadeInGameOver.to({
        alpha: 1
      }, 1000, Phaser.Easing.Quintic.Out);
      fadeInGameOver.onComplete.add(setResetHandlers);
      fadeInGameOver.start();

      function setResetHandlers() {
        // Reset logic goes here...
      }
    }

    player.body.acceleration.x = 0;

    if (cursors.left.isDown) {
      player.body.acceleration.x = -ship.acceleration;
    } else if (cursors.right.isDown) {
      player.body.acceleration.x = ship.acceleration;
    }

    if (player.alive && fireButton.isDown) {
      fireBullet();
    }

    // TODO: Refactor to be DRY
    if (player.x > 750) {
      player.x = 750;
      player.body.acceleration.x = 0;
    }
    if (player.x < 50) {
      player.x = 50;
      player.body.acceleration.x = 0;
    }

    // Ship banking logic
    // TODO: put this in the ship object
    var bank = player.body.velocity.x / ship.maxSpeed;
    player.scale.x = 1 - Math.abs(bank) / 4;
    player.angle = bank * 5;

    shipTrail.x = player.x;

    function fireBullet() {

      var bullet = bullets.getFirstExists(false);
      var bulletSpeed = 400;

      if (bulletCounter > firingSpeed) {

        bulletCounter = 0;

        // Bullet physics
        if (bullet) {
          bullet.reset(player.x, player.y - 25);

          bullet.body.velocity.y = -200;
          bullet.body.velocity.x += player.body.velocity.x / 5;
          console.log("Firing attempt");
          // Firing speed logic
          // bulletTimer = Game.time.now += firingDelay;
        }
      }
      bulletCounter++;
    }

    function shipCollide(player, enemy) {
      var explosion = explosions.getFirstExists(false);
      explosion.reset(enemy.body.x + enemy.body.halfWidth, enemy.body.y + enemy.body.halfHeight);
      explosion.body.velocity.y = enemy.body.velocity.y;
      explosion.alpha = 0.7;
      explosion.play('explosion', 30, false, true);
      enemy.kill();

      player.damage(enemy.damageAmount);
      playerShields.render();
      addPointsForKilling(enemy);
    }

    function hitEnemy(bullet, enemy) {
      var explosion = explosions.getFirstExists(false);
      explosion.reset(enemy.body.x + enemy.body.halfWidth, enemy.body.y + enemy.body.halfHeight);
      explosion.body.velocity.y = enemy.body.velocity.y;
      explosion.alpha = 0.7;
      explosion.play('explosion', 30, false, true);
      enemy.kill();
      bullet.kill();
      addPointsForKilling(enemy);
    }

    function addPointsForKilling(enemy) {
      console.log(enemy);
      console.log(enemy.level);
      console.log(enemy.damageAmount);
      score += enemy.damageAmount * enemy.level;
      scoreText.render();
    }

  },

  launchEnemies: function(quantity, enemyGroup) {
    var game = this;
    for (var i = 0; i < quantity; i++) {
      launchEnemy();
    }

    function launchEnemy() {
      var minSpacing = 300;
      var maxSpacing = 3000;
      var enemySpeed = 300;
      var enemyLocation = game.randomIntegerFrom(50, 750);

      var enemy = enemyGroup.getFirstExists(false);
      if (enemy) {
        enemy.reset(enemyLocation, -20);
        enemy.body.velocity.x = game.randomIntegerFrom(-300, 300);
        enemy.body.velocity.y = enemySpeed;
        enemy.body.drag.x = 100;

        // More broken enemy trail code.
        // enemy.trail.start(false, 800, 1);

        enemy.update = function() {
          // enemy.trail.x = enemy.x;
          // enemy.trail.y = enemy.y - 10;
        }
      }
    }
  },

  restart: function () {
    droneScouts.callAll('kill');
    enemyReleaseCounter = 0;
    player.revive();
    player.health = 100;
    shields.render();
    score = 0;
    scoreText.render();
    gameOver.visible = false;
  },

  // Utility functions
  randomIntegerFrom: function(min, max) {
    return Math.floor(Math.random() * (max - min) + min + 1);
  },

  onInputDown: function() {
    this.game.state.start('Menu');
  }
};
},{}],"/Users/seanodonohue/myProjects/schmup-prototype/src/js/states/menu.js":[function(require,module,exports){
var Menu = function () {
  this.text = null;
  this.subtitle = null;
};

module.exports = Menu;

Menu.prototype = {

  create: function () {
    var x = this.game.width / 2;
    var y = this.game.height / 2;

    var titleStyle = { font: "65px Arial", fill: "#ffffff", align: "center" };
    var subtitleStyle = { font: "24px Arial", fill: "#ffffff", align: "center" };

    this.text = this.add.text(x - 300, y - 200, "Click to Start", titleStyle);
    this.subtitle = this.add.text(x - 300, y - 100, "Arrow keys to move, Space to fire", subtitleStyle);

    this.input.onDown.add(this.onDown, this);
  },

  update: function () {
  },

  onDown: function () {
    this.game.state.start(playerState.currentLevel);
  }
};

},{}],"/Users/seanodonohue/myProjects/schmup-prototype/src/js/states/preloader.js":[function(require,module,exports){
var Preloader = function (game) {
  this.asset = null;
  this.ready = false;
};

module.exports = Preloader;


Preloader.prototype = {

  preload: function () {
    this.asset = this.add.sprite(320, 240, 'preloader');
    this.asset.anchor.setTo(0.5, 0.5);

    this.physics.startSystem(Phaser.Physics.ARCADE);

    this.load.onLoadComplete.addOnce(this.onLoadComplete, this);
    this.load.setPreloadSprite(this.asset);
    this.load.image('starfield', 'assets/starfield.png');
    this.load.image('ship', 'assets/player.png');
    this.load.image('plasma', 'assets/bluePlasma.png');
    this.load.image('laser', 'assets/blueLaser.png');
    this.load.image('bullet', 'assets/blueBullet.png');
    this.load.image('droneScout', 'assets/droneScout.png');
    this.load.image('enemyTrail', 'assets/enemyTrail.png');
    this.load.spritesheet('explosion', 'assets/explosion.png', 128, 128);
  },

  create: function () {
    this.asset.cropEnabled = false;
  },

  update: function () {
    if (!!this.ready) {
      this.game.state.start('Menu');
    }
  },

  onLoadComplete: function () {
    this.ready = true;
  }
};

},{}],"/Users/seanodonohue/myProjects/schmup-prototype/src/js/states/splash.js":[function(require,module,exports){
var Splash = function () {
};

module.exports = Splash;

Splash.prototype = {
  create: function () {
  }
};
},{}],"/Users/seanodonohue/myProjects/schmup-prototype/src/js/utils.js":[function(require,module,exports){
var Utils = {
    containsObject: function(obj, list) {
        var i;
        for (i = 0; i < list.length; i++) {
            if (list[i] === obj) {
                return true;
            }
        }

        return false;
    }
};

module.exports = Utils;
},{}]},{},["/Users/seanodonohue/myProjects/schmup-prototype/src/js/main.js"])
//# sourceMappingURL=data:application/json;charset:utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvanMvbWFpbi5qcyIsInNyYy9qcy9zdGF0ZXMvYm9vdC5qcyIsInNyYy9qcy9zdGF0ZXMvZ2FtZS5qcyIsInNyYy9qcy9zdGF0ZXMvbWVudS5qcyIsInNyYy9qcy9zdGF0ZXMvcHJlbG9hZGVyLmpzIiwic3JjL2pzL3N0YXRlcy9zcGxhc2guanMiLCJzcmMvanMvdXRpbHMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaFVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM3QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIid1c2Ugc3RyaWN0JztcblxudmFyIGdhbWUgPSBuZXcgUGhhc2VyLkdhbWUoODAwLCA2MDAsIFBoYXNlci5BVVRPLCAnc2NobXVwLWdhbWUnKTtcblxudmFyIHdpZHRoID0gODAwO1xudmFyIGhlaWdodCA9IDYwMDtcblxud2luZG93LlV0aWxzID0gcmVxdWlyZSgnLi91dGlscycpO1xud2luZG93LnBsYXllclN0YXRlID0ge1xuICAgIGN1cnJlbnRMZXZlbDogJ0dhbWUnXG59XG5cblxuXG5nYW1lLnN0YXRlLmFkZCgnQm9vdCcsIHJlcXVpcmUoJy4vc3RhdGVzL2Jvb3QnKSk7XG5nYW1lLnN0YXRlLmFkZCgnU3BsYXNoJywgcmVxdWlyZSgnLi9zdGF0ZXMvc3BsYXNoJykpO1xuZ2FtZS5zdGF0ZS5hZGQoJ1ByZWxvYWRlcicsIHJlcXVpcmUoJy4vc3RhdGVzL3ByZWxvYWRlcicpKTtcbmdhbWUuc3RhdGUuYWRkKCdNZW51JywgcmVxdWlyZSgnLi9zdGF0ZXMvbWVudScpKTtcbmdhbWUuc3RhdGUuYWRkKCdHYW1lJywgcmVxdWlyZSgnLi9zdGF0ZXMvZ2FtZScpKTtcblxuZ2FtZS5zdGF0ZS5zdGFydCgnQm9vdCcpO1xuIiwidmFyIEJvb3QgPSBmdW5jdGlvbiAoKSB7fTtcblxubW9kdWxlLmV4cG9ydHMgPSBCb290O1xuXG5Cb290LnByb3RvdHlwZSA9IHtcblxuICBwcmVsb2FkOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5sb2FkLmltYWdlKCdwcmVsb2FkZXInLCAnYXNzZXRzL3ByZWxvYWRlci5naWYnKTtcbiAgfSxcblxuICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmdhbWUuaW5wdXQubWF4UG9pbnRlcnMgPSAxO1xuXG4gICAgaWYgKHRoaXMuZ2FtZS5kZXZpY2UuZGVza3RvcCkge1xuICAgICAgdGhpcy5nYW1lLnN0YWdlLnNjYWxlLnBhZ2VBbGlnbkhvcml6b250YWxseSA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZ2FtZS5zY2FsZS5zY2FsZU1vZGUgPSBQaGFzZXIuU2NhbGVNYW5hZ2VyLlNIT1dfQUxMO1xuICAgICAgdGhpcy5nYW1lLnNjYWxlLm1pbldpZHRoID0gIDgwMDtcbiAgICAgIHRoaXMuZ2FtZS5zY2FsZS5taW5IZWlnaHQgPSA2MDA7XG4gICAgICB0aGlzLmdhbWUuc2NhbGUubWF4V2lkdGggPSA4MDA7XG4gICAgICB0aGlzLmdhbWUuc2NhbGUubWF4SGVpZ2h0ID0gNjAwO1xuICAgICAgdGhpcy5nYW1lLnNjYWxlLmZvcmNlTGFuZHNjYXBlID0gdHJ1ZTtcbiAgICAgIHRoaXMuZ2FtZS5zY2FsZS5wYWdlQWxpZ25Ib3Jpem9udGFsbHkgPSB0cnVlO1xuICAgICAgdGhpcy5nYW1lLnNjYWxlLnNldFNjcmVlblNpemUodHJ1ZSk7XG4gICAgfVxuXG4gICAgdGhpcy5nYW1lLnN0YXRlLnN0YXJ0KCdQcmVsb2FkZXInKTtcbiAgfVxufTtcbiIsIid1c2Ugc3RyaWN0JztcbnZhciBwbGF5ZXI7XG52YXIgcGxheWVyU2hpZWxkcztcblxudmFyIGdhbWVPdmVyO1xuXG52YXIgc2NvcmUgPSAwO1xudmFyIHNjb3JlVGV4dDtcblxudmFyIGRyb25lU2NvdXRzO1xudmFyIGVuZW15UmVsZWFzZUNvdW50ZXIgPSAwO1xuXG52YXIgc3RhcmZpZWxkO1xuXG52YXIgZXhwbG9zaW9ucztcbnZhciBidWxsZXRzO1xudmFyIGZpcmluZ1NwZWVkID0gMztcbnZhciBidWxsZXRDb3VudGVyID0gZmlyaW5nU3BlZWQ7XG5cbnZhciBjdXJzb3JzO1xudmFyIGZpcmVCdXR0b247XG5cbnZhciBzaGlwID0ge1xuICBhY2NlbGVyYXRpb246IDYwMCxcbiAgZHJhZzogMzUwLFxuICBtYXhTcGVlZDogNDAwXG59O1xudmFyIHNoaXBUcmFpbDtcblxudmFyIEdhbWUgPSBmdW5jdGlvbigpIHtcbiAgdGhpcy50ZXN0ZW50aXR5ID0gbnVsbDtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gR2FtZTtcblxuR2FtZS5wcm90b3R5cGUgPSB7XG5cbiAgY3JlYXRlOiBmdW5jdGlvbigpIHtcblxuICAgIC8vICBUaGUgc2Nyb2xsaW5nIHN0YXJmaWVsZCBiYWNrZ3JvdW5kXG4gICAgc3RhcmZpZWxkID0gdGhpcy5hZGQudGlsZVNwcml0ZSgwLCAwLCA4MDAsIDYwMCwgJ3N0YXJmaWVsZCcpO1xuXG4gICAgLy8gVGhlIHBsYXllcidzIHNoaXBcbiAgICBwbGF5ZXIgPSB0aGlzLmFkZC5zcHJpdGUoNDAwLCA1MDAsICdzaGlwJyk7XG4gICAgdGhpcy5waHlzaWNzLmFyY2FkZS5lbmFibGUocGxheWVyKTtcbiAgICBwbGF5ZXIuZXZlbnRzLm9uS2lsbGVkLmFkZChmdW5jdGlvbigpIHtcbiAgICAgIHNoaXBUcmFpbC5raWxsKCk7XG4gICAgfSk7XG5cbiAgICAvL1NoaXAgSFVEIGFuZCBzdGF0c1xuICAgIHBsYXllci5oZWFsdGggPSAxMDA7XG4gICAgcGxheWVyU2hpZWxkcyA9IHRoaXMuYWRkLnRleHQodGhpcy53b3JsZC53aWR0aCAtIDE1MCwgMTAsICdTaGllbGRzOiAnICsgcGxheWVyLmhlYWx0aCArICclJywge1xuICAgICAgZm9udDogJzIwcHggQXJpYWwnLFxuICAgICAgZmlsbDogJyNmZmYnXG4gICAgfSk7XG4gICAgcGxheWVyU2hpZWxkcy5yZW5kZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgIHBsYXllclNoaWVsZHMudGV4dCA9ICdTaGllbGRzOiAnICsgTWF0aC5tYXgocGxheWVyLmhlYWx0aCwgMCkgKyAnJSc7XG4gICAgfTtcblxuICAgIC8vIFNjb3JlXG4gICAgc2NvcmVUZXh0ID0gdGhpcy5hZGQudGV4dCgxMCwgMTAsICcnLCB7Zm9udDogJzIwcHggQXJpYWwnLCBmaWxsOiAnI2ZmZid9KTtcbiAgICBzY29yZVRleHQucmVuZGVyID0gZnVuY3Rpb24oKSB7XG4gICAgICBzY29yZVRleHQudGV4dCA9ICdTY29yZTogJyArIHNjb3JlO1xuICAgIH07XG4gICAgc2NvcmVUZXh0LnJlbmRlcigpO1xuXG4gICAgLy8gU2V0IHNoaXAgcGh5c2ljc1xuICAgIHBsYXllci5ib2R5XG4gICAgICAubWF4VmVsb2NpdHkuc2V0VG8oc2hpcC5tYXhTcGVlZCwgc2hpcC5tYXhTcGVlZCk7XG4gICAgcGxheWVyLmJvZHlcbiAgICAgIC5kcmFnLnNldFRvKHNoaXAuZHJhZywgc2hpcC5kcmFnKTtcbiAgICBwbGF5ZXIuYW5jaG9yLnNldFRvKDAuNSwgMC41KTtcblxuICAgIC8vIFNldCBzaGlwIHRyYWlsIGVtaXR0ZXJcbiAgICBzaGlwVHJhaWwgPSB0aGlzLmFkZC5lbWl0dGVyKHBsYXllci54LCBwbGF5ZXIueSArIDQwLCA0MDApO1xuICAgIHNoaXBUcmFpbC53aWR0aCA9IDEwO1xuICAgIHNoaXBUcmFpbC5tYWtlUGFydGljbGVzKCdwbGFzbWEnKTtcbiAgICBzaGlwVHJhaWwuc2V0WFNwZWVkKDMwLCAtMzApO1xuICAgIHNoaXBUcmFpbC5zZXRZU3BlZWQoMjAwLCAxODApO1xuICAgIHNoaXBUcmFpbC5zZXRSb3RhdGlvbig1MCwgLTUwKTtcbiAgICBzaGlwVHJhaWwuc2V0QWxwaGEoMSwgMC4wMSwgODAwKTtcbiAgICBzaGlwVHJhaWwuc2V0U2NhbGUoMC4wNSwgMC40LCAwLjA1LCAwLjQsIDIwMDAsIFBoYXNlci5FYXNpbmcuUXVpbnRpYy5PdXQpO1xuICAgIHNoaXBUcmFpbC5zdGFydChmYWxzZSwgNTAwMCwgMTApO1xuXG4gICAgLy8gU2V0IGNvbnRyb2xzXG4gICAgY3Vyc29ycyA9IHRoaXMuaW5wdXQua2V5Ym9hcmQuY3JlYXRlQ3Vyc29yS2V5cygpO1xuICAgIGZpcmVCdXR0b24gPSB0aGlzLmlucHV0LmtleWJvYXJkLmFkZEtleShQaGFzZXIuS2V5Ym9hcmQuU1BBQ0VCQVIpO1xuXG4gICAgLy8gRW5lbWllcyAtLSBEcm9uZXNcbiAgICBkcm9uZVNjb3V0cyA9IHRoaXMuYWRkLmdyb3VwKCk7XG4gICAgZHJvbmVTY291dHMuZW5hYmxlQm9keSA9IHRydWU7XG4gICAgZHJvbmVTY291dHMucGh5c2ljc0JvZHlUeXBlID0gUGhhc2VyLlBoeXNpY3MuQVJDQURFO1xuICAgIGRyb25lU2NvdXRzLmNyZWF0ZU11bHRpcGxlKDUsICdkcm9uZVNjb3V0Jyk7XG4gICAgZHJvbmVTY291dHMuc2V0QWxsKCdhbmNob3IueCcsIDAuNSk7XG4gICAgZHJvbmVTY291dHMuc2V0QWxsKCdhbmNob3IueScsIDAuNSk7XG4gICAgZHJvbmVTY291dHMuc2V0QWxsKCdhbmdsZScsIDE4MCk7XG4gICAgZHJvbmVTY291dHMuc2V0QWxsKCdvdXRPZkJvdW5kc0tpbGwnLCB0cnVlKTtcbiAgICBkcm9uZVNjb3V0cy5zZXRBbGwoJ2NoZWNrV29ybGRCb3VuZHMnLCB0cnVlKTtcbiAgICBkcm9uZVNjb3V0cy5mb3JFYWNoKGZ1bmN0aW9uKGVuZW15KSB7XG4gICAgICBlbmVteS5kYW1hZ2VBbW91bnQgPSAyMDtcbiAgICAgIGVuZW15LmxldmVsID0gMjtcbiAgICB9KTtcblxuICAgIC8vIEJyb2tlbiBlbmVteSB0cmFpbCBlbWl0dGVyIGNvZGVcblxuICAgIC8vIGRyb25lU2NvdXRzLmZvckVhY2goZnVuY3Rpb24oZW5lbXkpIHtcbiAgICAvLyAgIGFkZEVuZW15RW1pdHRlclRyYWlsKGVuZW15KTtcbiAgICAvLyAgIGVuZW15LmV2ZW50cy5vbktpbGxlZC5hZGQoZnVuY3Rpb24oKSB7XG4gICAgLy8gICAgIGVuZW15LnRyYWlsLmtpbGwoKTtcbiAgICAvLyAgIH0pO1xuICAgIC8vIH0pO1xuICAgIC8vIGZ1bmN0aW9uIGFkZEVuZW15RW1pdHRlclRyYWlsKGVuZW15KSB7XG4gICAgLy8gICAgIHZhciBlbmVteVRyYWlsID0gZHJvbmVTY291dHMuZ2FtZS5hZGQuZW1pdHRlcihlbmVteS54LCBlbmVteS55IC0gMjUsIDEwMCk7XG4gICAgLy8gICAgIGVuZW15VHJhaWwud2lkdGggPSAxMDtcbiAgICAvLyAgICAgZW5lbXlUcmFpbC5tYWtlUGFydGljbGVzKCdlbmVteVRyYWlsJywgWzEsIDIsIDMsIDQsIDVdKTtcbiAgICAvLyAgICAgZW5lbXlUcmFpbC5zZXRYU3BlZWQoMjAsIC0yMCk7XG4gICAgLy8gICAgIGVuZW15VHJhaWwuc2V0Um90YXRpb24oNTAsIC01MCk7XG4gICAgLy8gICAgIGVuZW15VHJhaWwuc2V0QWxwaGEoMC40LCAwLCA4MDApO1xuICAgIC8vICAgICBlbmVteVRyYWlsLnNldFNjYWxlKDAuMDEsIDAuMSwgMC4wMSwgMC4xLCAxMDAwLCBQaGFzZXIuRWFzaW5nLlF1aW50aWMuT3V0KTtcbiAgICAvLyAgICAgZW5lbXkudHJhaWwgPSBlbmVteVRyYWlsO1xuICAgIC8vICAgfVxuXG4gICAgdGhpcy5sYXVuY2hFbmVtaWVzKHRoaXMucmFuZG9tSW50ZWdlckZyb20oMywgNSksIGRyb25lU2NvdXRzKTtcblxuICAgIC8vIFRoZSBidWxsZXQgZ3JvdXBcbiAgICBidWxsZXRzID0gdGhpcy5hZGQuZ3JvdXAoKTtcbiAgICBidWxsZXRzLmVuYWJsZUJvZHkgPSB0cnVlO1xuICAgIGJ1bGxldHMucGh5c2ljc0JvZHlUeXBlID0gUGhhc2VyLlBoeXNpY3MuQVJDQURFO1xuICAgIGJ1bGxldHMuY3JlYXRlTXVsdGlwbGUoMzAsICdidWxsZXQnKTtcbiAgICBidWxsZXRzLnNldEFsbCgnYW5jaG9yLngnLCAwLjUpO1xuICAgIGJ1bGxldHMuc2V0QWxsKCdhbmNob3IueScsIDEpO1xuICAgIGJ1bGxldHMuc2V0QWxsKCdvdXRPZkJvdW5kc0tpbGwnLCB0cnVlKTtcbiAgICBidWxsZXRzLnNldEFsbCgnY2hlY2tXb3JsZEJvdW5kcycsIHRydWUpO1xuXG4gICAgLy8gRXhwbG9zaW9uIGdyb3VwXG4gICAgZXhwbG9zaW9ucyA9IHRoaXMuYWRkLmdyb3VwKCk7XG4gICAgZXhwbG9zaW9ucy5lbmFibGVCb2R5ID0gdHJ1ZTtcbiAgICBleHBsb3Npb25zLnBoeXNpY3NCb2R5VHlwZSA9IFBoYXNlci5QaHlzaWNzLkFSQ0FERTtcbiAgICBleHBsb3Npb25zLmNyZWF0ZU11bHRpcGxlKDMwLCAnZXhwbG9zaW9uJyk7XG4gICAgZXhwbG9zaW9ucy5zZXRBbGwoJ2FuY2hvci54JywgMC41KTtcbiAgICBleHBsb3Npb25zLnNldEFsbCgnYW5jaG9yLnknLCAwLjUpO1xuICAgIGV4cGxvc2lvbnMuZm9yRWFjaChmdW5jdGlvbihleHBsb3Npb24pIHtcbiAgICAgIGV4cGxvc2lvbi5hbmltYXRpb25zLmFkZCgnZXhwbG9zaW9uJyk7XG4gICAgfSk7XG5cbiAgICAvLyBNZXNzYWdlc1xuICAgIGdhbWVPdmVyID0gdGhpcy5hZGQudGV4dCh0aGlzLndvcmxkLmNlbnRlclgsIHRoaXMud29ybGQuY2VudGVyWSwgJ0dBTUUgT1ZFUiEnLCB7XG4gICAgICBGT05UOiAnODRweCBBcmlhbCcsXG4gICAgICBmaWxsOiAnI2ZmZidcbiAgICB9KTtcbiAgICBnYW1lT3Zlci5hbmNob3Iuc2V0VG8oMC41LCAwLjUpO1xuICAgIGdhbWVPdmVyLnZpc2libGUgPSBmYWxzZTtcblxuICB9LFxuXG4gIHVwZGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgc3RhcmZpZWxkLnRpbGVQb3NpdGlvbi55ICs9IDI7XG5cbiAgICBlbmVteVJlbGVhc2VDb3VudGVyKys7XG4gICAgXG4gICAgaWYgKGVuZW15UmVsZWFzZUNvdW50ZXIgJSAxODUgPT09IDApIHtcbiAgICAgIHRoaXMubGF1bmNoRW5lbWllcyh0aGlzLnJhbmRvbUludGVnZXJGcm9tKDMsIDcpLCBkcm9uZVNjb3V0cyk7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgY29sbGlzaW9uc1xuICAgIHRoaXMucGh5c2ljcy5hcmNhZGUub3ZlcmxhcChwbGF5ZXIsIGRyb25lU2NvdXRzLCBzaGlwQ29sbGlkZSwgbnVsbCwgdGhpcyk7XG4gICAgdGhpcy5waHlzaWNzLmFyY2FkZS5vdmVybGFwKGJ1bGxldHMsIGRyb25lU2NvdXRzLCBoaXRFbmVteSwgbnVsbCwgdGhpcyk7XG5cbiAgICAvLyBDaGVjayBmb3IgR2FtZSBPdmVyXG4gICAgaWYgKCFwbGF5ZXIuYWxpdmUgJiYgZ2FtZU92ZXIudmlzaWJsZSA9PSBmYWxzZSkge1xuICAgICAgZ2FtZU92ZXIudmlzaWJsZSA9IHRydWU7XG4gICAgICBnYW1lT3Zlci5hbHBoYSA9IDA7XG4gICAgICB2YXIgZmFkZUluR2FtZU92ZXIgPSB0aGlzLmFkZC50d2VlbihnYW1lT3Zlcik7XG4gICAgICBmYWRlSW5HYW1lT3Zlci50byh7XG4gICAgICAgIGFscGhhOiAxXG4gICAgICB9LCAxMDAwLCBQaGFzZXIuRWFzaW5nLlF1aW50aWMuT3V0KTtcbiAgICAgIGZhZGVJbkdhbWVPdmVyLm9uQ29tcGxldGUuYWRkKHNldFJlc2V0SGFuZGxlcnMpO1xuICAgICAgZmFkZUluR2FtZU92ZXIuc3RhcnQoKTtcblxuICAgICAgZnVuY3Rpb24gc2V0UmVzZXRIYW5kbGVycygpIHtcbiAgICAgICAgLy8gUmVzZXQgbG9naWMgZ29lcyBoZXJlLi4uXG4gICAgICB9XG4gICAgfVxuXG4gICAgcGxheWVyLmJvZHkuYWNjZWxlcmF0aW9uLnggPSAwO1xuXG4gICAgaWYgKGN1cnNvcnMubGVmdC5pc0Rvd24pIHtcbiAgICAgIHBsYXllci5ib2R5LmFjY2VsZXJhdGlvbi54ID0gLXNoaXAuYWNjZWxlcmF0aW9uO1xuICAgIH0gZWxzZSBpZiAoY3Vyc29ycy5yaWdodC5pc0Rvd24pIHtcbiAgICAgIHBsYXllci5ib2R5LmFjY2VsZXJhdGlvbi54ID0gc2hpcC5hY2NlbGVyYXRpb247XG4gICAgfVxuXG4gICAgaWYgKHBsYXllci5hbGl2ZSAmJiBmaXJlQnV0dG9uLmlzRG93bikge1xuICAgICAgZmlyZUJ1bGxldCgpO1xuICAgIH1cblxuICAgIC8vIFRPRE86IFJlZmFjdG9yIHRvIGJlIERSWVxuICAgIGlmIChwbGF5ZXIueCA+IDc1MCkge1xuICAgICAgcGxheWVyLnggPSA3NTA7XG4gICAgICBwbGF5ZXIuYm9keS5hY2NlbGVyYXRpb24ueCA9IDA7XG4gICAgfVxuICAgIGlmIChwbGF5ZXIueCA8IDUwKSB7XG4gICAgICBwbGF5ZXIueCA9IDUwO1xuICAgICAgcGxheWVyLmJvZHkuYWNjZWxlcmF0aW9uLnggPSAwO1xuICAgIH1cblxuICAgIC8vIFNoaXAgYmFua2luZyBsb2dpY1xuICAgIC8vIFRPRE86IHB1dCB0aGlzIGluIHRoZSBzaGlwIG9iamVjdFxuICAgIHZhciBiYW5rID0gcGxheWVyLmJvZHkudmVsb2NpdHkueCAvIHNoaXAubWF4U3BlZWQ7XG4gICAgcGxheWVyLnNjYWxlLnggPSAxIC0gTWF0aC5hYnMoYmFuaykgLyA0O1xuICAgIHBsYXllci5hbmdsZSA9IGJhbmsgKiA1O1xuXG4gICAgc2hpcFRyYWlsLnggPSBwbGF5ZXIueDtcblxuICAgIGZ1bmN0aW9uIGZpcmVCdWxsZXQoKSB7XG5cbiAgICAgIHZhciBidWxsZXQgPSBidWxsZXRzLmdldEZpcnN0RXhpc3RzKGZhbHNlKTtcbiAgICAgIHZhciBidWxsZXRTcGVlZCA9IDQwMDtcblxuICAgICAgaWYgKGJ1bGxldENvdW50ZXIgPiBmaXJpbmdTcGVlZCkge1xuXG4gICAgICAgIGJ1bGxldENvdW50ZXIgPSAwO1xuXG4gICAgICAgIC8vIEJ1bGxldCBwaHlzaWNzXG4gICAgICAgIGlmIChidWxsZXQpIHtcbiAgICAgICAgICBidWxsZXQucmVzZXQocGxheWVyLngsIHBsYXllci55IC0gMjUpO1xuXG4gICAgICAgICAgYnVsbGV0LmJvZHkudmVsb2NpdHkueSA9IC0yMDA7XG4gICAgICAgICAgYnVsbGV0LmJvZHkudmVsb2NpdHkueCArPSBwbGF5ZXIuYm9keS52ZWxvY2l0eS54IC8gNTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIkZpcmluZyBhdHRlbXB0XCIpO1xuICAgICAgICAgIC8vIEZpcmluZyBzcGVlZCBsb2dpY1xuICAgICAgICAgIC8vIGJ1bGxldFRpbWVyID0gR2FtZS50aW1lLm5vdyArPSBmaXJpbmdEZWxheTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgYnVsbGV0Q291bnRlcisrO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNoaXBDb2xsaWRlKHBsYXllciwgZW5lbXkpIHtcbiAgICAgIHZhciBleHBsb3Npb24gPSBleHBsb3Npb25zLmdldEZpcnN0RXhpc3RzKGZhbHNlKTtcbiAgICAgIGV4cGxvc2lvbi5yZXNldChlbmVteS5ib2R5LnggKyBlbmVteS5ib2R5LmhhbGZXaWR0aCwgZW5lbXkuYm9keS55ICsgZW5lbXkuYm9keS5oYWxmSGVpZ2h0KTtcbiAgICAgIGV4cGxvc2lvbi5ib2R5LnZlbG9jaXR5LnkgPSBlbmVteS5ib2R5LnZlbG9jaXR5Lnk7XG4gICAgICBleHBsb3Npb24uYWxwaGEgPSAwLjc7XG4gICAgICBleHBsb3Npb24ucGxheSgnZXhwbG9zaW9uJywgMzAsIGZhbHNlLCB0cnVlKTtcbiAgICAgIGVuZW15LmtpbGwoKTtcblxuICAgICAgcGxheWVyLmRhbWFnZShlbmVteS5kYW1hZ2VBbW91bnQpO1xuICAgICAgcGxheWVyU2hpZWxkcy5yZW5kZXIoKTtcbiAgICAgIGFkZFBvaW50c0ZvcktpbGxpbmcoZW5lbXkpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGhpdEVuZW15KGJ1bGxldCwgZW5lbXkpIHtcbiAgICAgIHZhciBleHBsb3Npb24gPSBleHBsb3Npb25zLmdldEZpcnN0RXhpc3RzKGZhbHNlKTtcbiAgICAgIGV4cGxvc2lvbi5yZXNldChlbmVteS5ib2R5LnggKyBlbmVteS5ib2R5LmhhbGZXaWR0aCwgZW5lbXkuYm9keS55ICsgZW5lbXkuYm9keS5oYWxmSGVpZ2h0KTtcbiAgICAgIGV4cGxvc2lvbi5ib2R5LnZlbG9jaXR5LnkgPSBlbmVteS5ib2R5LnZlbG9jaXR5Lnk7XG4gICAgICBleHBsb3Npb24uYWxwaGEgPSAwLjc7XG4gICAgICBleHBsb3Npb24ucGxheSgnZXhwbG9zaW9uJywgMzAsIGZhbHNlLCB0cnVlKTtcbiAgICAgIGVuZW15LmtpbGwoKTtcbiAgICAgIGJ1bGxldC5raWxsKCk7XG4gICAgICBhZGRQb2ludHNGb3JLaWxsaW5nKGVuZW15KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBhZGRQb2ludHNGb3JLaWxsaW5nKGVuZW15KSB7XG4gICAgICBjb25zb2xlLmxvZyhlbmVteSk7XG4gICAgICBjb25zb2xlLmxvZyhlbmVteS5sZXZlbCk7XG4gICAgICBjb25zb2xlLmxvZyhlbmVteS5kYW1hZ2VBbW91bnQpO1xuICAgICAgc2NvcmUgKz0gZW5lbXkuZGFtYWdlQW1vdW50ICogZW5lbXkubGV2ZWw7XG4gICAgICBzY29yZVRleHQucmVuZGVyKCk7XG4gICAgfVxuXG4gIH0sXG5cbiAgbGF1bmNoRW5lbWllczogZnVuY3Rpb24ocXVhbnRpdHksIGVuZW15R3JvdXApIHtcbiAgICB2YXIgZ2FtZSA9IHRoaXM7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBxdWFudGl0eTsgaSsrKSB7XG4gICAgICBsYXVuY2hFbmVteSgpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGxhdW5jaEVuZW15KCkge1xuICAgICAgdmFyIG1pblNwYWNpbmcgPSAzMDA7XG4gICAgICB2YXIgbWF4U3BhY2luZyA9IDMwMDA7XG4gICAgICB2YXIgZW5lbXlTcGVlZCA9IDMwMDtcbiAgICAgIHZhciBlbmVteUxvY2F0aW9uID0gZ2FtZS5yYW5kb21JbnRlZ2VyRnJvbSg1MCwgNzUwKTtcblxuICAgICAgdmFyIGVuZW15ID0gZW5lbXlHcm91cC5nZXRGaXJzdEV4aXN0cyhmYWxzZSk7XG4gICAgICBpZiAoZW5lbXkpIHtcbiAgICAgICAgZW5lbXkucmVzZXQoZW5lbXlMb2NhdGlvbiwgLTIwKTtcbiAgICAgICAgZW5lbXkuYm9keS52ZWxvY2l0eS54ID0gZ2FtZS5yYW5kb21JbnRlZ2VyRnJvbSgtMzAwLCAzMDApO1xuICAgICAgICBlbmVteS5ib2R5LnZlbG9jaXR5LnkgPSBlbmVteVNwZWVkO1xuICAgICAgICBlbmVteS5ib2R5LmRyYWcueCA9IDEwMDtcblxuICAgICAgICAvLyBNb3JlIGJyb2tlbiBlbmVteSB0cmFpbCBjb2RlLlxuICAgICAgICAvLyBlbmVteS50cmFpbC5zdGFydChmYWxzZSwgODAwLCAxKTtcblxuICAgICAgICBlbmVteS51cGRhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAvLyBlbmVteS50cmFpbC54ID0gZW5lbXkueDtcbiAgICAgICAgICAvLyBlbmVteS50cmFpbC55ID0gZW5lbXkueSAtIDEwO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9LFxuXG4gIHJlc3RhcnQ6IGZ1bmN0aW9uICgpIHtcbiAgICBkcm9uZVNjb3V0cy5jYWxsQWxsKCdraWxsJyk7XG4gICAgZW5lbXlSZWxlYXNlQ291bnRlciA9IDA7XG4gICAgcGxheWVyLnJldml2ZSgpO1xuICAgIHBsYXllci5oZWFsdGggPSAxMDA7XG4gICAgc2hpZWxkcy5yZW5kZXIoKTtcbiAgICBzY29yZSA9IDA7XG4gICAgc2NvcmVUZXh0LnJlbmRlcigpO1xuICAgIGdhbWVPdmVyLnZpc2libGUgPSBmYWxzZTtcbiAgfSxcblxuICAvLyBVdGlsaXR5IGZ1bmN0aW9uc1xuICByYW5kb21JbnRlZ2VyRnJvbTogZnVuY3Rpb24obWluLCBtYXgpIHtcbiAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbikgKyBtaW4gKyAxKTtcbiAgfSxcblxuICBvbklucHV0RG93bjogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5nYW1lLnN0YXRlLnN0YXJ0KCdNZW51Jyk7XG4gIH1cbn07IiwidmFyIE1lbnUgPSBmdW5jdGlvbiAoKSB7XG4gIHRoaXMudGV4dCA9IG51bGw7XG4gIHRoaXMuc3VidGl0bGUgPSBudWxsO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBNZW51O1xuXG5NZW51LnByb3RvdHlwZSA9IHtcblxuICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgeCA9IHRoaXMuZ2FtZS53aWR0aCAvIDI7XG4gICAgdmFyIHkgPSB0aGlzLmdhbWUuaGVpZ2h0IC8gMjtcblxuICAgIHZhciB0aXRsZVN0eWxlID0geyBmb250OiBcIjY1cHggQXJpYWxcIiwgZmlsbDogXCIjZmZmZmZmXCIsIGFsaWduOiBcImNlbnRlclwiIH07XG4gICAgdmFyIHN1YnRpdGxlU3R5bGUgPSB7IGZvbnQ6IFwiMjRweCBBcmlhbFwiLCBmaWxsOiBcIiNmZmZmZmZcIiwgYWxpZ246IFwiY2VudGVyXCIgfTtcblxuICAgIHRoaXMudGV4dCA9IHRoaXMuYWRkLnRleHQoeCAtIDMwMCwgeSAtIDIwMCwgXCJDbGljayB0byBTdGFydFwiLCB0aXRsZVN0eWxlKTtcbiAgICB0aGlzLnN1YnRpdGxlID0gdGhpcy5hZGQudGV4dCh4IC0gMzAwLCB5IC0gMTAwLCBcIkFycm93IGtleXMgdG8gbW92ZSwgU3BhY2UgdG8gZmlyZVwiLCBzdWJ0aXRsZVN0eWxlKTtcblxuICAgIHRoaXMuaW5wdXQub25Eb3duLmFkZCh0aGlzLm9uRG93biwgdGhpcyk7XG4gIH0sXG5cbiAgdXBkYXRlOiBmdW5jdGlvbiAoKSB7XG4gIH0sXG5cbiAgb25Eb3duOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5nYW1lLnN0YXRlLnN0YXJ0KHBsYXllclN0YXRlLmN1cnJlbnRMZXZlbCk7XG4gIH1cbn07XG4iLCJ2YXIgUHJlbG9hZGVyID0gZnVuY3Rpb24gKGdhbWUpIHtcbiAgdGhpcy5hc3NldCA9IG51bGw7XG4gIHRoaXMucmVhZHkgPSBmYWxzZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUHJlbG9hZGVyO1xuXG5cblByZWxvYWRlci5wcm90b3R5cGUgPSB7XG5cbiAgcHJlbG9hZDogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuYXNzZXQgPSB0aGlzLmFkZC5zcHJpdGUoMzIwLCAyNDAsICdwcmVsb2FkZXInKTtcbiAgICB0aGlzLmFzc2V0LmFuY2hvci5zZXRUbygwLjUsIDAuNSk7XG5cbiAgICB0aGlzLnBoeXNpY3Muc3RhcnRTeXN0ZW0oUGhhc2VyLlBoeXNpY3MuQVJDQURFKTtcblxuICAgIHRoaXMubG9hZC5vbkxvYWRDb21wbGV0ZS5hZGRPbmNlKHRoaXMub25Mb2FkQ29tcGxldGUsIHRoaXMpO1xuICAgIHRoaXMubG9hZC5zZXRQcmVsb2FkU3ByaXRlKHRoaXMuYXNzZXQpO1xuICAgIHRoaXMubG9hZC5pbWFnZSgnc3RhcmZpZWxkJywgJ2Fzc2V0cy9zdGFyZmllbGQucG5nJyk7XG4gICAgdGhpcy5sb2FkLmltYWdlKCdzaGlwJywgJ2Fzc2V0cy9wbGF5ZXIucG5nJyk7XG4gICAgdGhpcy5sb2FkLmltYWdlKCdwbGFzbWEnLCAnYXNzZXRzL2JsdWVQbGFzbWEucG5nJyk7XG4gICAgdGhpcy5sb2FkLmltYWdlKCdsYXNlcicsICdhc3NldHMvYmx1ZUxhc2VyLnBuZycpO1xuICAgIHRoaXMubG9hZC5pbWFnZSgnYnVsbGV0JywgJ2Fzc2V0cy9ibHVlQnVsbGV0LnBuZycpO1xuICAgIHRoaXMubG9hZC5pbWFnZSgnZHJvbmVTY291dCcsICdhc3NldHMvZHJvbmVTY291dC5wbmcnKTtcbiAgICB0aGlzLmxvYWQuaW1hZ2UoJ2VuZW15VHJhaWwnLCAnYXNzZXRzL2VuZW15VHJhaWwucG5nJyk7XG4gICAgdGhpcy5sb2FkLnNwcml0ZXNoZWV0KCdleHBsb3Npb24nLCAnYXNzZXRzL2V4cGxvc2lvbi5wbmcnLCAxMjgsIDEyOCk7XG4gIH0sXG5cbiAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5hc3NldC5jcm9wRW5hYmxlZCA9IGZhbHNlO1xuICB9LFxuXG4gIHVwZGF0ZTogZnVuY3Rpb24gKCkge1xuICAgIGlmICghIXRoaXMucmVhZHkpIHtcbiAgICAgIHRoaXMuZ2FtZS5zdGF0ZS5zdGFydCgnTWVudScpO1xuICAgIH1cbiAgfSxcblxuICBvbkxvYWRDb21wbGV0ZTogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMucmVhZHkgPSB0cnVlO1xuICB9XG59O1xuIiwidmFyIFNwbGFzaCA9IGZ1bmN0aW9uICgpIHtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gU3BsYXNoO1xuXG5TcGxhc2gucHJvdG90eXBlID0ge1xuICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcbiAgfVxufTsiLCJ2YXIgVXRpbHMgPSB7XG4gICAgY29udGFpbnNPYmplY3Q6IGZ1bmN0aW9uKG9iaiwgbGlzdCkge1xuICAgICAgICB2YXIgaTtcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChsaXN0W2ldID09PSBvYmopIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFV0aWxzOyJdfQ==
