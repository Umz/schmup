(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({"/Users/seanodonohue/myProjects/schmup-prototype/src/js/main.js":[function(require,module,exports){
'use strict';

var game = new Phaser.Game(800, 600, Phaser.AUTO, 'schmup-game');

var width = 800;
var height = 600;

window.Utils = require('./utils');
window.playerState = {
    currentLevel: 'Game'
}



game.state.add('Boot', require('./states/boot'));
game.state.add('Splash', require('./states/splash'));
game.state.add('Preloader', require('./states/preloader'));
game.state.add('Menu', require('./states/menu'));
game.state.add('Game', require('./states/game'));

game.state.start('Boot');

},{"./states/boot":"/Users/seanodonohue/myProjects/schmup-prototype/src/js/states/boot.js","./states/game":"/Users/seanodonohue/myProjects/schmup-prototype/src/js/states/game.js","./states/menu":"/Users/seanodonohue/myProjects/schmup-prototype/src/js/states/menu.js","./states/preloader":"/Users/seanodonohue/myProjects/schmup-prototype/src/js/states/preloader.js","./states/splash":"/Users/seanodonohue/myProjects/schmup-prototype/src/js/states/splash.js","./utils":"/Users/seanodonohue/myProjects/schmup-prototype/src/js/utils.js"}],"/Users/seanodonohue/myProjects/schmup-prototype/src/js/states/boot.js":[function(require,module,exports){
var Boot = function () {};

module.exports = Boot;

Boot.prototype = {

  preload: function () {
    this.load.image('preloader', 'assets/preloader.gif');
  },

  create: function () {
    this.game.input.maxPointers = 1;

    if (this.game.device.desktop) {
      this.game.stage.scale.pageAlignHorizontally = true;
    } else {
      this.game.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL;
      this.game.scale.minWidth =  800;
      this.game.scale.minHeight = 600;
      this.game.scale.maxWidth = 800;
      this.game.scale.maxHeight = 600;
      this.game.scale.forceLandscape = true;
      this.game.scale.pageAlignHorizontally = true;
      this.game.scale.setScreenSize(true);
    }

    this.game.state.start('Preloader');
  }
};

},{}],"/Users/seanodonohue/myProjects/schmup-prototype/src/js/states/game.js":[function(require,module,exports){
'use strict';
var player;

var playerShields;
var gameOver;

var score = 0;
var scoreText;

var enemies;
var enemyOptions;
var droneScouts;
var droneFighters;
var droneBombers;
var enemyReleaseCounter = 0;

var starfield;

var explosions;
var bullets;
var firingSpeed = 10; // higher = slower
var bulletCounter = firingSpeed;

var cursors;
var fireButton;

var ship = {
  acceleration: 600,
  drag: 350,
  maxSpeed: 400
};
var shipTrail;

var Game = function() {
  this.testentity = null;
};

module.exports = Game;

Game.prototype = {

  create: function() {
    var game = this;

    //  The scrolling starfield background
    starfield = game.add.tileSprite(0, 0, 800, 600, 'starfield');

    // The player's ship
    player = game.add.sprite(400, 500, 'ship');
    game.physics.arcade.enable(player);
    player.events.onKilled.add(function() {
      shipTrail.kill();
    });

    // Set ship physics
    player.body
      .maxVelocity.setTo(ship.maxSpeed, ship.maxSpeed);
    player.body
      .drag.setTo(ship.drag, ship.drag);
    player.anchor.setTo(0.5, 0.5);

    // Set ship trail emitter
    shipTrail = game.add.emitter(player.x, player.y + 40, 400);
    shipTrail.width = 10;
    shipTrail.makeParticles('plasma');
    shipTrail.setXSpeed(30, -30);
    shipTrail.setYSpeed(200, 180);
    shipTrail.setRotation(50, -50);
    shipTrail.setAlpha(1, 0.01, 800);
    shipTrail.setScale(0.05, 0.4, 0.05, 0.4, 2000, Phaser.Easing.Quintic.Out);
    shipTrail.start(false, 5000, 10);

    // Set controls
    cursors = game.input.keyboard.createCursorKeys();
    fireButton = game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);

    // Creating enemies groups
    droneScouts = game.add.group();
    droneFighters = game.add.group();
    droneBombers = game.add.group();
    enemies = [
      droneScouts,
      droneFighters,
      droneBombers
    ];

    // Default enemy configuration
    enemies.forEach(function(group) {
      configureEnemies(group);
    });

    // Enemies -- Drone Scouts
    droneScouts.createMultiple(15, 'droneScout');
    droneScouts.minWaveTiming = 140;
    droneScouts.maxWaveTiming = 240;
    droneScouts.minWaveNumber = 3;
    droneScouts.maxWaveNumber = 7;
    droneScouts.forEach(function(enemy) {
      enemy.damageAmount = 10;
      enemy.level = 2;
      enemy.speed = 300;
      enemy.drag = 100;
    });

    // Enemies - Drone Fighters
    droneFighters.createMultiple(10, 'droneFighter');
    droneFighters.minWaveTiming = 190;
    droneFighters.maxWaveTiming = 350;
    droneFighters.minWaveNumber = 1;
    droneFighters.maxWaveNumber = 5;
    droneFighters.forEach(function(enemy) {
      enemy.damageAmount = 25;
      enemy.level = 3;
      enemy.speed = game.randomIntegerFrom(100, 400);
      enemy.drag = 50;
    });

    // Enemies = Drone Bombers
    droneBombers.createMultiple(5, 'droneBomber');
    droneBombers.minWaveTiming = 300;
    droneBombers.maxWaveTiming = 450;
    droneBombers.minWaveNumber = 1;
    droneBombers.maxWaveNumber = 2;
    droneBombers.forEach(function(enemy) {
      enemy.damageAmount = 50;
      enemy.level = 4;
      enemy.speed = 100;
      enemy.drag =  5;
    });

    function configureEnemies(group) {
      console.log(group);
      group.physicsBodyType = Phaser.Physics.ARCADE;
      group.enableBody = true;
      group.setAll('anchor.x', 0.5);
      group.setAll('anchor.y', 0.5);
      group.setAll('angle', 180);
      group.setAll('outOfBoundsKill', true);
      group.setAll('checkWorldBounds', true);
    }


    // Unused as of right now.
    function setEnemyAttributes(enemy, options) {
      options = options || {};
      game.physics.enable(enemy, Phaser.Physics.ARCADE);
      for (attr in options) {
        enemy[attr] = options[attr];
      }
    }

    game.launchEnemies(game.randomIntegerFrom(3, 5), droneScouts);

    // The bullet group
    bullets = game.add.group();
    bullets.enableBody = true;
    bullets.physicsBodyType = Phaser.Physics.ARCADE;
    bullets.createMultiple(15, 'bullet');
    bullets.setAll('anchor.x', 0.5);
    bullets.setAll('anchor.y', 1);
    bullets.setAll('outOfBoundsKill', true);
    bullets.setAll('checkWorldBounds', true);

    // Explosion group
    explosions = game.add.group();
    explosions.enableBody = true;
    explosions.physicsBodyType = Phaser.Physics.ARCADE;
    explosions.createMultiple(30, 'explosion');
    explosions.setAll('anchor.x', 0.5);
    explosions.setAll('anchor.y', 0.5);
    explosions.forEach(function(explosion) {
      explosion.animations.add('explosion');
    });

    //Ship HUD and stats
    player.health = 100;
    playerShields = game.add.bitmapText(game.world.width - 250, 10, 'spacefont', '' + player.health + '%', 20);
    playerShields.render = function() {
      playerShields.text = 'Shields: ' + Math.max(player.health, 0) + '%';
    };
    playerShields.render();

    // Score
    scoreText = game.add.bitmapText(10, 10, 'spacefont', '', 20);
    scoreText.render = function() {
      scoreText.text = 'Score: ' + score;
    };
    scoreText.render();

    // Messages
    gameOver = game.add.bitmapText(game.world.centerX, game.world.centerY, 'spacefont', 'GAME OVER!', 50);
    gameOver.x = gameOver.x - gameOver.textWidth / 2;
    gameOver.y = gameOver.y - gameOver.textHeight / 3;
    gameOver.visible = false;

  },

  update: function() {
    var game = this;

    starfield.tilePosition.y += 2;
    enemyReleaseCounter++;

    enemies.forEach(function(enemy) {
      checkWaveTimer(enemy);
      launchNewWaves(enemy);

      function checkWaveTimer(enemy) {
        console.log("wave timer", enemy.waveTimer);
        console.log(enemy.minWaveTiming);
        console.log(enemy.maxWaveTiming);
        if (!enemy.waveTimer) {
          enemy.waveTimer =
            roundToNearestTen(
              game.randomIntegerFrom(
                enemy.minWaveTiming,
                enemy.maxWaveTiming
              ));
        }

        function roundToNearestTen(num) {
          return Math.ceil(num / 10) * 10;
        }
      }

      function launchNewWaves(enemy) {
        if (enemyReleaseCounter % enemy.waveTimer === 0) {
          game.launchEnemies(
            game.randomIntegerFrom(
              enemy.minWaveNumber,
              enemy.maxWaveNumber),
            enemy);
          console.log("Wave launched?!");
          enemy.waveTimer = null;
        }
      }
    });

    checkCollisions();
    checkForGameOver();

    // Ship movement logic
    player.body.acceleration.x = 0;

    if (cursors.left.isDown) {
      player.body.acceleration.x = -ship.acceleration;
    } else if (cursors.right.isDown) {
      player.body.acceleration.x = ship.acceleration;
    }

    if (player.alive && fireButton.isDown) {
      fireBullet();
    }

    // TODO: Refactor to be DRY
    if (player.x > 750) {
      player.x = 750;
      player.body.acceleration.x = 0;
    }
    if (player.x < 50) {
      player.x = 50;
      player.body.acceleration.x = 0;
    }

    // Ship banking logic
    var bank = player.body.velocity.x / ship.maxSpeed;
    player.scale.x = 1 - Math.abs(bank) / 4;
    player.angle = bank * 5;

    shipTrail.x = player.x;

    function checkForGameOver() {
      if (!player.alive && gameOver.visible == false) {
        gameOver.visible = true;
        gameOver.alpha = 0;
        var fadeInGameOver = game.add.tween(gameOver);
        fadeInGameOver.to({
          alpha: 1
        }, 1000, Phaser.Easing.Quintic.Out);
        fadeInGameOver.onComplete.add(setResetHandlers);
        fadeInGameOver.start();

        function setResetHandlers() {
          var tapRestart = game.input.onTap.addOnce(_restart, game);
          var spaceRestart = fireButton.onDown.addOnce(_restart, game);

          function _restart() {
            tapRestart.detach();
            spaceRestart.detach();
            game.restart();
          }
        }
      }
    }

    function checkCollisions() {
      enemies.forEach(function(group) {
        game.physics.arcade.overlap(player, group, shipCollide, null, game);
        game.physics.arcade.overlap(bullets, group, hitEnemy, null, game);
      });
    }

    function fireBullet() {
      var bullet = bullets.getFirstExists(false);
      var bulletSpeed = 400;

      if (bulletCounter > firingSpeed) {

        bulletCounter = 0;

        // Bullet physics
        if (bullet) {
          bullet.reset(player.x, player.y - 25);

          bullet.body.velocity.y = -200;
          bullet.body.velocity.x += player.body.velocity.x / 5;
        }
      }
      bulletCounter++;
    }

    function shipCollide(player, enemy) {
      var explosion = explosions.getFirstExists(false);
      explosion.reset(enemy.body.x + enemy.body.halfWidth, enemy.body.y + enemy.body.halfHeight);
      explosion.body.velocity.y = enemy.body.velocity.y;
      explosion.alpha = 0.7;
      explosion.play('explosion', 30, false, true);
      enemy.kill();

      player.damage(enemy.damageAmount);
      playerShields.render();
      addPointsForKilling(enemy);
    }

    function hitEnemy(bullet, enemy) {
      var explosion = explosions.getFirstExists(false);
      explosion.reset(enemy.body.x + enemy.body.halfWidth, enemy.body.y + enemy.body.halfHeight);
      explosion.body.velocity.y = enemy.body.velocity.y;
      explosion.alpha = 0.7;
      explosion.play('explosion', 30, false, true);
      enemy.kill();
      bullet.kill();
      addPointsForKilling(enemy);
    }

    function addPointsForKilling(enemy) {
      score += enemy.damageAmount * enemy.level;
      scoreText.render();
    }

  },

  launchEnemies: function(quantity, enemyGroup) {
    var game = this;
    for (var i = 0; i < quantity; i++) {
      launchEnemy();
    }

    function launchEnemy() {
      var enemyLocation = game.randomIntegerFrom(50, 750);
      var enemy = enemyGroup.getFirstExists(false);
      if (enemy) {
        console.log(enemy);
        enemy.reset(enemyLocation, -20);
        enemy.body.velocity.x = game.randomIntegerFrom(-enemy.speed, enemy.speed);
        enemy.body.velocity.y = enemy.speed;
        enemy.body.drag.x = enemy.drag;
      }
    }
  },

  restart: function() {
    droneScouts.callAll('kill');
    enemyReleaseCounter = 0;
    player.revive();
    player.health = 100;
    playerShields.render();
    score = 0;
    scoreText.render();
    gameOver.visible = false;
  },

  // Utility functions
  randomIntegerFrom: function(min, max) {
    return Math.floor(Math.random() * (max - min) + min + 1);
  },

  onInputDown: function() {
    this.game.state.start('Menu');
  }
};
},{}],"/Users/seanodonohue/myProjects/schmup-prototype/src/js/states/menu.js":[function(require,module,exports){
var Menu = function () {
  this.text = null;
  this.subtitle = null;
};

module.exports = Menu;

Menu.prototype = {

  create: function () {
    var x = this.game.width / 2;
    var y = this.game.height / 2;

    this.text = this.add.bitmapText(x - 300, y - 200, 'spacefont', "Click to Start", 50);
    this.subtitle = this.add.bitmapText(x - 300, y - 100, 'spacefont', "Arrow keys to move, Space to fire", 20);

    this.input.onDown.add(this.onDown, this);
  },

  update: function () {
  },

  onDown: function () {
    this.game.state.start(playerState.currentLevel);
  }
};

},{}],"/Users/seanodonohue/myProjects/schmup-prototype/src/js/states/preloader.js":[function(require,module,exports){
var Preloader = function(game) {
  this.asset = null;
  this.ready = false;
};

module.exports = Preloader;


Preloader.prototype = {

  preload: function() {
    this.asset = this.add.sprite(320, 240, 'preloader');
    this.asset.anchor.setTo(0.5, 0.5);

    this.physics.startSystem(Phaser.Physics.ARCADE);

    this.load.onLoadComplete.addOnce(this.onLoadComplete, this);
    this.load.setPreloadSprite(this.asset);
    this.load.image('starfield', 'assets/starfield.png');
    this.load.image('ship', 'assets/player.png');
    this.load.image('plasma', 'assets/bluePlasma.png');
    this.load.image('laser', 'assets/blueLaser.png');
    this.load.image('bullet', 'assets/blueBullet.png');
    this.load.image('droneScout', 'assets/droneScout.png');
    this.load.image('droneFighter', 'assets/droneFighter.png');
    this.load.image('droneBomber', 'assets/droneBomber.png');
    this.load.image('enemyTrail', 'assets/enemyTrail.png');
    this.load.spritesheet('explosion', 'assets/explosion.png', 128, 128);
    this.load.bitmapFont('spacefont', 'assets/spacefont/spacefont.png', 'assets/spacefont/spacefont.fnt');
  },

  create: function() {
    this.asset.cropEnabled = false;
  },

  update: function() {
    if (!!this.ready) {
      this.game.state.start('Menu');
    }
  },

  onLoadComplete: function() {
    this.ready = true;
  }
};
},{}],"/Users/seanodonohue/myProjects/schmup-prototype/src/js/states/splash.js":[function(require,module,exports){
var Splash = function () {
};

module.exports = Splash;

Splash.prototype = {
  create: function () {
  }
};
},{}],"/Users/seanodonohue/myProjects/schmup-prototype/src/js/utils.js":[function(require,module,exports){
var Utils = {
    containsObject: function(obj, list) {
        var i;
        for (i = 0; i < list.length; i++) {
            if (list[i] === obj) {
                return true;
            }
        }

        return false;
    }
};

module.exports = Utils;
},{}]},{},["/Users/seanodonohue/myProjects/schmup-prototype/src/js/main.js"])
//# sourceMappingURL=data:application/json;charset:utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvanMvbWFpbi5qcyIsInNyYy9qcy9zdGF0ZXMvYm9vdC5qcyIsInNyYy9qcy9zdGF0ZXMvZ2FtZS5qcyIsInNyYy9qcy9zdGF0ZXMvbWVudS5qcyIsInNyYy9qcy9zdGF0ZXMvcHJlbG9hZGVyLmpzIiwic3JjL2pzL3N0YXRlcy9zcGxhc2guanMiLCJzcmMvanMvdXRpbHMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0WUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDNUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIid1c2Ugc3RyaWN0JztcblxudmFyIGdhbWUgPSBuZXcgUGhhc2VyLkdhbWUoODAwLCA2MDAsIFBoYXNlci5BVVRPLCAnc2NobXVwLWdhbWUnKTtcblxudmFyIHdpZHRoID0gODAwO1xudmFyIGhlaWdodCA9IDYwMDtcblxud2luZG93LlV0aWxzID0gcmVxdWlyZSgnLi91dGlscycpO1xud2luZG93LnBsYXllclN0YXRlID0ge1xuICAgIGN1cnJlbnRMZXZlbDogJ0dhbWUnXG59XG5cblxuXG5nYW1lLnN0YXRlLmFkZCgnQm9vdCcsIHJlcXVpcmUoJy4vc3RhdGVzL2Jvb3QnKSk7XG5nYW1lLnN0YXRlLmFkZCgnU3BsYXNoJywgcmVxdWlyZSgnLi9zdGF0ZXMvc3BsYXNoJykpO1xuZ2FtZS5zdGF0ZS5hZGQoJ1ByZWxvYWRlcicsIHJlcXVpcmUoJy4vc3RhdGVzL3ByZWxvYWRlcicpKTtcbmdhbWUuc3RhdGUuYWRkKCdNZW51JywgcmVxdWlyZSgnLi9zdGF0ZXMvbWVudScpKTtcbmdhbWUuc3RhdGUuYWRkKCdHYW1lJywgcmVxdWlyZSgnLi9zdGF0ZXMvZ2FtZScpKTtcblxuZ2FtZS5zdGF0ZS5zdGFydCgnQm9vdCcpO1xuIiwidmFyIEJvb3QgPSBmdW5jdGlvbiAoKSB7fTtcblxubW9kdWxlLmV4cG9ydHMgPSBCb290O1xuXG5Cb290LnByb3RvdHlwZSA9IHtcblxuICBwcmVsb2FkOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5sb2FkLmltYWdlKCdwcmVsb2FkZXInLCAnYXNzZXRzL3ByZWxvYWRlci5naWYnKTtcbiAgfSxcblxuICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmdhbWUuaW5wdXQubWF4UG9pbnRlcnMgPSAxO1xuXG4gICAgaWYgKHRoaXMuZ2FtZS5kZXZpY2UuZGVza3RvcCkge1xuICAgICAgdGhpcy5nYW1lLnN0YWdlLnNjYWxlLnBhZ2VBbGlnbkhvcml6b250YWxseSA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZ2FtZS5zY2FsZS5zY2FsZU1vZGUgPSBQaGFzZXIuU2NhbGVNYW5hZ2VyLlNIT1dfQUxMO1xuICAgICAgdGhpcy5nYW1lLnNjYWxlLm1pbldpZHRoID0gIDgwMDtcbiAgICAgIHRoaXMuZ2FtZS5zY2FsZS5taW5IZWlnaHQgPSA2MDA7XG4gICAgICB0aGlzLmdhbWUuc2NhbGUubWF4V2lkdGggPSA4MDA7XG4gICAgICB0aGlzLmdhbWUuc2NhbGUubWF4SGVpZ2h0ID0gNjAwO1xuICAgICAgdGhpcy5nYW1lLnNjYWxlLmZvcmNlTGFuZHNjYXBlID0gdHJ1ZTtcbiAgICAgIHRoaXMuZ2FtZS5zY2FsZS5wYWdlQWxpZ25Ib3Jpem9udGFsbHkgPSB0cnVlO1xuICAgICAgdGhpcy5nYW1lLnNjYWxlLnNldFNjcmVlblNpemUodHJ1ZSk7XG4gICAgfVxuXG4gICAgdGhpcy5nYW1lLnN0YXRlLnN0YXJ0KCdQcmVsb2FkZXInKTtcbiAgfVxufTtcbiIsIid1c2Ugc3RyaWN0JztcbnZhciBwbGF5ZXI7XG5cbnZhciBwbGF5ZXJTaGllbGRzO1xudmFyIGdhbWVPdmVyO1xuXG52YXIgc2NvcmUgPSAwO1xudmFyIHNjb3JlVGV4dDtcblxudmFyIGVuZW1pZXM7XG52YXIgZW5lbXlPcHRpb25zO1xudmFyIGRyb25lU2NvdXRzO1xudmFyIGRyb25lRmlnaHRlcnM7XG52YXIgZHJvbmVCb21iZXJzO1xudmFyIGVuZW15UmVsZWFzZUNvdW50ZXIgPSAwO1xuXG52YXIgc3RhcmZpZWxkO1xuXG52YXIgZXhwbG9zaW9ucztcbnZhciBidWxsZXRzO1xudmFyIGZpcmluZ1NwZWVkID0gMTA7IC8vIGhpZ2hlciA9IHNsb3dlclxudmFyIGJ1bGxldENvdW50ZXIgPSBmaXJpbmdTcGVlZDtcblxudmFyIGN1cnNvcnM7XG52YXIgZmlyZUJ1dHRvbjtcblxudmFyIHNoaXAgPSB7XG4gIGFjY2VsZXJhdGlvbjogNjAwLFxuICBkcmFnOiAzNTAsXG4gIG1heFNwZWVkOiA0MDBcbn07XG52YXIgc2hpcFRyYWlsO1xuXG52YXIgR2FtZSA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLnRlc3RlbnRpdHkgPSBudWxsO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBHYW1lO1xuXG5HYW1lLnByb3RvdHlwZSA9IHtcblxuICBjcmVhdGU6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBnYW1lID0gdGhpcztcblxuICAgIC8vICBUaGUgc2Nyb2xsaW5nIHN0YXJmaWVsZCBiYWNrZ3JvdW5kXG4gICAgc3RhcmZpZWxkID0gZ2FtZS5hZGQudGlsZVNwcml0ZSgwLCAwLCA4MDAsIDYwMCwgJ3N0YXJmaWVsZCcpO1xuXG4gICAgLy8gVGhlIHBsYXllcidzIHNoaXBcbiAgICBwbGF5ZXIgPSBnYW1lLmFkZC5zcHJpdGUoNDAwLCA1MDAsICdzaGlwJyk7XG4gICAgZ2FtZS5waHlzaWNzLmFyY2FkZS5lbmFibGUocGxheWVyKTtcbiAgICBwbGF5ZXIuZXZlbnRzLm9uS2lsbGVkLmFkZChmdW5jdGlvbigpIHtcbiAgICAgIHNoaXBUcmFpbC5raWxsKCk7XG4gICAgfSk7XG5cbiAgICAvLyBTZXQgc2hpcCBwaHlzaWNzXG4gICAgcGxheWVyLmJvZHlcbiAgICAgIC5tYXhWZWxvY2l0eS5zZXRUbyhzaGlwLm1heFNwZWVkLCBzaGlwLm1heFNwZWVkKTtcbiAgICBwbGF5ZXIuYm9keVxuICAgICAgLmRyYWcuc2V0VG8oc2hpcC5kcmFnLCBzaGlwLmRyYWcpO1xuICAgIHBsYXllci5hbmNob3Iuc2V0VG8oMC41LCAwLjUpO1xuXG4gICAgLy8gU2V0IHNoaXAgdHJhaWwgZW1pdHRlclxuICAgIHNoaXBUcmFpbCA9IGdhbWUuYWRkLmVtaXR0ZXIocGxheWVyLngsIHBsYXllci55ICsgNDAsIDQwMCk7XG4gICAgc2hpcFRyYWlsLndpZHRoID0gMTA7XG4gICAgc2hpcFRyYWlsLm1ha2VQYXJ0aWNsZXMoJ3BsYXNtYScpO1xuICAgIHNoaXBUcmFpbC5zZXRYU3BlZWQoMzAsIC0zMCk7XG4gICAgc2hpcFRyYWlsLnNldFlTcGVlZCgyMDAsIDE4MCk7XG4gICAgc2hpcFRyYWlsLnNldFJvdGF0aW9uKDUwLCAtNTApO1xuICAgIHNoaXBUcmFpbC5zZXRBbHBoYSgxLCAwLjAxLCA4MDApO1xuICAgIHNoaXBUcmFpbC5zZXRTY2FsZSgwLjA1LCAwLjQsIDAuMDUsIDAuNCwgMjAwMCwgUGhhc2VyLkVhc2luZy5RdWludGljLk91dCk7XG4gICAgc2hpcFRyYWlsLnN0YXJ0KGZhbHNlLCA1MDAwLCAxMCk7XG5cbiAgICAvLyBTZXQgY29udHJvbHNcbiAgICBjdXJzb3JzID0gZ2FtZS5pbnB1dC5rZXlib2FyZC5jcmVhdGVDdXJzb3JLZXlzKCk7XG4gICAgZmlyZUJ1dHRvbiA9IGdhbWUuaW5wdXQua2V5Ym9hcmQuYWRkS2V5KFBoYXNlci5LZXlib2FyZC5TUEFDRUJBUik7XG5cbiAgICAvLyBDcmVhdGluZyBlbmVtaWVzIGdyb3Vwc1xuICAgIGRyb25lU2NvdXRzID0gZ2FtZS5hZGQuZ3JvdXAoKTtcbiAgICBkcm9uZUZpZ2h0ZXJzID0gZ2FtZS5hZGQuZ3JvdXAoKTtcbiAgICBkcm9uZUJvbWJlcnMgPSBnYW1lLmFkZC5ncm91cCgpO1xuICAgIGVuZW1pZXMgPSBbXG4gICAgICBkcm9uZVNjb3V0cyxcbiAgICAgIGRyb25lRmlnaHRlcnMsXG4gICAgICBkcm9uZUJvbWJlcnNcbiAgICBdO1xuXG4gICAgLy8gRGVmYXVsdCBlbmVteSBjb25maWd1cmF0aW9uXG4gICAgZW5lbWllcy5mb3JFYWNoKGZ1bmN0aW9uKGdyb3VwKSB7XG4gICAgICBjb25maWd1cmVFbmVtaWVzKGdyb3VwKTtcbiAgICB9KTtcblxuICAgIC8vIEVuZW1pZXMgLS0gRHJvbmUgU2NvdXRzXG4gICAgZHJvbmVTY291dHMuY3JlYXRlTXVsdGlwbGUoMTUsICdkcm9uZVNjb3V0Jyk7XG4gICAgZHJvbmVTY291dHMubWluV2F2ZVRpbWluZyA9IDE0MDtcbiAgICBkcm9uZVNjb3V0cy5tYXhXYXZlVGltaW5nID0gMjQwO1xuICAgIGRyb25lU2NvdXRzLm1pbldhdmVOdW1iZXIgPSAzO1xuICAgIGRyb25lU2NvdXRzLm1heFdhdmVOdW1iZXIgPSA3O1xuICAgIGRyb25lU2NvdXRzLmZvckVhY2goZnVuY3Rpb24oZW5lbXkpIHtcbiAgICAgIGVuZW15LmRhbWFnZUFtb3VudCA9IDEwO1xuICAgICAgZW5lbXkubGV2ZWwgPSAyO1xuICAgICAgZW5lbXkuc3BlZWQgPSAzMDA7XG4gICAgICBlbmVteS5kcmFnID0gMTAwO1xuICAgIH0pO1xuXG4gICAgLy8gRW5lbWllcyAtIERyb25lIEZpZ2h0ZXJzXG4gICAgZHJvbmVGaWdodGVycy5jcmVhdGVNdWx0aXBsZSgxMCwgJ2Ryb25lRmlnaHRlcicpO1xuICAgIGRyb25lRmlnaHRlcnMubWluV2F2ZVRpbWluZyA9IDE5MDtcbiAgICBkcm9uZUZpZ2h0ZXJzLm1heFdhdmVUaW1pbmcgPSAzNTA7XG4gICAgZHJvbmVGaWdodGVycy5taW5XYXZlTnVtYmVyID0gMTtcbiAgICBkcm9uZUZpZ2h0ZXJzLm1heFdhdmVOdW1iZXIgPSA1O1xuICAgIGRyb25lRmlnaHRlcnMuZm9yRWFjaChmdW5jdGlvbihlbmVteSkge1xuICAgICAgZW5lbXkuZGFtYWdlQW1vdW50ID0gMjU7XG4gICAgICBlbmVteS5sZXZlbCA9IDM7XG4gICAgICBlbmVteS5zcGVlZCA9IGdhbWUucmFuZG9tSW50ZWdlckZyb20oMTAwLCA0MDApO1xuICAgICAgZW5lbXkuZHJhZyA9IDUwO1xuICAgIH0pO1xuXG4gICAgLy8gRW5lbWllcyA9IERyb25lIEJvbWJlcnNcbiAgICBkcm9uZUJvbWJlcnMuY3JlYXRlTXVsdGlwbGUoNSwgJ2Ryb25lQm9tYmVyJyk7XG4gICAgZHJvbmVCb21iZXJzLm1pbldhdmVUaW1pbmcgPSAzMDA7XG4gICAgZHJvbmVCb21iZXJzLm1heFdhdmVUaW1pbmcgPSA0NTA7XG4gICAgZHJvbmVCb21iZXJzLm1pbldhdmVOdW1iZXIgPSAxO1xuICAgIGRyb25lQm9tYmVycy5tYXhXYXZlTnVtYmVyID0gMjtcbiAgICBkcm9uZUJvbWJlcnMuZm9yRWFjaChmdW5jdGlvbihlbmVteSkge1xuICAgICAgZW5lbXkuZGFtYWdlQW1vdW50ID0gNTA7XG4gICAgICBlbmVteS5sZXZlbCA9IDQ7XG4gICAgICBlbmVteS5zcGVlZCA9IDEwMDtcbiAgICAgIGVuZW15LmRyYWcgPSAgNTtcbiAgICB9KTtcblxuICAgIGZ1bmN0aW9uIGNvbmZpZ3VyZUVuZW1pZXMoZ3JvdXApIHtcbiAgICAgIGNvbnNvbGUubG9nKGdyb3VwKTtcbiAgICAgIGdyb3VwLnBoeXNpY3NCb2R5VHlwZSA9IFBoYXNlci5QaHlzaWNzLkFSQ0FERTtcbiAgICAgIGdyb3VwLmVuYWJsZUJvZHkgPSB0cnVlO1xuICAgICAgZ3JvdXAuc2V0QWxsKCdhbmNob3IueCcsIDAuNSk7XG4gICAgICBncm91cC5zZXRBbGwoJ2FuY2hvci55JywgMC41KTtcbiAgICAgIGdyb3VwLnNldEFsbCgnYW5nbGUnLCAxODApO1xuICAgICAgZ3JvdXAuc2V0QWxsKCdvdXRPZkJvdW5kc0tpbGwnLCB0cnVlKTtcbiAgICAgIGdyb3VwLnNldEFsbCgnY2hlY2tXb3JsZEJvdW5kcycsIHRydWUpO1xuICAgIH1cblxuXG4gICAgLy8gVW51c2VkIGFzIG9mIHJpZ2h0IG5vdy5cbiAgICBmdW5jdGlvbiBzZXRFbmVteUF0dHJpYnV0ZXMoZW5lbXksIG9wdGlvbnMpIHtcbiAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgICAgZ2FtZS5waHlzaWNzLmVuYWJsZShlbmVteSwgUGhhc2VyLlBoeXNpY3MuQVJDQURFKTtcbiAgICAgIGZvciAoYXR0ciBpbiBvcHRpb25zKSB7XG4gICAgICAgIGVuZW15W2F0dHJdID0gb3B0aW9uc1thdHRyXTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBnYW1lLmxhdW5jaEVuZW1pZXMoZ2FtZS5yYW5kb21JbnRlZ2VyRnJvbSgzLCA1KSwgZHJvbmVTY291dHMpO1xuXG4gICAgLy8gVGhlIGJ1bGxldCBncm91cFxuICAgIGJ1bGxldHMgPSBnYW1lLmFkZC5ncm91cCgpO1xuICAgIGJ1bGxldHMuZW5hYmxlQm9keSA9IHRydWU7XG4gICAgYnVsbGV0cy5waHlzaWNzQm9keVR5cGUgPSBQaGFzZXIuUGh5c2ljcy5BUkNBREU7XG4gICAgYnVsbGV0cy5jcmVhdGVNdWx0aXBsZSgxNSwgJ2J1bGxldCcpO1xuICAgIGJ1bGxldHMuc2V0QWxsKCdhbmNob3IueCcsIDAuNSk7XG4gICAgYnVsbGV0cy5zZXRBbGwoJ2FuY2hvci55JywgMSk7XG4gICAgYnVsbGV0cy5zZXRBbGwoJ291dE9mQm91bmRzS2lsbCcsIHRydWUpO1xuICAgIGJ1bGxldHMuc2V0QWxsKCdjaGVja1dvcmxkQm91bmRzJywgdHJ1ZSk7XG5cbiAgICAvLyBFeHBsb3Npb24gZ3JvdXBcbiAgICBleHBsb3Npb25zID0gZ2FtZS5hZGQuZ3JvdXAoKTtcbiAgICBleHBsb3Npb25zLmVuYWJsZUJvZHkgPSB0cnVlO1xuICAgIGV4cGxvc2lvbnMucGh5c2ljc0JvZHlUeXBlID0gUGhhc2VyLlBoeXNpY3MuQVJDQURFO1xuICAgIGV4cGxvc2lvbnMuY3JlYXRlTXVsdGlwbGUoMzAsICdleHBsb3Npb24nKTtcbiAgICBleHBsb3Npb25zLnNldEFsbCgnYW5jaG9yLngnLCAwLjUpO1xuICAgIGV4cGxvc2lvbnMuc2V0QWxsKCdhbmNob3IueScsIDAuNSk7XG4gICAgZXhwbG9zaW9ucy5mb3JFYWNoKGZ1bmN0aW9uKGV4cGxvc2lvbikge1xuICAgICAgZXhwbG9zaW9uLmFuaW1hdGlvbnMuYWRkKCdleHBsb3Npb24nKTtcbiAgICB9KTtcblxuICAgIC8vU2hpcCBIVUQgYW5kIHN0YXRzXG4gICAgcGxheWVyLmhlYWx0aCA9IDEwMDtcbiAgICBwbGF5ZXJTaGllbGRzID0gZ2FtZS5hZGQuYml0bWFwVGV4dChnYW1lLndvcmxkLndpZHRoIC0gMjUwLCAxMCwgJ3NwYWNlZm9udCcsICcnICsgcGxheWVyLmhlYWx0aCArICclJywgMjApO1xuICAgIHBsYXllclNoaWVsZHMucmVuZGVyID0gZnVuY3Rpb24oKSB7XG4gICAgICBwbGF5ZXJTaGllbGRzLnRleHQgPSAnU2hpZWxkczogJyArIE1hdGgubWF4KHBsYXllci5oZWFsdGgsIDApICsgJyUnO1xuICAgIH07XG4gICAgcGxheWVyU2hpZWxkcy5yZW5kZXIoKTtcblxuICAgIC8vIFNjb3JlXG4gICAgc2NvcmVUZXh0ID0gZ2FtZS5hZGQuYml0bWFwVGV4dCgxMCwgMTAsICdzcGFjZWZvbnQnLCAnJywgMjApO1xuICAgIHNjb3JlVGV4dC5yZW5kZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgIHNjb3JlVGV4dC50ZXh0ID0gJ1Njb3JlOiAnICsgc2NvcmU7XG4gICAgfTtcbiAgICBzY29yZVRleHQucmVuZGVyKCk7XG5cbiAgICAvLyBNZXNzYWdlc1xuICAgIGdhbWVPdmVyID0gZ2FtZS5hZGQuYml0bWFwVGV4dChnYW1lLndvcmxkLmNlbnRlclgsIGdhbWUud29ybGQuY2VudGVyWSwgJ3NwYWNlZm9udCcsICdHQU1FIE9WRVIhJywgNTApO1xuICAgIGdhbWVPdmVyLnggPSBnYW1lT3Zlci54IC0gZ2FtZU92ZXIudGV4dFdpZHRoIC8gMjtcbiAgICBnYW1lT3Zlci55ID0gZ2FtZU92ZXIueSAtIGdhbWVPdmVyLnRleHRIZWlnaHQgLyAzO1xuICAgIGdhbWVPdmVyLnZpc2libGUgPSBmYWxzZTtcblxuICB9LFxuXG4gIHVwZGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGdhbWUgPSB0aGlzO1xuXG4gICAgc3RhcmZpZWxkLnRpbGVQb3NpdGlvbi55ICs9IDI7XG4gICAgZW5lbXlSZWxlYXNlQ291bnRlcisrO1xuXG4gICAgZW5lbWllcy5mb3JFYWNoKGZ1bmN0aW9uKGVuZW15KSB7XG4gICAgICBjaGVja1dhdmVUaW1lcihlbmVteSk7XG4gICAgICBsYXVuY2hOZXdXYXZlcyhlbmVteSk7XG5cbiAgICAgIGZ1bmN0aW9uIGNoZWNrV2F2ZVRpbWVyKGVuZW15KSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwid2F2ZSB0aW1lclwiLCBlbmVteS53YXZlVGltZXIpO1xuICAgICAgICBjb25zb2xlLmxvZyhlbmVteS5taW5XYXZlVGltaW5nKTtcbiAgICAgICAgY29uc29sZS5sb2coZW5lbXkubWF4V2F2ZVRpbWluZyk7XG4gICAgICAgIGlmICghZW5lbXkud2F2ZVRpbWVyKSB7XG4gICAgICAgICAgZW5lbXkud2F2ZVRpbWVyID1cbiAgICAgICAgICAgIHJvdW5kVG9OZWFyZXN0VGVuKFxuICAgICAgICAgICAgICBnYW1lLnJhbmRvbUludGVnZXJGcm9tKFxuICAgICAgICAgICAgICAgIGVuZW15Lm1pbldhdmVUaW1pbmcsXG4gICAgICAgICAgICAgICAgZW5lbXkubWF4V2F2ZVRpbWluZ1xuICAgICAgICAgICAgICApKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHJvdW5kVG9OZWFyZXN0VGVuKG51bSkge1xuICAgICAgICAgIHJldHVybiBNYXRoLmNlaWwobnVtIC8gMTApICogMTA7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gbGF1bmNoTmV3V2F2ZXMoZW5lbXkpIHtcbiAgICAgICAgaWYgKGVuZW15UmVsZWFzZUNvdW50ZXIgJSBlbmVteS53YXZlVGltZXIgPT09IDApIHtcbiAgICAgICAgICBnYW1lLmxhdW5jaEVuZW1pZXMoXG4gICAgICAgICAgICBnYW1lLnJhbmRvbUludGVnZXJGcm9tKFxuICAgICAgICAgICAgICBlbmVteS5taW5XYXZlTnVtYmVyLFxuICAgICAgICAgICAgICBlbmVteS5tYXhXYXZlTnVtYmVyKSxcbiAgICAgICAgICAgIGVuZW15KTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIldhdmUgbGF1bmNoZWQ/IVwiKTtcbiAgICAgICAgICBlbmVteS53YXZlVGltZXIgPSBudWxsO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBjaGVja0NvbGxpc2lvbnMoKTtcbiAgICBjaGVja0ZvckdhbWVPdmVyKCk7XG5cbiAgICAvLyBTaGlwIG1vdmVtZW50IGxvZ2ljXG4gICAgcGxheWVyLmJvZHkuYWNjZWxlcmF0aW9uLnggPSAwO1xuXG4gICAgaWYgKGN1cnNvcnMubGVmdC5pc0Rvd24pIHtcbiAgICAgIHBsYXllci5ib2R5LmFjY2VsZXJhdGlvbi54ID0gLXNoaXAuYWNjZWxlcmF0aW9uO1xuICAgIH0gZWxzZSBpZiAoY3Vyc29ycy5yaWdodC5pc0Rvd24pIHtcbiAgICAgIHBsYXllci5ib2R5LmFjY2VsZXJhdGlvbi54ID0gc2hpcC5hY2NlbGVyYXRpb247XG4gICAgfVxuXG4gICAgaWYgKHBsYXllci5hbGl2ZSAmJiBmaXJlQnV0dG9uLmlzRG93bikge1xuICAgICAgZmlyZUJ1bGxldCgpO1xuICAgIH1cblxuICAgIC8vIFRPRE86IFJlZmFjdG9yIHRvIGJlIERSWVxuICAgIGlmIChwbGF5ZXIueCA+IDc1MCkge1xuICAgICAgcGxheWVyLnggPSA3NTA7XG4gICAgICBwbGF5ZXIuYm9keS5hY2NlbGVyYXRpb24ueCA9IDA7XG4gICAgfVxuICAgIGlmIChwbGF5ZXIueCA8IDUwKSB7XG4gICAgICBwbGF5ZXIueCA9IDUwO1xuICAgICAgcGxheWVyLmJvZHkuYWNjZWxlcmF0aW9uLnggPSAwO1xuICAgIH1cblxuICAgIC8vIFNoaXAgYmFua2luZyBsb2dpY1xuICAgIHZhciBiYW5rID0gcGxheWVyLmJvZHkudmVsb2NpdHkueCAvIHNoaXAubWF4U3BlZWQ7XG4gICAgcGxheWVyLnNjYWxlLnggPSAxIC0gTWF0aC5hYnMoYmFuaykgLyA0O1xuICAgIHBsYXllci5hbmdsZSA9IGJhbmsgKiA1O1xuXG4gICAgc2hpcFRyYWlsLnggPSBwbGF5ZXIueDtcblxuICAgIGZ1bmN0aW9uIGNoZWNrRm9yR2FtZU92ZXIoKSB7XG4gICAgICBpZiAoIXBsYXllci5hbGl2ZSAmJiBnYW1lT3Zlci52aXNpYmxlID09IGZhbHNlKSB7XG4gICAgICAgIGdhbWVPdmVyLnZpc2libGUgPSB0cnVlO1xuICAgICAgICBnYW1lT3Zlci5hbHBoYSA9IDA7XG4gICAgICAgIHZhciBmYWRlSW5HYW1lT3ZlciA9IGdhbWUuYWRkLnR3ZWVuKGdhbWVPdmVyKTtcbiAgICAgICAgZmFkZUluR2FtZU92ZXIudG8oe1xuICAgICAgICAgIGFscGhhOiAxXG4gICAgICAgIH0sIDEwMDAsIFBoYXNlci5FYXNpbmcuUXVpbnRpYy5PdXQpO1xuICAgICAgICBmYWRlSW5HYW1lT3Zlci5vbkNvbXBsZXRlLmFkZChzZXRSZXNldEhhbmRsZXJzKTtcbiAgICAgICAgZmFkZUluR2FtZU92ZXIuc3RhcnQoKTtcblxuICAgICAgICBmdW5jdGlvbiBzZXRSZXNldEhhbmRsZXJzKCkge1xuICAgICAgICAgIHZhciB0YXBSZXN0YXJ0ID0gZ2FtZS5pbnB1dC5vblRhcC5hZGRPbmNlKF9yZXN0YXJ0LCBnYW1lKTtcbiAgICAgICAgICB2YXIgc3BhY2VSZXN0YXJ0ID0gZmlyZUJ1dHRvbi5vbkRvd24uYWRkT25jZShfcmVzdGFydCwgZ2FtZSk7XG5cbiAgICAgICAgICBmdW5jdGlvbiBfcmVzdGFydCgpIHtcbiAgICAgICAgICAgIHRhcFJlc3RhcnQuZGV0YWNoKCk7XG4gICAgICAgICAgICBzcGFjZVJlc3RhcnQuZGV0YWNoKCk7XG4gICAgICAgICAgICBnYW1lLnJlc3RhcnQoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjaGVja0NvbGxpc2lvbnMoKSB7XG4gICAgICBlbmVtaWVzLmZvckVhY2goZnVuY3Rpb24oZ3JvdXApIHtcbiAgICAgICAgZ2FtZS5waHlzaWNzLmFyY2FkZS5vdmVybGFwKHBsYXllciwgZ3JvdXAsIHNoaXBDb2xsaWRlLCBudWxsLCBnYW1lKTtcbiAgICAgICAgZ2FtZS5waHlzaWNzLmFyY2FkZS5vdmVybGFwKGJ1bGxldHMsIGdyb3VwLCBoaXRFbmVteSwgbnVsbCwgZ2FtZSk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBmaXJlQnVsbGV0KCkge1xuICAgICAgdmFyIGJ1bGxldCA9IGJ1bGxldHMuZ2V0Rmlyc3RFeGlzdHMoZmFsc2UpO1xuICAgICAgdmFyIGJ1bGxldFNwZWVkID0gNDAwO1xuXG4gICAgICBpZiAoYnVsbGV0Q291bnRlciA+IGZpcmluZ1NwZWVkKSB7XG5cbiAgICAgICAgYnVsbGV0Q291bnRlciA9IDA7XG5cbiAgICAgICAgLy8gQnVsbGV0IHBoeXNpY3NcbiAgICAgICAgaWYgKGJ1bGxldCkge1xuICAgICAgICAgIGJ1bGxldC5yZXNldChwbGF5ZXIueCwgcGxheWVyLnkgLSAyNSk7XG5cbiAgICAgICAgICBidWxsZXQuYm9keS52ZWxvY2l0eS55ID0gLTIwMDtcbiAgICAgICAgICBidWxsZXQuYm9keS52ZWxvY2l0eS54ICs9IHBsYXllci5ib2R5LnZlbG9jaXR5LnggLyA1O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBidWxsZXRDb3VudGVyKys7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2hpcENvbGxpZGUocGxheWVyLCBlbmVteSkge1xuICAgICAgdmFyIGV4cGxvc2lvbiA9IGV4cGxvc2lvbnMuZ2V0Rmlyc3RFeGlzdHMoZmFsc2UpO1xuICAgICAgZXhwbG9zaW9uLnJlc2V0KGVuZW15LmJvZHkueCArIGVuZW15LmJvZHkuaGFsZldpZHRoLCBlbmVteS5ib2R5LnkgKyBlbmVteS5ib2R5LmhhbGZIZWlnaHQpO1xuICAgICAgZXhwbG9zaW9uLmJvZHkudmVsb2NpdHkueSA9IGVuZW15LmJvZHkudmVsb2NpdHkueTtcbiAgICAgIGV4cGxvc2lvbi5hbHBoYSA9IDAuNztcbiAgICAgIGV4cGxvc2lvbi5wbGF5KCdleHBsb3Npb24nLCAzMCwgZmFsc2UsIHRydWUpO1xuICAgICAgZW5lbXkua2lsbCgpO1xuXG4gICAgICBwbGF5ZXIuZGFtYWdlKGVuZW15LmRhbWFnZUFtb3VudCk7XG4gICAgICBwbGF5ZXJTaGllbGRzLnJlbmRlcigpO1xuICAgICAgYWRkUG9pbnRzRm9yS2lsbGluZyhlbmVteSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaGl0RW5lbXkoYnVsbGV0LCBlbmVteSkge1xuICAgICAgdmFyIGV4cGxvc2lvbiA9IGV4cGxvc2lvbnMuZ2V0Rmlyc3RFeGlzdHMoZmFsc2UpO1xuICAgICAgZXhwbG9zaW9uLnJlc2V0KGVuZW15LmJvZHkueCArIGVuZW15LmJvZHkuaGFsZldpZHRoLCBlbmVteS5ib2R5LnkgKyBlbmVteS5ib2R5LmhhbGZIZWlnaHQpO1xuICAgICAgZXhwbG9zaW9uLmJvZHkudmVsb2NpdHkueSA9IGVuZW15LmJvZHkudmVsb2NpdHkueTtcbiAgICAgIGV4cGxvc2lvbi5hbHBoYSA9IDAuNztcbiAgICAgIGV4cGxvc2lvbi5wbGF5KCdleHBsb3Npb24nLCAzMCwgZmFsc2UsIHRydWUpO1xuICAgICAgZW5lbXkua2lsbCgpO1xuICAgICAgYnVsbGV0LmtpbGwoKTtcbiAgICAgIGFkZFBvaW50c0ZvcktpbGxpbmcoZW5lbXkpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGFkZFBvaW50c0ZvcktpbGxpbmcoZW5lbXkpIHtcbiAgICAgIHNjb3JlICs9IGVuZW15LmRhbWFnZUFtb3VudCAqIGVuZW15LmxldmVsO1xuICAgICAgc2NvcmVUZXh0LnJlbmRlcigpO1xuICAgIH1cblxuICB9LFxuXG4gIGxhdW5jaEVuZW1pZXM6IGZ1bmN0aW9uKHF1YW50aXR5LCBlbmVteUdyb3VwKSB7XG4gICAgdmFyIGdhbWUgPSB0aGlzO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcXVhbnRpdHk7IGkrKykge1xuICAgICAgbGF1bmNoRW5lbXkoKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBsYXVuY2hFbmVteSgpIHtcbiAgICAgIHZhciBlbmVteUxvY2F0aW9uID0gZ2FtZS5yYW5kb21JbnRlZ2VyRnJvbSg1MCwgNzUwKTtcbiAgICAgIHZhciBlbmVteSA9IGVuZW15R3JvdXAuZ2V0Rmlyc3RFeGlzdHMoZmFsc2UpO1xuICAgICAgaWYgKGVuZW15KSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGVuZW15KTtcbiAgICAgICAgZW5lbXkucmVzZXQoZW5lbXlMb2NhdGlvbiwgLTIwKTtcbiAgICAgICAgZW5lbXkuYm9keS52ZWxvY2l0eS54ID0gZ2FtZS5yYW5kb21JbnRlZ2VyRnJvbSgtZW5lbXkuc3BlZWQsIGVuZW15LnNwZWVkKTtcbiAgICAgICAgZW5lbXkuYm9keS52ZWxvY2l0eS55ID0gZW5lbXkuc3BlZWQ7XG4gICAgICAgIGVuZW15LmJvZHkuZHJhZy54ID0gZW5lbXkuZHJhZztcbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cbiAgcmVzdGFydDogZnVuY3Rpb24oKSB7XG4gICAgZHJvbmVTY291dHMuY2FsbEFsbCgna2lsbCcpO1xuICAgIGVuZW15UmVsZWFzZUNvdW50ZXIgPSAwO1xuICAgIHBsYXllci5yZXZpdmUoKTtcbiAgICBwbGF5ZXIuaGVhbHRoID0gMTAwO1xuICAgIHBsYXllclNoaWVsZHMucmVuZGVyKCk7XG4gICAgc2NvcmUgPSAwO1xuICAgIHNjb3JlVGV4dC5yZW5kZXIoKTtcbiAgICBnYW1lT3Zlci52aXNpYmxlID0gZmFsc2U7XG4gIH0sXG5cbiAgLy8gVXRpbGl0eSBmdW5jdGlvbnNcbiAgcmFuZG9tSW50ZWdlckZyb206IGZ1bmN0aW9uKG1pbiwgbWF4KSB7XG4gICAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChtYXggLSBtaW4pICsgbWluICsgMSk7XG4gIH0sXG5cbiAgb25JbnB1dERvd246IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuZ2FtZS5zdGF0ZS5zdGFydCgnTWVudScpO1xuICB9XG59OyIsInZhciBNZW51ID0gZnVuY3Rpb24gKCkge1xuICB0aGlzLnRleHQgPSBudWxsO1xuICB0aGlzLnN1YnRpdGxlID0gbnVsbDtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gTWVudTtcblxuTWVudS5wcm90b3R5cGUgPSB7XG5cbiAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHggPSB0aGlzLmdhbWUud2lkdGggLyAyO1xuICAgIHZhciB5ID0gdGhpcy5nYW1lLmhlaWdodCAvIDI7XG5cbiAgICB0aGlzLnRleHQgPSB0aGlzLmFkZC5iaXRtYXBUZXh0KHggLSAzMDAsIHkgLSAyMDAsICdzcGFjZWZvbnQnLCBcIkNsaWNrIHRvIFN0YXJ0XCIsIDUwKTtcbiAgICB0aGlzLnN1YnRpdGxlID0gdGhpcy5hZGQuYml0bWFwVGV4dCh4IC0gMzAwLCB5IC0gMTAwLCAnc3BhY2Vmb250JywgXCJBcnJvdyBrZXlzIHRvIG1vdmUsIFNwYWNlIHRvIGZpcmVcIiwgMjApO1xuXG4gICAgdGhpcy5pbnB1dC5vbkRvd24uYWRkKHRoaXMub25Eb3duLCB0aGlzKTtcbiAgfSxcblxuICB1cGRhdGU6IGZ1bmN0aW9uICgpIHtcbiAgfSxcblxuICBvbkRvd246IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmdhbWUuc3RhdGUuc3RhcnQocGxheWVyU3RhdGUuY3VycmVudExldmVsKTtcbiAgfVxufTtcbiIsInZhciBQcmVsb2FkZXIgPSBmdW5jdGlvbihnYW1lKSB7XG4gIHRoaXMuYXNzZXQgPSBudWxsO1xuICB0aGlzLnJlYWR5ID0gZmFsc2U7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFByZWxvYWRlcjtcblxuXG5QcmVsb2FkZXIucHJvdG90eXBlID0ge1xuXG4gIHByZWxvYWQ6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuYXNzZXQgPSB0aGlzLmFkZC5zcHJpdGUoMzIwLCAyNDAsICdwcmVsb2FkZXInKTtcbiAgICB0aGlzLmFzc2V0LmFuY2hvci5zZXRUbygwLjUsIDAuNSk7XG5cbiAgICB0aGlzLnBoeXNpY3Muc3RhcnRTeXN0ZW0oUGhhc2VyLlBoeXNpY3MuQVJDQURFKTtcblxuICAgIHRoaXMubG9hZC5vbkxvYWRDb21wbGV0ZS5hZGRPbmNlKHRoaXMub25Mb2FkQ29tcGxldGUsIHRoaXMpO1xuICAgIHRoaXMubG9hZC5zZXRQcmVsb2FkU3ByaXRlKHRoaXMuYXNzZXQpO1xuICAgIHRoaXMubG9hZC5pbWFnZSgnc3RhcmZpZWxkJywgJ2Fzc2V0cy9zdGFyZmllbGQucG5nJyk7XG4gICAgdGhpcy5sb2FkLmltYWdlKCdzaGlwJywgJ2Fzc2V0cy9wbGF5ZXIucG5nJyk7XG4gICAgdGhpcy5sb2FkLmltYWdlKCdwbGFzbWEnLCAnYXNzZXRzL2JsdWVQbGFzbWEucG5nJyk7XG4gICAgdGhpcy5sb2FkLmltYWdlKCdsYXNlcicsICdhc3NldHMvYmx1ZUxhc2VyLnBuZycpO1xuICAgIHRoaXMubG9hZC5pbWFnZSgnYnVsbGV0JywgJ2Fzc2V0cy9ibHVlQnVsbGV0LnBuZycpO1xuICAgIHRoaXMubG9hZC5pbWFnZSgnZHJvbmVTY291dCcsICdhc3NldHMvZHJvbmVTY291dC5wbmcnKTtcbiAgICB0aGlzLmxvYWQuaW1hZ2UoJ2Ryb25lRmlnaHRlcicsICdhc3NldHMvZHJvbmVGaWdodGVyLnBuZycpO1xuICAgIHRoaXMubG9hZC5pbWFnZSgnZHJvbmVCb21iZXInLCAnYXNzZXRzL2Ryb25lQm9tYmVyLnBuZycpO1xuICAgIHRoaXMubG9hZC5pbWFnZSgnZW5lbXlUcmFpbCcsICdhc3NldHMvZW5lbXlUcmFpbC5wbmcnKTtcbiAgICB0aGlzLmxvYWQuc3ByaXRlc2hlZXQoJ2V4cGxvc2lvbicsICdhc3NldHMvZXhwbG9zaW9uLnBuZycsIDEyOCwgMTI4KTtcbiAgICB0aGlzLmxvYWQuYml0bWFwRm9udCgnc3BhY2Vmb250JywgJ2Fzc2V0cy9zcGFjZWZvbnQvc3BhY2Vmb250LnBuZycsICdhc3NldHMvc3BhY2Vmb250L3NwYWNlZm9udC5mbnQnKTtcbiAgfSxcblxuICBjcmVhdGU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuYXNzZXQuY3JvcEVuYWJsZWQgPSBmYWxzZTtcbiAgfSxcblxuICB1cGRhdGU6IGZ1bmN0aW9uKCkge1xuICAgIGlmICghIXRoaXMucmVhZHkpIHtcbiAgICAgIHRoaXMuZ2FtZS5zdGF0ZS5zdGFydCgnTWVudScpO1xuICAgIH1cbiAgfSxcblxuICBvbkxvYWRDb21wbGV0ZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5yZWFkeSA9IHRydWU7XG4gIH1cbn07IiwidmFyIFNwbGFzaCA9IGZ1bmN0aW9uICgpIHtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gU3BsYXNoO1xuXG5TcGxhc2gucHJvdG90eXBlID0ge1xuICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcbiAgfVxufTsiLCJ2YXIgVXRpbHMgPSB7XG4gICAgY29udGFpbnNPYmplY3Q6IGZ1bmN0aW9uKG9iaiwgbGlzdCkge1xuICAgICAgICB2YXIgaTtcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChsaXN0W2ldID09PSBvYmopIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFV0aWxzOyJdfQ==
