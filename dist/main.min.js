(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({"/Users/seanodonohue/myProjects/schmup-prototype/src/js/main.js":[function(require,module,exports){
'use strict';

var game = new Phaser.Game(800, 600, Phaser.AUTO, 'schmup-game');

var width = 800;
var height = 600;

window.Utils = require('./utils');
window.playerState = {
    currentLevel: 'Game'
}



game.state.add('Boot', require('./states/boot'));
game.state.add('Splash', require('./states/splash'));
game.state.add('Preloader', require('./states/preloader'));
game.state.add('Menu', require('./states/menu'));
game.state.add('Game', require('./states/game'));

game.state.start('Boot');

},{"./states/boot":"/Users/seanodonohue/myProjects/schmup-prototype/src/js/states/boot.js","./states/game":"/Users/seanodonohue/myProjects/schmup-prototype/src/js/states/game.js","./states/menu":"/Users/seanodonohue/myProjects/schmup-prototype/src/js/states/menu.js","./states/preloader":"/Users/seanodonohue/myProjects/schmup-prototype/src/js/states/preloader.js","./states/splash":"/Users/seanodonohue/myProjects/schmup-prototype/src/js/states/splash.js","./utils":"/Users/seanodonohue/myProjects/schmup-prototype/src/js/utils.js"}],"/Users/seanodonohue/myProjects/schmup-prototype/src/js/states/boot.js":[function(require,module,exports){
var Boot = function () {};

module.exports = Boot;

Boot.prototype = {

  preload: function () {
    this.load.image('preloader', 'assets/preloader.gif');
  },

  create: function () {
    this.game.input.maxPointers = 1;

    if (this.game.device.desktop) {
      this.game.stage.scale.pageAlignHorizontally = true;
    } else {
      this.game.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL;
      this.game.scale.minWidth =  800;
      this.game.scale.minHeight = 600;
      this.game.scale.maxWidth = 800;
      this.game.scale.maxHeight = 600;
      this.game.scale.forceLandscape = true;
      this.game.scale.pageAlignHorizontally = true;
      this.game.scale.setScreenSize(true);
    }

    this.game.state.start('Preloader');
  }
};

},{}],"/Users/seanodonohue/myProjects/schmup-prototype/src/js/states/game.js":[function(require,module,exports){
'use strict';
var player;

var playerShields;
var gameOver;

var score = 0;
var scoreText;

var enemies;
var enemyOptions;
var droneScouts;
var droneFighters;
var droneBombers;
var enemyReleaseCounter = 0;

var starfield;
var scrollSpeed = 2;

var explosions;
var bullets;
var firingSpeed = 25; // higher = slower
var bulletCounter = firingSpeed;
var enemyWeapons, enemyLasers, enemyBombs;

var cursors;
var fireButton;

var ship = {
  acceleration: 600,
  drag: 350,
  maxSpeed: 400
};

var size = {
  xSmall: 0.4,
  small: 0.5,
  medium: 0.75,
  large: 1,
  xLarge: 1.25,
  miniBoss: 1.5,
  boss: 2
};

var shipTrail;

var Game = function() {
  this.testentity = null;
};

module.exports = Game;

Game.prototype = {

  create: function() {
    var game = this;

    starfield = game.add.tileSprite(0, 0, 800, 600, 'starfield');

    initPlayerShip();
    initControls();
    initWeapons();
    initEnemies();
    initEffects();
    initMessages();

    function initPlayerShip() {
      player = game.add.sprite(400, 500, 'ship');
      game.physics.arcade.enable(player);
      player.events.onKilled.add(function() {
        shipTrail.kill();
      });
      player.body
        .maxVelocity.setTo(ship.maxSpeed, ship.maxSpeed);
      player.body
        .drag.setTo(ship.drag, ship.drag);
      player.anchor.setTo(0.5, 0.5);
      player.health = 100;
      player.size = size.large;
      game.createShipTrail(player, 'plasma');
    }

    function initControls() {
      cursors = game.input.keyboard.createCursorKeys();
      fireButton = game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);
    }

    function initEnemies() {

      droneScouts = game.add.group();
      droneFighters = game.add.group();
      droneBombers = game.add.group();
      enemies = [
        droneScouts,
        droneFighters,
        droneBombers
      ];

      var enemyFiring = function() {
        var enemy = this;
        var projectile = enemy.weapon.getFirstExists(false);
        if (canFire() && doesFire()) {
          enemy.lastShot = enemyReleaseCounter;
          enemy.bullets--;
          projectile.reset(enemy.x + enemy.width / 2, 
            enemy.y + enemy.height * 0.75);
          console.log(projectile);
          projectile.damageAmount = enemy.bulletDamageAmount;
          projectile.body.velocity.y = enemy.bulletSpeed;
          projectile.body.velocity.x = 0;
          projectile.body.drag = 0;
          projectile.body.angle = 90;
        }

        function canFire() {
          return projectile &&
            enemy.alive &&
            enemy.bullets &&
            enemyReleaseCounter > enemy.firingSpeed + enemy.lastShot;
        }

        function doesFire() {
          return game.randomIntegerFrom(1, 100) >
            80;
        }
      };

      droneScouts.init = function() {
        console.log(this);
        this.createMultiple(50, 'droneScout');
        this.minWaveTiming = 140;
        this.maxWaveTiming = 380;
        this.minWaveNumber = 3;
        this.maxWaveNumber = 5;
        this.forEach(function(enemy) {
          enemy.damageAmount = 10;
          enemy.level = 2;
          enemy.speed = game.randomIntegerFrom(250, 450);
          enemy.drift = 30;
          enemy.drag = game.randomIntegerFrom(100, 200);
          enemy.minX = 50;
          enemy.maxX = 750;
          enemy.scale.x = size.xSmall;
          enemy.scale.y = size.xSmall;
        });
      };

      droneFighters.init = function() {
        this.createMultiple(10, 'droneFighter');
        this.minWaveTiming = 190;
        this.maxWaveTiming = 500;
        this.minWaveNumber = 2;
        this.maxWaveNumber = 4;
        this.forEach(function(enemy) {
          enemy.damageAmount = 25;
          enemy.level = 3;
          enemy.speed = game.randomIntegerFrom(250, 400);
          enemy.drift = game.randomIntegerFrom(200, 450);
          enemy.drag = 50;
          enemy.minX = 100;
          enemy.maxX = 700;
          enemy.scale.x = size.medium;
          enemy.scale.y = size.medium;
          enemy.weapon = enemyLasers;
          enemy.bullets = 4;
          enemy.bulletDamageAmount = 10;
          enemy.bulletSpeed = 500;
          enemy.firingSpeed = 20;
          enemy.lastShot = 0;
          enemy.update = enemyFiring;
        });
      };

      droneBombers.init = function() {
        this.createMultiple(5, 'droneBomber');
        this.minWaveTiming = 500;
        this.maxWaveTiming = 600;
        this.minWaveNumber = 0;
        this.maxWaveNumber = 1;
        this.forEach(function(enemy) {
          enemy.damageAmount = 50;
          enemy.level = 4;
          enemy.speed = 100;
          enemy.drift = 5;
          enemy.drag = 5;
          enemy.minX = 250;
          enemy.maxX = 650;
          enemy.scale.x = size.large;
          enemy.scale.y = size.large;
          enemy.weapon = enemyBombs;
          enemy.bullets = 2;
          enemy.bulletDamageAmount = 40;
          enemy.bulletSpeed = 250;
          enemy.firingSpeed = 40;
          enemy.lastShot = 0;
          enemy.update = enemyFiring;
        });
      };

      enemies.forEach(function(group) {
        configureEnemies(group);
        group.init();
      });

      game.launchEnemies(game.randomIntegerFrom(3, 5), droneScouts);
    }

    function configureEnemies(group) {
      group.physicsBodyType = Phaser.Physics.ARCADE;
      group.enableBody = true;
      group.setAll('anchor.x', 0.5);
      group.setAll('anchor.y', 0.5);
      group.setAll('angle', 180);
      group.setAll('outOfBoundsKill', true);
      group.setAll('checkWorldBounds', true);
    }

    function initWeapons() {
      bullets = game.add.group();
      bullets.enableBody = true;
      bullets.physicsBodyType = Phaser.Physics.ARCADE;
      bullets.createMultiple(15, 'bullet');
      bullets.setAll('anchor.x', 0.5);
      bullets.setAll('anchor.y', 1);
      bullets.setAll('outOfBoundsKill', true);
      bullets.setAll('checkWorldBounds', true);

      // enemy weapons
      enemyWeapons = [
        enemyLasers,
        enemyBombs
      ];

      enemyLasers = game.add.group();
      enemyLasers.enableBody = true;
      enemyLasers.physicsBodyType = Phaser.Physics.ARCADE;
      enemyLasers.createMultiple(20, 'enemyLaser');
      enemyLasers.setAll('scale.x', 0.6);
      enemyLasers.setAll('scale.y', 0.6);
      enemyLasers.setAll('anchor.x', 0.5);
      enemyLasers.setAll('anchor.y', 0.5);
      enemyLasers.setAll('outOfBoundsKill', true);
      enemyLasers.setAll('checkWorldBounds', true);

      enemyBombs = game.add.group();
      enemyBombs.enableBody = true;
      enemyBombs.physicsBodyType = Phaser.Physics.ARCADE;
      enemyBombs.createMultiple(10, 'enemyBomb');
      enemyBombs.setAll('scale.x', 1);
      enemyBombs.setAll('scale.y', 1);
      enemyBombs.setAll('anchor.x', 0.5);
      enemyBombs.setAll('anchor.y', 0.5);
      enemyBombs.setAll('outOfBoundsKill', true);
      enemyBombs.setAll('checkWorldBounds', true);
    }

    function initEffects() {
      explosions = game.add.group();
      explosions.enableBody = true;
      explosions.physicsBodyType = Phaser.Physics.ARCADE;
      explosions.createMultiple(30, 'explosion');
      explosions.setAll('anchor.x', 0.5);
      explosions.setAll('anchor.y', 0.5);
      explosions.forEach(function(explosion) {
        explosion.animations.add('explosion');
      });
    }

    function initMessages() {

      createShieldMessage();
      createScoreMessage();
      createGameOverMessage();

      playerShields.render();
      scoreText.render();

      function createShieldMessage() {
        playerShields = game.add.bitmapText(game.world.width - 250, 10, 'spacefont', '' + player.health + '%', 20);
        playerShields.render = function() {
          playerShields.text = 'Shields: ' + Math.max(player.health, 0) + '%';
        };
      }

      function createScoreMessage() {
        scoreText = game.add.bitmapText(10, 10, 'spacefont', '', 20);
        scoreText.render = function() {
          scoreText.text = 'Score: ' + score;
        };
      }

      function createGameOverMessage() {
        gameOver = game.add.bitmapText(game.world.centerX, game.world.centerY, 'spacefont', 'GAME OVER!', 50);
        gameOver.x = gameOver.x - gameOver.textWidth / 2;
        gameOver.y = gameOver.y - gameOver.textHeight / 3;
        gameOver.visible = false;
      }
    }
  },

  update: function() {
    var game = this;

    starfield.tilePosition.y += scrollSpeed;
    enemyReleaseCounter++;

    enemies.forEach(function(enemy) {
      checkWaveTimer(enemy);
      launchNewWaves(enemy);

      function checkWaveTimer(enemy) {
        if (!enemy.waveTimer) {
          enemy.waveTimer =
            roundToNearestTen(
              game.randomIntegerFrom(
                enemy.minWaveTiming,
                enemy.maxWaveTiming
              ));
        }

        function roundToNearestTen(num) {
          return Math.ceil(num / 10) * 10;
        }
      }

      function launchNewWaves(enemy) {
        if (enemyReleaseCounter % enemy.waveTimer === 0) {
          game.launchEnemies(
            game.randomIntegerFrom(
              enemy.minWaveNumber,
              enemy.maxWaveNumber),
            enemy);
          console.log("Wave launched?!");
          enemy.waveTimer = null;
        }
      }
    });

    checkCollisions();
    checkForGameOver();
    calculatePlayerMovement();

    function calculatePlayerMovement() {

      player.body.acceleration.x = 0;
      game.checkForBounds(50, 750, player);
      checkForPlayerInput();
      shipTrail.x = player.x;
      game.applyBankingToShip(player);


      function checkForPlayerInput() {
        if (cursors.left.isDown) {
          player.body.acceleration.x = -ship.acceleration;
        } else if (cursors.right.isDown) {
          player.body.acceleration.x = ship.acceleration;
        }

        if (player.alive && fireButton.isDown) {
          fireBullet();
        }
      }
    }

    function checkForGameOver() {
      if (!player.alive && gameOver.visible == false) {
        gameOver.visible = true;
        gameOver.alpha = 0;
        var fadeInGameOver = game.add.tween(gameOver);
        fadeInGameOver.to({
          alpha: 1
        }, 1000, Phaser.Easing.Quintic.Out);
        fadeInGameOver.onComplete.add(setResetHandlers);
        fadeInGameOver.start();

        function setResetHandlers() {
          var tapRestart = game.input.onTap.addOnce(_restart, game);
          var spaceRestart = fireButton.onDown.addOnce(_restart, game);

          function _restart() {
            tapRestart.detach();
            spaceRestart.detach();
            game.restart();
          }
        }
      }
    }

    function checkCollisions() {
      enemies.forEach(function(group) {
        game.physics.arcade.overlap(player, group, shipCollide, null, game);
        game.physics.arcade.overlap(bullets, group, hitEnemy, null, game);
      });

      enemyWeapons.forEach(function(projectiles) {
        game.physics.arcade.overlap(projectiles, player, enemyHitsPlayer, null, this);
      });
    }

    function fireBullet() {
      var bullet = bullets.getFirstExists(false);
      var bulletSpeed = 400;

      if (bulletCounter > firingSpeed) {

        bulletCounter = 0;

        // Bullet physics
        if (bullet) {
          bullet.reset(player.x, player.y - 25);

          bullet.body.velocity.y = -200;
          bullet.body.velocity.x += player.body.velocity.x / 5;
        }
      }
      bulletCounter++;
    }

    function shipCollide(player, enemy) {
      var explosion = explosions.getFirstExists(false);
      explosion.reset(enemy.body.x + enemy.body.halfWidth, enemy.body.y + enemy.body.halfHeight);
      explosion.body.velocity.y = enemy.body.velocity.y;
      explosion.alpha = 0.7;
      explosion.play('explosion', 30, false, true);
      enemy.kill();

      player.damage(enemy.damageAmount);
      playerShields.render();
      addPointsForKilling(enemy);
    }

    function enemyHitsPlayer(player, bullet) {
      goBoom(player);
      bullet.kill();
      player.damage(bullet.damageAmount);
      shields.render();
    }

    function hitEnemy(bullet, enemy) {
      goBoom(enemy);
      enemy.kill();
      bullet.kill();
      addPointsForKilling(enemy);
    }

    function goBoom(entity) {
      var explosion = explosions.getFirstExists(false);
      explosion.reset(entity.body.x + entity.body.halfWidth, entity.body.y + entity.body.halfHeight);
      explosion.body.velocity.y = entity.body.velocity.y;
      explosion.alpha = 0.7;
      explosion.play('explosion', 30, false, true);
    }

    function addPointsForKilling(enemy) {
      score += enemy.damageAmount * enemy.level;
      scoreText.render();
    }

  },

  launchEnemies: function(quantity, enemyGroup) {
    var game = this;
    for (var i = 0; i < quantity; i++) {
      launchEnemy();
    }

    function launchEnemy() {
      console.log("Launching enemy...");
      var enemy = enemyGroup.getFirstExists(false);
      if (enemy) {
        var enemyLocation = game.randomIntegerFrom(
          enemy.minX, enemy.maxX);
        enemy.reset(enemyLocation, -20);
        enemy.body.velocity.x = game.randomIntegerFrom(-enemy.drift, enemy.drift);
        enemy.body.velocity.y = enemy.speed;
        enemy.body.drag.x = enemy.drag;
      }
    }
  },

  setEnemyAttributes: function(enemy, options) {

    // Unused as of right now.
    // Could be used for powerups or abilities that change enemy attributes
    // (speed could be halved for a "Slow Time" powerup, for example)
    options = options || {};
    game.physics.enable(enemy, Phaser.Physics.ARCADE);
    for (attr in options) {
      enemy[attr] = options[attr];
    }
  },

  checkForBounds: function(min, max, entity) {
    if (entity.x > max) {
      entity.x = max;
      entity.body.acceleration.x = -50;
    }
    if (entity.x < min) {
      entity.x = min;
      entity.body.acceleration.x = 50;
    }
  },

  // TODO - Tack stuff like maxSpeed to player object
  applyBankingToShip: function(entity) {
    var bank = entity.body.velocity.x / ship.maxSpeed;
    entity.scale.x = entity.size - Math.abs(bank) / 4;
    entity.angle = bank * 5;
  },

  createShipTrail: function(ship, particleName) {
    shipTrail = this.add.emitter(ship.x, ship.y + 40, 400);
    shipTrail.width = 10;
    shipTrail.makeParticles(particleName);
    shipTrail.setXSpeed(30, -30);
    shipTrail.setYSpeed(200, 180);
    shipTrail.setRotation(50, -50);
    shipTrail.setAlpha(1, 0.01, 800);
    shipTrail.setScale(0.05, 0.4, 0.05, 0.4, 2000, Phaser.Easing.Quintic.Out);
    shipTrail.start(false, 5000, 10);
  },

  restart: function() {
    enemies.forEach(function(enemy) {
      enemy.callAll('kill');
    });

    enemyWeapons.forEach(function(proj) {
      proj.callAll('kill');
    });

    enemyReleaseCounter = 0;
    player.revive();
    player.health = 100;
    playerShields.render();
    score = 0;
    scoreText.render();
    gameOver.visible = false;
  },

  // Utility functions
  randomIntegerFrom: function(min, max) {
    return Math.floor(Math.random() * (max - min) + min + 1);
  },

  onInputDown: function() {
    this.game.state.start('Menu');
  }
};
},{}],"/Users/seanodonohue/myProjects/schmup-prototype/src/js/states/menu.js":[function(require,module,exports){
var Menu = function () {
  this.text = null;
  this.subtitle = null;
};

module.exports = Menu;

Menu.prototype = {

  create: function () {
    var x = this.game.width / 2;
    var y = this.game.height / 2;

    this.text = this.add.bitmapText(x - 300, y - 200, 'spacefont', "Click to Start", 50);
    this.subtitle = this.add.bitmapText(x - 300, y - 100, 'spacefont', "Arrow keys to move, Space to fire", 20);

    this.input.onDown.add(this.onDown, this);
  },

  update: function () {
  },

  onDown: function () {
    this.game.state.start(playerState.currentLevel);
  }
};

},{}],"/Users/seanodonohue/myProjects/schmup-prototype/src/js/states/preloader.js":[function(require,module,exports){
var Preloader = function(game) {
  this.asset = null;
  this.ready = false;
};

module.exports = Preloader;


Preloader.prototype = {

  preload: function() {
    this.asset = this.add.sprite(320, 240, 'preloader');
    this.asset.anchor.setTo(0.5, 0.5);

    this.physics.startSystem(Phaser.Physics.ARCADE);

    this.load.onLoadComplete.addOnce(this.onLoadComplete, this);
    this.load.setPreloadSprite(this.asset);
    this.load.image('starfield', 'assets/starfield.png');
    this.load.image('ship', 'assets/player.png');
    this.load.image('plasma', 'assets/bluePlasma.png');
    this.load.image('laser', 'assets/blueLaser.png');
    this.load.image('bullet', 'assets/blueBullet.png');
    this.load.image('enemyLaser', 'assets/redLaser.png');
    this.load.image('enemyBomb', 'assets/redBomb.png');
    this.load.image('droneScout', 'assets/droneScout.png');
    this.load.image('droneFighter', 'assets/droneFighter.png');
    this.load.image('droneBomber', 'assets/droneBomber.png');
    this.load.image('enemyTrail', 'assets/enemyTrail.png');
    this.load.spritesheet('explosion', 'assets/explosion.png', 128, 128);
    this.load.bitmapFont('spacefont', 'assets/spacefont/spacefont.png', 'assets/spacefont/spacefont.fnt');
  },

  create: function() {
    this.asset.cropEnabled = false;
  },

  update: function() {
    if (!!this.ready) {
      this.game.state.start('Menu');
    }
  },

  onLoadComplete: function() {
    this.ready = true;
  }
};
},{}],"/Users/seanodonohue/myProjects/schmup-prototype/src/js/states/splash.js":[function(require,module,exports){
var Splash = function () {
};

module.exports = Splash;

Splash.prototype = {
  create: function () {
  }
};
},{}],"/Users/seanodonohue/myProjects/schmup-prototype/src/js/utils.js":[function(require,module,exports){
var Utils = {
    containsObject: function(obj, list) {
        var i;
        for (i = 0; i < list.length; i++) {
            if (list[i] === obj) {
                return true;
            }
        }

        return false;
    }
};

module.exports = Utils;
},{}]},{},["/Users/seanodonohue/myProjects/schmup-prototype/src/js/main.js"])
//# sourceMappingURL=data:application/json;charset:utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvanMvbWFpbi5qcyIsInNyYy9qcy9zdGF0ZXMvYm9vdC5qcyIsInNyYy9qcy9zdGF0ZXMvZ2FtZS5qcyIsInNyYy9qcy9zdGF0ZXMvbWVudS5qcyIsInNyYy9qcy9zdGF0ZXMvcHJlbG9hZGVyLmpzIiwic3JjL2pzL3N0YXRlcy9zcGxhc2guanMiLCJzcmMvanMvdXRpbHMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcGlCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIid1c2Ugc3RyaWN0JztcblxudmFyIGdhbWUgPSBuZXcgUGhhc2VyLkdhbWUoODAwLCA2MDAsIFBoYXNlci5BVVRPLCAnc2NobXVwLWdhbWUnKTtcblxudmFyIHdpZHRoID0gODAwO1xudmFyIGhlaWdodCA9IDYwMDtcblxud2luZG93LlV0aWxzID0gcmVxdWlyZSgnLi91dGlscycpO1xud2luZG93LnBsYXllclN0YXRlID0ge1xuICAgIGN1cnJlbnRMZXZlbDogJ0dhbWUnXG59XG5cblxuXG5nYW1lLnN0YXRlLmFkZCgnQm9vdCcsIHJlcXVpcmUoJy4vc3RhdGVzL2Jvb3QnKSk7XG5nYW1lLnN0YXRlLmFkZCgnU3BsYXNoJywgcmVxdWlyZSgnLi9zdGF0ZXMvc3BsYXNoJykpO1xuZ2FtZS5zdGF0ZS5hZGQoJ1ByZWxvYWRlcicsIHJlcXVpcmUoJy4vc3RhdGVzL3ByZWxvYWRlcicpKTtcbmdhbWUuc3RhdGUuYWRkKCdNZW51JywgcmVxdWlyZSgnLi9zdGF0ZXMvbWVudScpKTtcbmdhbWUuc3RhdGUuYWRkKCdHYW1lJywgcmVxdWlyZSgnLi9zdGF0ZXMvZ2FtZScpKTtcblxuZ2FtZS5zdGF0ZS5zdGFydCgnQm9vdCcpO1xuIiwidmFyIEJvb3QgPSBmdW5jdGlvbiAoKSB7fTtcblxubW9kdWxlLmV4cG9ydHMgPSBCb290O1xuXG5Cb290LnByb3RvdHlwZSA9IHtcblxuICBwcmVsb2FkOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5sb2FkLmltYWdlKCdwcmVsb2FkZXInLCAnYXNzZXRzL3ByZWxvYWRlci5naWYnKTtcbiAgfSxcblxuICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmdhbWUuaW5wdXQubWF4UG9pbnRlcnMgPSAxO1xuXG4gICAgaWYgKHRoaXMuZ2FtZS5kZXZpY2UuZGVza3RvcCkge1xuICAgICAgdGhpcy5nYW1lLnN0YWdlLnNjYWxlLnBhZ2VBbGlnbkhvcml6b250YWxseSA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZ2FtZS5zY2FsZS5zY2FsZU1vZGUgPSBQaGFzZXIuU2NhbGVNYW5hZ2VyLlNIT1dfQUxMO1xuICAgICAgdGhpcy5nYW1lLnNjYWxlLm1pbldpZHRoID0gIDgwMDtcbiAgICAgIHRoaXMuZ2FtZS5zY2FsZS5taW5IZWlnaHQgPSA2MDA7XG4gICAgICB0aGlzLmdhbWUuc2NhbGUubWF4V2lkdGggPSA4MDA7XG4gICAgICB0aGlzLmdhbWUuc2NhbGUubWF4SGVpZ2h0ID0gNjAwO1xuICAgICAgdGhpcy5nYW1lLnNjYWxlLmZvcmNlTGFuZHNjYXBlID0gdHJ1ZTtcbiAgICAgIHRoaXMuZ2FtZS5zY2FsZS5wYWdlQWxpZ25Ib3Jpem9udGFsbHkgPSB0cnVlO1xuICAgICAgdGhpcy5nYW1lLnNjYWxlLnNldFNjcmVlblNpemUodHJ1ZSk7XG4gICAgfVxuXG4gICAgdGhpcy5nYW1lLnN0YXRlLnN0YXJ0KCdQcmVsb2FkZXInKTtcbiAgfVxufTtcbiIsIid1c2Ugc3RyaWN0JztcbnZhciBwbGF5ZXI7XG5cbnZhciBwbGF5ZXJTaGllbGRzO1xudmFyIGdhbWVPdmVyO1xuXG52YXIgc2NvcmUgPSAwO1xudmFyIHNjb3JlVGV4dDtcblxudmFyIGVuZW1pZXM7XG52YXIgZW5lbXlPcHRpb25zO1xudmFyIGRyb25lU2NvdXRzO1xudmFyIGRyb25lRmlnaHRlcnM7XG52YXIgZHJvbmVCb21iZXJzO1xudmFyIGVuZW15UmVsZWFzZUNvdW50ZXIgPSAwO1xuXG52YXIgc3RhcmZpZWxkO1xudmFyIHNjcm9sbFNwZWVkID0gMjtcblxudmFyIGV4cGxvc2lvbnM7XG52YXIgYnVsbGV0cztcbnZhciBmaXJpbmdTcGVlZCA9IDI1OyAvLyBoaWdoZXIgPSBzbG93ZXJcbnZhciBidWxsZXRDb3VudGVyID0gZmlyaW5nU3BlZWQ7XG52YXIgZW5lbXlXZWFwb25zLCBlbmVteUxhc2VycywgZW5lbXlCb21icztcblxudmFyIGN1cnNvcnM7XG52YXIgZmlyZUJ1dHRvbjtcblxudmFyIHNoaXAgPSB7XG4gIGFjY2VsZXJhdGlvbjogNjAwLFxuICBkcmFnOiAzNTAsXG4gIG1heFNwZWVkOiA0MDBcbn07XG5cbnZhciBzaXplID0ge1xuICB4U21hbGw6IDAuNCxcbiAgc21hbGw6IDAuNSxcbiAgbWVkaXVtOiAwLjc1LFxuICBsYXJnZTogMSxcbiAgeExhcmdlOiAxLjI1LFxuICBtaW5pQm9zczogMS41LFxuICBib3NzOiAyXG59O1xuXG52YXIgc2hpcFRyYWlsO1xuXG52YXIgR2FtZSA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLnRlc3RlbnRpdHkgPSBudWxsO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBHYW1lO1xuXG5HYW1lLnByb3RvdHlwZSA9IHtcblxuICBjcmVhdGU6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBnYW1lID0gdGhpcztcblxuICAgIHN0YXJmaWVsZCA9IGdhbWUuYWRkLnRpbGVTcHJpdGUoMCwgMCwgODAwLCA2MDAsICdzdGFyZmllbGQnKTtcblxuICAgIGluaXRQbGF5ZXJTaGlwKCk7XG4gICAgaW5pdENvbnRyb2xzKCk7XG4gICAgaW5pdFdlYXBvbnMoKTtcbiAgICBpbml0RW5lbWllcygpO1xuICAgIGluaXRFZmZlY3RzKCk7XG4gICAgaW5pdE1lc3NhZ2VzKCk7XG5cbiAgICBmdW5jdGlvbiBpbml0UGxheWVyU2hpcCgpIHtcbiAgICAgIHBsYXllciA9IGdhbWUuYWRkLnNwcml0ZSg0MDAsIDUwMCwgJ3NoaXAnKTtcbiAgICAgIGdhbWUucGh5c2ljcy5hcmNhZGUuZW5hYmxlKHBsYXllcik7XG4gICAgICBwbGF5ZXIuZXZlbnRzLm9uS2lsbGVkLmFkZChmdW5jdGlvbigpIHtcbiAgICAgICAgc2hpcFRyYWlsLmtpbGwoKTtcbiAgICAgIH0pO1xuICAgICAgcGxheWVyLmJvZHlcbiAgICAgICAgLm1heFZlbG9jaXR5LnNldFRvKHNoaXAubWF4U3BlZWQsIHNoaXAubWF4U3BlZWQpO1xuICAgICAgcGxheWVyLmJvZHlcbiAgICAgICAgLmRyYWcuc2V0VG8oc2hpcC5kcmFnLCBzaGlwLmRyYWcpO1xuICAgICAgcGxheWVyLmFuY2hvci5zZXRUbygwLjUsIDAuNSk7XG4gICAgICBwbGF5ZXIuaGVhbHRoID0gMTAwO1xuICAgICAgcGxheWVyLnNpemUgPSBzaXplLmxhcmdlO1xuICAgICAgZ2FtZS5jcmVhdGVTaGlwVHJhaWwocGxheWVyLCAncGxhc21hJyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaW5pdENvbnRyb2xzKCkge1xuICAgICAgY3Vyc29ycyA9IGdhbWUuaW5wdXQua2V5Ym9hcmQuY3JlYXRlQ3Vyc29yS2V5cygpO1xuICAgICAgZmlyZUJ1dHRvbiA9IGdhbWUuaW5wdXQua2V5Ym9hcmQuYWRkS2V5KFBoYXNlci5LZXlib2FyZC5TUEFDRUJBUik7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaW5pdEVuZW1pZXMoKSB7XG5cbiAgICAgIGRyb25lU2NvdXRzID0gZ2FtZS5hZGQuZ3JvdXAoKTtcbiAgICAgIGRyb25lRmlnaHRlcnMgPSBnYW1lLmFkZC5ncm91cCgpO1xuICAgICAgZHJvbmVCb21iZXJzID0gZ2FtZS5hZGQuZ3JvdXAoKTtcbiAgICAgIGVuZW1pZXMgPSBbXG4gICAgICAgIGRyb25lU2NvdXRzLFxuICAgICAgICBkcm9uZUZpZ2h0ZXJzLFxuICAgICAgICBkcm9uZUJvbWJlcnNcbiAgICAgIF07XG5cbiAgICAgIHZhciBlbmVteUZpcmluZyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgZW5lbXkgPSB0aGlzO1xuICAgICAgICB2YXIgcHJvamVjdGlsZSA9IGVuZW15LndlYXBvbi5nZXRGaXJzdEV4aXN0cyhmYWxzZSk7XG4gICAgICAgIGlmIChjYW5GaXJlKCkgJiYgZG9lc0ZpcmUoKSkge1xuICAgICAgICAgIGVuZW15Lmxhc3RTaG90ID0gZW5lbXlSZWxlYXNlQ291bnRlcjtcbiAgICAgICAgICBlbmVteS5idWxsZXRzLS07XG4gICAgICAgICAgcHJvamVjdGlsZS5yZXNldChlbmVteS54ICsgZW5lbXkud2lkdGggLyAyLCBcbiAgICAgICAgICAgIGVuZW15LnkgKyBlbmVteS5oZWlnaHQgKiAwLjc1KTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhwcm9qZWN0aWxlKTtcbiAgICAgICAgICBwcm9qZWN0aWxlLmRhbWFnZUFtb3VudCA9IGVuZW15LmJ1bGxldERhbWFnZUFtb3VudDtcbiAgICAgICAgICBwcm9qZWN0aWxlLmJvZHkudmVsb2NpdHkueSA9IGVuZW15LmJ1bGxldFNwZWVkO1xuICAgICAgICAgIHByb2plY3RpbGUuYm9keS52ZWxvY2l0eS54ID0gMDtcbiAgICAgICAgICBwcm9qZWN0aWxlLmJvZHkuZHJhZyA9IDA7XG4gICAgICAgICAgcHJvamVjdGlsZS5ib2R5LmFuZ2xlID0gOTA7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBjYW5GaXJlKCkge1xuICAgICAgICAgIHJldHVybiBwcm9qZWN0aWxlICYmXG4gICAgICAgICAgICBlbmVteS5hbGl2ZSAmJlxuICAgICAgICAgICAgZW5lbXkuYnVsbGV0cyAmJlxuICAgICAgICAgICAgZW5lbXlSZWxlYXNlQ291bnRlciA+IGVuZW15LmZpcmluZ1NwZWVkICsgZW5lbXkubGFzdFNob3Q7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBkb2VzRmlyZSgpIHtcbiAgICAgICAgICByZXR1cm4gZ2FtZS5yYW5kb21JbnRlZ2VyRnJvbSgxLCAxMDApID5cbiAgICAgICAgICAgIDgwO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBkcm9uZVNjb3V0cy5pbml0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMpO1xuICAgICAgICB0aGlzLmNyZWF0ZU11bHRpcGxlKDUwLCAnZHJvbmVTY291dCcpO1xuICAgICAgICB0aGlzLm1pbldhdmVUaW1pbmcgPSAxNDA7XG4gICAgICAgIHRoaXMubWF4V2F2ZVRpbWluZyA9IDM4MDtcbiAgICAgICAgdGhpcy5taW5XYXZlTnVtYmVyID0gMztcbiAgICAgICAgdGhpcy5tYXhXYXZlTnVtYmVyID0gNTtcbiAgICAgICAgdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKGVuZW15KSB7XG4gICAgICAgICAgZW5lbXkuZGFtYWdlQW1vdW50ID0gMTA7XG4gICAgICAgICAgZW5lbXkubGV2ZWwgPSAyO1xuICAgICAgICAgIGVuZW15LnNwZWVkID0gZ2FtZS5yYW5kb21JbnRlZ2VyRnJvbSgyNTAsIDQ1MCk7XG4gICAgICAgICAgZW5lbXkuZHJpZnQgPSAzMDtcbiAgICAgICAgICBlbmVteS5kcmFnID0gZ2FtZS5yYW5kb21JbnRlZ2VyRnJvbSgxMDAsIDIwMCk7XG4gICAgICAgICAgZW5lbXkubWluWCA9IDUwO1xuICAgICAgICAgIGVuZW15Lm1heFggPSA3NTA7XG4gICAgICAgICAgZW5lbXkuc2NhbGUueCA9IHNpemUueFNtYWxsO1xuICAgICAgICAgIGVuZW15LnNjYWxlLnkgPSBzaXplLnhTbWFsbDtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuXG4gICAgICBkcm9uZUZpZ2h0ZXJzLmluaXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5jcmVhdGVNdWx0aXBsZSgxMCwgJ2Ryb25lRmlnaHRlcicpO1xuICAgICAgICB0aGlzLm1pbldhdmVUaW1pbmcgPSAxOTA7XG4gICAgICAgIHRoaXMubWF4V2F2ZVRpbWluZyA9IDUwMDtcbiAgICAgICAgdGhpcy5taW5XYXZlTnVtYmVyID0gMjtcbiAgICAgICAgdGhpcy5tYXhXYXZlTnVtYmVyID0gNDtcbiAgICAgICAgdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKGVuZW15KSB7XG4gICAgICAgICAgZW5lbXkuZGFtYWdlQW1vdW50ID0gMjU7XG4gICAgICAgICAgZW5lbXkubGV2ZWwgPSAzO1xuICAgICAgICAgIGVuZW15LnNwZWVkID0gZ2FtZS5yYW5kb21JbnRlZ2VyRnJvbSgyNTAsIDQwMCk7XG4gICAgICAgICAgZW5lbXkuZHJpZnQgPSBnYW1lLnJhbmRvbUludGVnZXJGcm9tKDIwMCwgNDUwKTtcbiAgICAgICAgICBlbmVteS5kcmFnID0gNTA7XG4gICAgICAgICAgZW5lbXkubWluWCA9IDEwMDtcbiAgICAgICAgICBlbmVteS5tYXhYID0gNzAwO1xuICAgICAgICAgIGVuZW15LnNjYWxlLnggPSBzaXplLm1lZGl1bTtcbiAgICAgICAgICBlbmVteS5zY2FsZS55ID0gc2l6ZS5tZWRpdW07XG4gICAgICAgICAgZW5lbXkud2VhcG9uID0gZW5lbXlMYXNlcnM7XG4gICAgICAgICAgZW5lbXkuYnVsbGV0cyA9IDQ7XG4gICAgICAgICAgZW5lbXkuYnVsbGV0RGFtYWdlQW1vdW50ID0gMTA7XG4gICAgICAgICAgZW5lbXkuYnVsbGV0U3BlZWQgPSA1MDA7XG4gICAgICAgICAgZW5lbXkuZmlyaW5nU3BlZWQgPSAyMDtcbiAgICAgICAgICBlbmVteS5sYXN0U2hvdCA9IDA7XG4gICAgICAgICAgZW5lbXkudXBkYXRlID0gZW5lbXlGaXJpbmc7XG4gICAgICAgIH0pO1xuICAgICAgfTtcblxuICAgICAgZHJvbmVCb21iZXJzLmluaXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5jcmVhdGVNdWx0aXBsZSg1LCAnZHJvbmVCb21iZXInKTtcbiAgICAgICAgdGhpcy5taW5XYXZlVGltaW5nID0gNTAwO1xuICAgICAgICB0aGlzLm1heFdhdmVUaW1pbmcgPSA2MDA7XG4gICAgICAgIHRoaXMubWluV2F2ZU51bWJlciA9IDA7XG4gICAgICAgIHRoaXMubWF4V2F2ZU51bWJlciA9IDE7XG4gICAgICAgIHRoaXMuZm9yRWFjaChmdW5jdGlvbihlbmVteSkge1xuICAgICAgICAgIGVuZW15LmRhbWFnZUFtb3VudCA9IDUwO1xuICAgICAgICAgIGVuZW15LmxldmVsID0gNDtcbiAgICAgICAgICBlbmVteS5zcGVlZCA9IDEwMDtcbiAgICAgICAgICBlbmVteS5kcmlmdCA9IDU7XG4gICAgICAgICAgZW5lbXkuZHJhZyA9IDU7XG4gICAgICAgICAgZW5lbXkubWluWCA9IDI1MDtcbiAgICAgICAgICBlbmVteS5tYXhYID0gNjUwO1xuICAgICAgICAgIGVuZW15LnNjYWxlLnggPSBzaXplLmxhcmdlO1xuICAgICAgICAgIGVuZW15LnNjYWxlLnkgPSBzaXplLmxhcmdlO1xuICAgICAgICAgIGVuZW15LndlYXBvbiA9IGVuZW15Qm9tYnM7XG4gICAgICAgICAgZW5lbXkuYnVsbGV0cyA9IDI7XG4gICAgICAgICAgZW5lbXkuYnVsbGV0RGFtYWdlQW1vdW50ID0gNDA7XG4gICAgICAgICAgZW5lbXkuYnVsbGV0U3BlZWQgPSAyNTA7XG4gICAgICAgICAgZW5lbXkuZmlyaW5nU3BlZWQgPSA0MDtcbiAgICAgICAgICBlbmVteS5sYXN0U2hvdCA9IDA7XG4gICAgICAgICAgZW5lbXkudXBkYXRlID0gZW5lbXlGaXJpbmc7XG4gICAgICAgIH0pO1xuICAgICAgfTtcblxuICAgICAgZW5lbWllcy5mb3JFYWNoKGZ1bmN0aW9uKGdyb3VwKSB7XG4gICAgICAgIGNvbmZpZ3VyZUVuZW1pZXMoZ3JvdXApO1xuICAgICAgICBncm91cC5pbml0KCk7XG4gICAgICB9KTtcblxuICAgICAgZ2FtZS5sYXVuY2hFbmVtaWVzKGdhbWUucmFuZG9tSW50ZWdlckZyb20oMywgNSksIGRyb25lU2NvdXRzKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjb25maWd1cmVFbmVtaWVzKGdyb3VwKSB7XG4gICAgICBncm91cC5waHlzaWNzQm9keVR5cGUgPSBQaGFzZXIuUGh5c2ljcy5BUkNBREU7XG4gICAgICBncm91cC5lbmFibGVCb2R5ID0gdHJ1ZTtcbiAgICAgIGdyb3VwLnNldEFsbCgnYW5jaG9yLngnLCAwLjUpO1xuICAgICAgZ3JvdXAuc2V0QWxsKCdhbmNob3IueScsIDAuNSk7XG4gICAgICBncm91cC5zZXRBbGwoJ2FuZ2xlJywgMTgwKTtcbiAgICAgIGdyb3VwLnNldEFsbCgnb3V0T2ZCb3VuZHNLaWxsJywgdHJ1ZSk7XG4gICAgICBncm91cC5zZXRBbGwoJ2NoZWNrV29ybGRCb3VuZHMnLCB0cnVlKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBpbml0V2VhcG9ucygpIHtcbiAgICAgIGJ1bGxldHMgPSBnYW1lLmFkZC5ncm91cCgpO1xuICAgICAgYnVsbGV0cy5lbmFibGVCb2R5ID0gdHJ1ZTtcbiAgICAgIGJ1bGxldHMucGh5c2ljc0JvZHlUeXBlID0gUGhhc2VyLlBoeXNpY3MuQVJDQURFO1xuICAgICAgYnVsbGV0cy5jcmVhdGVNdWx0aXBsZSgxNSwgJ2J1bGxldCcpO1xuICAgICAgYnVsbGV0cy5zZXRBbGwoJ2FuY2hvci54JywgMC41KTtcbiAgICAgIGJ1bGxldHMuc2V0QWxsKCdhbmNob3IueScsIDEpO1xuICAgICAgYnVsbGV0cy5zZXRBbGwoJ291dE9mQm91bmRzS2lsbCcsIHRydWUpO1xuICAgICAgYnVsbGV0cy5zZXRBbGwoJ2NoZWNrV29ybGRCb3VuZHMnLCB0cnVlKTtcblxuICAgICAgLy8gZW5lbXkgd2VhcG9uc1xuICAgICAgZW5lbXlXZWFwb25zID0gW1xuICAgICAgICBlbmVteUxhc2VycyxcbiAgICAgICAgZW5lbXlCb21ic1xuICAgICAgXTtcblxuICAgICAgZW5lbXlMYXNlcnMgPSBnYW1lLmFkZC5ncm91cCgpO1xuICAgICAgZW5lbXlMYXNlcnMuZW5hYmxlQm9keSA9IHRydWU7XG4gICAgICBlbmVteUxhc2Vycy5waHlzaWNzQm9keVR5cGUgPSBQaGFzZXIuUGh5c2ljcy5BUkNBREU7XG4gICAgICBlbmVteUxhc2Vycy5jcmVhdGVNdWx0aXBsZSgyMCwgJ2VuZW15TGFzZXInKTtcbiAgICAgIGVuZW15TGFzZXJzLnNldEFsbCgnc2NhbGUueCcsIDAuNik7XG4gICAgICBlbmVteUxhc2Vycy5zZXRBbGwoJ3NjYWxlLnknLCAwLjYpO1xuICAgICAgZW5lbXlMYXNlcnMuc2V0QWxsKCdhbmNob3IueCcsIDAuNSk7XG4gICAgICBlbmVteUxhc2Vycy5zZXRBbGwoJ2FuY2hvci55JywgMC41KTtcbiAgICAgIGVuZW15TGFzZXJzLnNldEFsbCgnb3V0T2ZCb3VuZHNLaWxsJywgdHJ1ZSk7XG4gICAgICBlbmVteUxhc2Vycy5zZXRBbGwoJ2NoZWNrV29ybGRCb3VuZHMnLCB0cnVlKTtcblxuICAgICAgZW5lbXlCb21icyA9IGdhbWUuYWRkLmdyb3VwKCk7XG4gICAgICBlbmVteUJvbWJzLmVuYWJsZUJvZHkgPSB0cnVlO1xuICAgICAgZW5lbXlCb21icy5waHlzaWNzQm9keVR5cGUgPSBQaGFzZXIuUGh5c2ljcy5BUkNBREU7XG4gICAgICBlbmVteUJvbWJzLmNyZWF0ZU11bHRpcGxlKDEwLCAnZW5lbXlCb21iJyk7XG4gICAgICBlbmVteUJvbWJzLnNldEFsbCgnc2NhbGUueCcsIDEpO1xuICAgICAgZW5lbXlCb21icy5zZXRBbGwoJ3NjYWxlLnknLCAxKTtcbiAgICAgIGVuZW15Qm9tYnMuc2V0QWxsKCdhbmNob3IueCcsIDAuNSk7XG4gICAgICBlbmVteUJvbWJzLnNldEFsbCgnYW5jaG9yLnknLCAwLjUpO1xuICAgICAgZW5lbXlCb21icy5zZXRBbGwoJ291dE9mQm91bmRzS2lsbCcsIHRydWUpO1xuICAgICAgZW5lbXlCb21icy5zZXRBbGwoJ2NoZWNrV29ybGRCb3VuZHMnLCB0cnVlKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBpbml0RWZmZWN0cygpIHtcbiAgICAgIGV4cGxvc2lvbnMgPSBnYW1lLmFkZC5ncm91cCgpO1xuICAgICAgZXhwbG9zaW9ucy5lbmFibGVCb2R5ID0gdHJ1ZTtcbiAgICAgIGV4cGxvc2lvbnMucGh5c2ljc0JvZHlUeXBlID0gUGhhc2VyLlBoeXNpY3MuQVJDQURFO1xuICAgICAgZXhwbG9zaW9ucy5jcmVhdGVNdWx0aXBsZSgzMCwgJ2V4cGxvc2lvbicpO1xuICAgICAgZXhwbG9zaW9ucy5zZXRBbGwoJ2FuY2hvci54JywgMC41KTtcbiAgICAgIGV4cGxvc2lvbnMuc2V0QWxsKCdhbmNob3IueScsIDAuNSk7XG4gICAgICBleHBsb3Npb25zLmZvckVhY2goZnVuY3Rpb24oZXhwbG9zaW9uKSB7XG4gICAgICAgIGV4cGxvc2lvbi5hbmltYXRpb25zLmFkZCgnZXhwbG9zaW9uJyk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBpbml0TWVzc2FnZXMoKSB7XG5cbiAgICAgIGNyZWF0ZVNoaWVsZE1lc3NhZ2UoKTtcbiAgICAgIGNyZWF0ZVNjb3JlTWVzc2FnZSgpO1xuICAgICAgY3JlYXRlR2FtZU92ZXJNZXNzYWdlKCk7XG5cbiAgICAgIHBsYXllclNoaWVsZHMucmVuZGVyKCk7XG4gICAgICBzY29yZVRleHQucmVuZGVyKCk7XG5cbiAgICAgIGZ1bmN0aW9uIGNyZWF0ZVNoaWVsZE1lc3NhZ2UoKSB7XG4gICAgICAgIHBsYXllclNoaWVsZHMgPSBnYW1lLmFkZC5iaXRtYXBUZXh0KGdhbWUud29ybGQud2lkdGggLSAyNTAsIDEwLCAnc3BhY2Vmb250JywgJycgKyBwbGF5ZXIuaGVhbHRoICsgJyUnLCAyMCk7XG4gICAgICAgIHBsYXllclNoaWVsZHMucmVuZGVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcGxheWVyU2hpZWxkcy50ZXh0ID0gJ1NoaWVsZHM6ICcgKyBNYXRoLm1heChwbGF5ZXIuaGVhbHRoLCAwKSArICclJztcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gY3JlYXRlU2NvcmVNZXNzYWdlKCkge1xuICAgICAgICBzY29yZVRleHQgPSBnYW1lLmFkZC5iaXRtYXBUZXh0KDEwLCAxMCwgJ3NwYWNlZm9udCcsICcnLCAyMCk7XG4gICAgICAgIHNjb3JlVGV4dC5yZW5kZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICBzY29yZVRleHQudGV4dCA9ICdTY29yZTogJyArIHNjb3JlO1xuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBjcmVhdGVHYW1lT3Zlck1lc3NhZ2UoKSB7XG4gICAgICAgIGdhbWVPdmVyID0gZ2FtZS5hZGQuYml0bWFwVGV4dChnYW1lLndvcmxkLmNlbnRlclgsIGdhbWUud29ybGQuY2VudGVyWSwgJ3NwYWNlZm9udCcsICdHQU1FIE9WRVIhJywgNTApO1xuICAgICAgICBnYW1lT3Zlci54ID0gZ2FtZU92ZXIueCAtIGdhbWVPdmVyLnRleHRXaWR0aCAvIDI7XG4gICAgICAgIGdhbWVPdmVyLnkgPSBnYW1lT3Zlci55IC0gZ2FtZU92ZXIudGV4dEhlaWdodCAvIDM7XG4gICAgICAgIGdhbWVPdmVyLnZpc2libGUgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cbiAgdXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgZ2FtZSA9IHRoaXM7XG5cbiAgICBzdGFyZmllbGQudGlsZVBvc2l0aW9uLnkgKz0gc2Nyb2xsU3BlZWQ7XG4gICAgZW5lbXlSZWxlYXNlQ291bnRlcisrO1xuXG4gICAgZW5lbWllcy5mb3JFYWNoKGZ1bmN0aW9uKGVuZW15KSB7XG4gICAgICBjaGVja1dhdmVUaW1lcihlbmVteSk7XG4gICAgICBsYXVuY2hOZXdXYXZlcyhlbmVteSk7XG5cbiAgICAgIGZ1bmN0aW9uIGNoZWNrV2F2ZVRpbWVyKGVuZW15KSB7XG4gICAgICAgIGlmICghZW5lbXkud2F2ZVRpbWVyKSB7XG4gICAgICAgICAgZW5lbXkud2F2ZVRpbWVyID1cbiAgICAgICAgICAgIHJvdW5kVG9OZWFyZXN0VGVuKFxuICAgICAgICAgICAgICBnYW1lLnJhbmRvbUludGVnZXJGcm9tKFxuICAgICAgICAgICAgICAgIGVuZW15Lm1pbldhdmVUaW1pbmcsXG4gICAgICAgICAgICAgICAgZW5lbXkubWF4V2F2ZVRpbWluZ1xuICAgICAgICAgICAgICApKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHJvdW5kVG9OZWFyZXN0VGVuKG51bSkge1xuICAgICAgICAgIHJldHVybiBNYXRoLmNlaWwobnVtIC8gMTApICogMTA7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gbGF1bmNoTmV3V2F2ZXMoZW5lbXkpIHtcbiAgICAgICAgaWYgKGVuZW15UmVsZWFzZUNvdW50ZXIgJSBlbmVteS53YXZlVGltZXIgPT09IDApIHtcbiAgICAgICAgICBnYW1lLmxhdW5jaEVuZW1pZXMoXG4gICAgICAgICAgICBnYW1lLnJhbmRvbUludGVnZXJGcm9tKFxuICAgICAgICAgICAgICBlbmVteS5taW5XYXZlTnVtYmVyLFxuICAgICAgICAgICAgICBlbmVteS5tYXhXYXZlTnVtYmVyKSxcbiAgICAgICAgICAgIGVuZW15KTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIldhdmUgbGF1bmNoZWQ/IVwiKTtcbiAgICAgICAgICBlbmVteS53YXZlVGltZXIgPSBudWxsO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBjaGVja0NvbGxpc2lvbnMoKTtcbiAgICBjaGVja0ZvckdhbWVPdmVyKCk7XG4gICAgY2FsY3VsYXRlUGxheWVyTW92ZW1lbnQoKTtcblxuICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZVBsYXllck1vdmVtZW50KCkge1xuXG4gICAgICBwbGF5ZXIuYm9keS5hY2NlbGVyYXRpb24ueCA9IDA7XG4gICAgICBnYW1lLmNoZWNrRm9yQm91bmRzKDUwLCA3NTAsIHBsYXllcik7XG4gICAgICBjaGVja0ZvclBsYXllcklucHV0KCk7XG4gICAgICBzaGlwVHJhaWwueCA9IHBsYXllci54O1xuICAgICAgZ2FtZS5hcHBseUJhbmtpbmdUb1NoaXAocGxheWVyKTtcblxuXG4gICAgICBmdW5jdGlvbiBjaGVja0ZvclBsYXllcklucHV0KCkge1xuICAgICAgICBpZiAoY3Vyc29ycy5sZWZ0LmlzRG93bikge1xuICAgICAgICAgIHBsYXllci5ib2R5LmFjY2VsZXJhdGlvbi54ID0gLXNoaXAuYWNjZWxlcmF0aW9uO1xuICAgICAgICB9IGVsc2UgaWYgKGN1cnNvcnMucmlnaHQuaXNEb3duKSB7XG4gICAgICAgICAgcGxheWVyLmJvZHkuYWNjZWxlcmF0aW9uLnggPSBzaGlwLmFjY2VsZXJhdGlvbjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChwbGF5ZXIuYWxpdmUgJiYgZmlyZUJ1dHRvbi5pc0Rvd24pIHtcbiAgICAgICAgICBmaXJlQnVsbGV0KCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjaGVja0ZvckdhbWVPdmVyKCkge1xuICAgICAgaWYgKCFwbGF5ZXIuYWxpdmUgJiYgZ2FtZU92ZXIudmlzaWJsZSA9PSBmYWxzZSkge1xuICAgICAgICBnYW1lT3Zlci52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgZ2FtZU92ZXIuYWxwaGEgPSAwO1xuICAgICAgICB2YXIgZmFkZUluR2FtZU92ZXIgPSBnYW1lLmFkZC50d2VlbihnYW1lT3Zlcik7XG4gICAgICAgIGZhZGVJbkdhbWVPdmVyLnRvKHtcbiAgICAgICAgICBhbHBoYTogMVxuICAgICAgICB9LCAxMDAwLCBQaGFzZXIuRWFzaW5nLlF1aW50aWMuT3V0KTtcbiAgICAgICAgZmFkZUluR2FtZU92ZXIub25Db21wbGV0ZS5hZGQoc2V0UmVzZXRIYW5kbGVycyk7XG4gICAgICAgIGZhZGVJbkdhbWVPdmVyLnN0YXJ0KCk7XG5cbiAgICAgICAgZnVuY3Rpb24gc2V0UmVzZXRIYW5kbGVycygpIHtcbiAgICAgICAgICB2YXIgdGFwUmVzdGFydCA9IGdhbWUuaW5wdXQub25UYXAuYWRkT25jZShfcmVzdGFydCwgZ2FtZSk7XG4gICAgICAgICAgdmFyIHNwYWNlUmVzdGFydCA9IGZpcmVCdXR0b24ub25Eb3duLmFkZE9uY2UoX3Jlc3RhcnQsIGdhbWUpO1xuXG4gICAgICAgICAgZnVuY3Rpb24gX3Jlc3RhcnQoKSB7XG4gICAgICAgICAgICB0YXBSZXN0YXJ0LmRldGFjaCgpO1xuICAgICAgICAgICAgc3BhY2VSZXN0YXJ0LmRldGFjaCgpO1xuICAgICAgICAgICAgZ2FtZS5yZXN0YXJ0KCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY2hlY2tDb2xsaXNpb25zKCkge1xuICAgICAgZW5lbWllcy5mb3JFYWNoKGZ1bmN0aW9uKGdyb3VwKSB7XG4gICAgICAgIGdhbWUucGh5c2ljcy5hcmNhZGUub3ZlcmxhcChwbGF5ZXIsIGdyb3VwLCBzaGlwQ29sbGlkZSwgbnVsbCwgZ2FtZSk7XG4gICAgICAgIGdhbWUucGh5c2ljcy5hcmNhZGUub3ZlcmxhcChidWxsZXRzLCBncm91cCwgaGl0RW5lbXksIG51bGwsIGdhbWUpO1xuICAgICAgfSk7XG5cbiAgICAgIGVuZW15V2VhcG9ucy5mb3JFYWNoKGZ1bmN0aW9uKHByb2plY3RpbGVzKSB7XG4gICAgICAgIGdhbWUucGh5c2ljcy5hcmNhZGUub3ZlcmxhcChwcm9qZWN0aWxlcywgcGxheWVyLCBlbmVteUhpdHNQbGF5ZXIsIG51bGwsIHRoaXMpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZmlyZUJ1bGxldCgpIHtcbiAgICAgIHZhciBidWxsZXQgPSBidWxsZXRzLmdldEZpcnN0RXhpc3RzKGZhbHNlKTtcbiAgICAgIHZhciBidWxsZXRTcGVlZCA9IDQwMDtcblxuICAgICAgaWYgKGJ1bGxldENvdW50ZXIgPiBmaXJpbmdTcGVlZCkge1xuXG4gICAgICAgIGJ1bGxldENvdW50ZXIgPSAwO1xuXG4gICAgICAgIC8vIEJ1bGxldCBwaHlzaWNzXG4gICAgICAgIGlmIChidWxsZXQpIHtcbiAgICAgICAgICBidWxsZXQucmVzZXQocGxheWVyLngsIHBsYXllci55IC0gMjUpO1xuXG4gICAgICAgICAgYnVsbGV0LmJvZHkudmVsb2NpdHkueSA9IC0yMDA7XG4gICAgICAgICAgYnVsbGV0LmJvZHkudmVsb2NpdHkueCArPSBwbGF5ZXIuYm9keS52ZWxvY2l0eS54IC8gNTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgYnVsbGV0Q291bnRlcisrO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNoaXBDb2xsaWRlKHBsYXllciwgZW5lbXkpIHtcbiAgICAgIHZhciBleHBsb3Npb24gPSBleHBsb3Npb25zLmdldEZpcnN0RXhpc3RzKGZhbHNlKTtcbiAgICAgIGV4cGxvc2lvbi5yZXNldChlbmVteS5ib2R5LnggKyBlbmVteS5ib2R5LmhhbGZXaWR0aCwgZW5lbXkuYm9keS55ICsgZW5lbXkuYm9keS5oYWxmSGVpZ2h0KTtcbiAgICAgIGV4cGxvc2lvbi5ib2R5LnZlbG9jaXR5LnkgPSBlbmVteS5ib2R5LnZlbG9jaXR5Lnk7XG4gICAgICBleHBsb3Npb24uYWxwaGEgPSAwLjc7XG4gICAgICBleHBsb3Npb24ucGxheSgnZXhwbG9zaW9uJywgMzAsIGZhbHNlLCB0cnVlKTtcbiAgICAgIGVuZW15LmtpbGwoKTtcblxuICAgICAgcGxheWVyLmRhbWFnZShlbmVteS5kYW1hZ2VBbW91bnQpO1xuICAgICAgcGxheWVyU2hpZWxkcy5yZW5kZXIoKTtcbiAgICAgIGFkZFBvaW50c0ZvcktpbGxpbmcoZW5lbXkpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGVuZW15SGl0c1BsYXllcihwbGF5ZXIsIGJ1bGxldCkge1xuICAgICAgZ29Cb29tKHBsYXllcik7XG4gICAgICBidWxsZXQua2lsbCgpO1xuICAgICAgcGxheWVyLmRhbWFnZShidWxsZXQuZGFtYWdlQW1vdW50KTtcbiAgICAgIHNoaWVsZHMucmVuZGVyKCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaGl0RW5lbXkoYnVsbGV0LCBlbmVteSkge1xuICAgICAgZ29Cb29tKGVuZW15KTtcbiAgICAgIGVuZW15LmtpbGwoKTtcbiAgICAgIGJ1bGxldC5raWxsKCk7XG4gICAgICBhZGRQb2ludHNGb3JLaWxsaW5nKGVuZW15KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnb0Jvb20oZW50aXR5KSB7XG4gICAgICB2YXIgZXhwbG9zaW9uID0gZXhwbG9zaW9ucy5nZXRGaXJzdEV4aXN0cyhmYWxzZSk7XG4gICAgICBleHBsb3Npb24ucmVzZXQoZW50aXR5LmJvZHkueCArIGVudGl0eS5ib2R5LmhhbGZXaWR0aCwgZW50aXR5LmJvZHkueSArIGVudGl0eS5ib2R5LmhhbGZIZWlnaHQpO1xuICAgICAgZXhwbG9zaW9uLmJvZHkudmVsb2NpdHkueSA9IGVudGl0eS5ib2R5LnZlbG9jaXR5Lnk7XG4gICAgICBleHBsb3Npb24uYWxwaGEgPSAwLjc7XG4gICAgICBleHBsb3Npb24ucGxheSgnZXhwbG9zaW9uJywgMzAsIGZhbHNlLCB0cnVlKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBhZGRQb2ludHNGb3JLaWxsaW5nKGVuZW15KSB7XG4gICAgICBzY29yZSArPSBlbmVteS5kYW1hZ2VBbW91bnQgKiBlbmVteS5sZXZlbDtcbiAgICAgIHNjb3JlVGV4dC5yZW5kZXIoKTtcbiAgICB9XG5cbiAgfSxcblxuICBsYXVuY2hFbmVtaWVzOiBmdW5jdGlvbihxdWFudGl0eSwgZW5lbXlHcm91cCkge1xuICAgIHZhciBnYW1lID0gdGhpcztcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHF1YW50aXR5OyBpKyspIHtcbiAgICAgIGxhdW5jaEVuZW15KCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbGF1bmNoRW5lbXkoKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIkxhdW5jaGluZyBlbmVteS4uLlwiKTtcbiAgICAgIHZhciBlbmVteSA9IGVuZW15R3JvdXAuZ2V0Rmlyc3RFeGlzdHMoZmFsc2UpO1xuICAgICAgaWYgKGVuZW15KSB7XG4gICAgICAgIHZhciBlbmVteUxvY2F0aW9uID0gZ2FtZS5yYW5kb21JbnRlZ2VyRnJvbShcbiAgICAgICAgICBlbmVteS5taW5YLCBlbmVteS5tYXhYKTtcbiAgICAgICAgZW5lbXkucmVzZXQoZW5lbXlMb2NhdGlvbiwgLTIwKTtcbiAgICAgICAgZW5lbXkuYm9keS52ZWxvY2l0eS54ID0gZ2FtZS5yYW5kb21JbnRlZ2VyRnJvbSgtZW5lbXkuZHJpZnQsIGVuZW15LmRyaWZ0KTtcbiAgICAgICAgZW5lbXkuYm9keS52ZWxvY2l0eS55ID0gZW5lbXkuc3BlZWQ7XG4gICAgICAgIGVuZW15LmJvZHkuZHJhZy54ID0gZW5lbXkuZHJhZztcbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cbiAgc2V0RW5lbXlBdHRyaWJ1dGVzOiBmdW5jdGlvbihlbmVteSwgb3B0aW9ucykge1xuXG4gICAgLy8gVW51c2VkIGFzIG9mIHJpZ2h0IG5vdy5cbiAgICAvLyBDb3VsZCBiZSB1c2VkIGZvciBwb3dlcnVwcyBvciBhYmlsaXRpZXMgdGhhdCBjaGFuZ2UgZW5lbXkgYXR0cmlidXRlc1xuICAgIC8vIChzcGVlZCBjb3VsZCBiZSBoYWx2ZWQgZm9yIGEgXCJTbG93IFRpbWVcIiBwb3dlcnVwLCBmb3IgZXhhbXBsZSlcbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICBnYW1lLnBoeXNpY3MuZW5hYmxlKGVuZW15LCBQaGFzZXIuUGh5c2ljcy5BUkNBREUpO1xuICAgIGZvciAoYXR0ciBpbiBvcHRpb25zKSB7XG4gICAgICBlbmVteVthdHRyXSA9IG9wdGlvbnNbYXR0cl07XG4gICAgfVxuICB9LFxuXG4gIGNoZWNrRm9yQm91bmRzOiBmdW5jdGlvbihtaW4sIG1heCwgZW50aXR5KSB7XG4gICAgaWYgKGVudGl0eS54ID4gbWF4KSB7XG4gICAgICBlbnRpdHkueCA9IG1heDtcbiAgICAgIGVudGl0eS5ib2R5LmFjY2VsZXJhdGlvbi54ID0gLTUwO1xuICAgIH1cbiAgICBpZiAoZW50aXR5LnggPCBtaW4pIHtcbiAgICAgIGVudGl0eS54ID0gbWluO1xuICAgICAgZW50aXR5LmJvZHkuYWNjZWxlcmF0aW9uLnggPSA1MDtcbiAgICB9XG4gIH0sXG5cbiAgLy8gVE9ETyAtIFRhY2sgc3R1ZmYgbGlrZSBtYXhTcGVlZCB0byBwbGF5ZXIgb2JqZWN0XG4gIGFwcGx5QmFua2luZ1RvU2hpcDogZnVuY3Rpb24oZW50aXR5KSB7XG4gICAgdmFyIGJhbmsgPSBlbnRpdHkuYm9keS52ZWxvY2l0eS54IC8gc2hpcC5tYXhTcGVlZDtcbiAgICBlbnRpdHkuc2NhbGUueCA9IGVudGl0eS5zaXplIC0gTWF0aC5hYnMoYmFuaykgLyA0O1xuICAgIGVudGl0eS5hbmdsZSA9IGJhbmsgKiA1O1xuICB9LFxuXG4gIGNyZWF0ZVNoaXBUcmFpbDogZnVuY3Rpb24oc2hpcCwgcGFydGljbGVOYW1lKSB7XG4gICAgc2hpcFRyYWlsID0gdGhpcy5hZGQuZW1pdHRlcihzaGlwLngsIHNoaXAueSArIDQwLCA0MDApO1xuICAgIHNoaXBUcmFpbC53aWR0aCA9IDEwO1xuICAgIHNoaXBUcmFpbC5tYWtlUGFydGljbGVzKHBhcnRpY2xlTmFtZSk7XG4gICAgc2hpcFRyYWlsLnNldFhTcGVlZCgzMCwgLTMwKTtcbiAgICBzaGlwVHJhaWwuc2V0WVNwZWVkKDIwMCwgMTgwKTtcbiAgICBzaGlwVHJhaWwuc2V0Um90YXRpb24oNTAsIC01MCk7XG4gICAgc2hpcFRyYWlsLnNldEFscGhhKDEsIDAuMDEsIDgwMCk7XG4gICAgc2hpcFRyYWlsLnNldFNjYWxlKDAuMDUsIDAuNCwgMC4wNSwgMC40LCAyMDAwLCBQaGFzZXIuRWFzaW5nLlF1aW50aWMuT3V0KTtcbiAgICBzaGlwVHJhaWwuc3RhcnQoZmFsc2UsIDUwMDAsIDEwKTtcbiAgfSxcblxuICByZXN0YXJ0OiBmdW5jdGlvbigpIHtcbiAgICBlbmVtaWVzLmZvckVhY2goZnVuY3Rpb24oZW5lbXkpIHtcbiAgICAgIGVuZW15LmNhbGxBbGwoJ2tpbGwnKTtcbiAgICB9KTtcblxuICAgIGVuZW15V2VhcG9ucy5mb3JFYWNoKGZ1bmN0aW9uKHByb2opIHtcbiAgICAgIHByb2ouY2FsbEFsbCgna2lsbCcpO1xuICAgIH0pO1xuXG4gICAgZW5lbXlSZWxlYXNlQ291bnRlciA9IDA7XG4gICAgcGxheWVyLnJldml2ZSgpO1xuICAgIHBsYXllci5oZWFsdGggPSAxMDA7XG4gICAgcGxheWVyU2hpZWxkcy5yZW5kZXIoKTtcbiAgICBzY29yZSA9IDA7XG4gICAgc2NvcmVUZXh0LnJlbmRlcigpO1xuICAgIGdhbWVPdmVyLnZpc2libGUgPSBmYWxzZTtcbiAgfSxcblxuICAvLyBVdGlsaXR5IGZ1bmN0aW9uc1xuICByYW5kb21JbnRlZ2VyRnJvbTogZnVuY3Rpb24obWluLCBtYXgpIHtcbiAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbikgKyBtaW4gKyAxKTtcbiAgfSxcblxuICBvbklucHV0RG93bjogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5nYW1lLnN0YXRlLnN0YXJ0KCdNZW51Jyk7XG4gIH1cbn07IiwidmFyIE1lbnUgPSBmdW5jdGlvbiAoKSB7XG4gIHRoaXMudGV4dCA9IG51bGw7XG4gIHRoaXMuc3VidGl0bGUgPSBudWxsO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBNZW51O1xuXG5NZW51LnByb3RvdHlwZSA9IHtcblxuICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgeCA9IHRoaXMuZ2FtZS53aWR0aCAvIDI7XG4gICAgdmFyIHkgPSB0aGlzLmdhbWUuaGVpZ2h0IC8gMjtcblxuICAgIHRoaXMudGV4dCA9IHRoaXMuYWRkLmJpdG1hcFRleHQoeCAtIDMwMCwgeSAtIDIwMCwgJ3NwYWNlZm9udCcsIFwiQ2xpY2sgdG8gU3RhcnRcIiwgNTApO1xuICAgIHRoaXMuc3VidGl0bGUgPSB0aGlzLmFkZC5iaXRtYXBUZXh0KHggLSAzMDAsIHkgLSAxMDAsICdzcGFjZWZvbnQnLCBcIkFycm93IGtleXMgdG8gbW92ZSwgU3BhY2UgdG8gZmlyZVwiLCAyMCk7XG5cbiAgICB0aGlzLmlucHV0Lm9uRG93bi5hZGQodGhpcy5vbkRvd24sIHRoaXMpO1xuICB9LFxuXG4gIHVwZGF0ZTogZnVuY3Rpb24gKCkge1xuICB9LFxuXG4gIG9uRG93bjogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuZ2FtZS5zdGF0ZS5zdGFydChwbGF5ZXJTdGF0ZS5jdXJyZW50TGV2ZWwpO1xuICB9XG59O1xuIiwidmFyIFByZWxvYWRlciA9IGZ1bmN0aW9uKGdhbWUpIHtcbiAgdGhpcy5hc3NldCA9IG51bGw7XG4gIHRoaXMucmVhZHkgPSBmYWxzZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUHJlbG9hZGVyO1xuXG5cblByZWxvYWRlci5wcm90b3R5cGUgPSB7XG5cbiAgcHJlbG9hZDogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5hc3NldCA9IHRoaXMuYWRkLnNwcml0ZSgzMjAsIDI0MCwgJ3ByZWxvYWRlcicpO1xuICAgIHRoaXMuYXNzZXQuYW5jaG9yLnNldFRvKDAuNSwgMC41KTtcblxuICAgIHRoaXMucGh5c2ljcy5zdGFydFN5c3RlbShQaGFzZXIuUGh5c2ljcy5BUkNBREUpO1xuXG4gICAgdGhpcy5sb2FkLm9uTG9hZENvbXBsZXRlLmFkZE9uY2UodGhpcy5vbkxvYWRDb21wbGV0ZSwgdGhpcyk7XG4gICAgdGhpcy5sb2FkLnNldFByZWxvYWRTcHJpdGUodGhpcy5hc3NldCk7XG4gICAgdGhpcy5sb2FkLmltYWdlKCdzdGFyZmllbGQnLCAnYXNzZXRzL3N0YXJmaWVsZC5wbmcnKTtcbiAgICB0aGlzLmxvYWQuaW1hZ2UoJ3NoaXAnLCAnYXNzZXRzL3BsYXllci5wbmcnKTtcbiAgICB0aGlzLmxvYWQuaW1hZ2UoJ3BsYXNtYScsICdhc3NldHMvYmx1ZVBsYXNtYS5wbmcnKTtcbiAgICB0aGlzLmxvYWQuaW1hZ2UoJ2xhc2VyJywgJ2Fzc2V0cy9ibHVlTGFzZXIucG5nJyk7XG4gICAgdGhpcy5sb2FkLmltYWdlKCdidWxsZXQnLCAnYXNzZXRzL2JsdWVCdWxsZXQucG5nJyk7XG4gICAgdGhpcy5sb2FkLmltYWdlKCdlbmVteUxhc2VyJywgJ2Fzc2V0cy9yZWRMYXNlci5wbmcnKTtcbiAgICB0aGlzLmxvYWQuaW1hZ2UoJ2VuZW15Qm9tYicsICdhc3NldHMvcmVkQm9tYi5wbmcnKTtcbiAgICB0aGlzLmxvYWQuaW1hZ2UoJ2Ryb25lU2NvdXQnLCAnYXNzZXRzL2Ryb25lU2NvdXQucG5nJyk7XG4gICAgdGhpcy5sb2FkLmltYWdlKCdkcm9uZUZpZ2h0ZXInLCAnYXNzZXRzL2Ryb25lRmlnaHRlci5wbmcnKTtcbiAgICB0aGlzLmxvYWQuaW1hZ2UoJ2Ryb25lQm9tYmVyJywgJ2Fzc2V0cy9kcm9uZUJvbWJlci5wbmcnKTtcbiAgICB0aGlzLmxvYWQuaW1hZ2UoJ2VuZW15VHJhaWwnLCAnYXNzZXRzL2VuZW15VHJhaWwucG5nJyk7XG4gICAgdGhpcy5sb2FkLnNwcml0ZXNoZWV0KCdleHBsb3Npb24nLCAnYXNzZXRzL2V4cGxvc2lvbi5wbmcnLCAxMjgsIDEyOCk7XG4gICAgdGhpcy5sb2FkLmJpdG1hcEZvbnQoJ3NwYWNlZm9udCcsICdhc3NldHMvc3BhY2Vmb250L3NwYWNlZm9udC5wbmcnLCAnYXNzZXRzL3NwYWNlZm9udC9zcGFjZWZvbnQuZm50Jyk7XG4gIH0sXG5cbiAgY3JlYXRlOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmFzc2V0LmNyb3BFbmFibGVkID0gZmFsc2U7XG4gIH0sXG5cbiAgdXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICBpZiAoISF0aGlzLnJlYWR5KSB7XG4gICAgICB0aGlzLmdhbWUuc3RhdGUuc3RhcnQoJ01lbnUnKTtcbiAgICB9XG4gIH0sXG5cbiAgb25Mb2FkQ29tcGxldGU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMucmVhZHkgPSB0cnVlO1xuICB9XG59OyIsInZhciBTcGxhc2ggPSBmdW5jdGlvbiAoKSB7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFNwbGFzaDtcblxuU3BsYXNoLnByb3RvdHlwZSA9IHtcbiAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XG4gIH1cbn07IiwidmFyIFV0aWxzID0ge1xuICAgIGNvbnRhaW5zT2JqZWN0OiBmdW5jdGlvbihvYmosIGxpc3QpIHtcbiAgICAgICAgdmFyIGk7XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAobGlzdFtpXSA9PT0gb2JqKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBVdGlsczsiXX0=
